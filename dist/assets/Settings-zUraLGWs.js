import{j as e,a7 as t,a8 as a,u as s,q as n,X as r,a9 as i,aa as o,e as l,M as c,I as d,ab as u,r as m,n as g,ac as p,J as x,k as h,ad as b,a5 as y}from"./ui-BiCH2ERa.js";import{r as f,a as j}from"./vendor-Bpi3ojsJ.js";import{u as v,a as w,m as k,c as N,b as S,d as I,A as D,B as C}from"./index-D225AQNs.js";import{u as E}from"./router-BVsa7jMf.js";import"../node_modules/lucide-react/dist/esm/icons/inspection-panel.js";import"../node_modules/lucide-react/dist/esm/icons/test-tube-diagonal.js";import"../node_modules/lucide-react/dist/esm/icons/test-tube.js";import"../node_modules/lucide-react/dist/esm/icons/test-tubes.js";import"./utils-Cn9_BRGm.js";import"./firebase-DnLZX0Zq.js";import"../node_modules/motion-dom/dist/es/value/types/test.mjs";import"../node_modules/d3-array/src/greatest.js";const B=(e,t)=>t.some(t=>e instanceof t);let O,L;const P=new WeakMap,M=new WeakMap,A=new WeakMap;let F={get(e,t,a){if(e instanceof IDBTransaction){if("done"===t)return P.get(e);if("store"===t)return a.objectStoreNames[1]?void 0:a.objectStore(a.objectStoreNames[0])}return q(e[t])},set:(e,t,a)=>(e[t]=a,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function T(e){F=e(F)}function R(e){return(L||(L=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(z(this),t),q(this.request)}:function(...t){return q(e.apply(z(this),t))}}function W(e){return"function"==typeof e?R(e):(e instanceof IDBTransaction&&function(e){if(P.has(e))return;const t=new Promise((t,a)=>{const s=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",r),e.removeEventListener("abort",r)},n=()=>{t(),s()},r=()=>{a(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",n),e.addEventListener("error",r),e.addEventListener("abort",r)});P.set(e,t)}(e),B(e,O||(O=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,F):e)}function q(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,a)=>{const s=()=>{e.removeEventListener("success",n),e.removeEventListener("error",r)},n=()=>{t(q(e.result)),s()},r=()=>{a(e.error),s()};e.addEventListener("success",n),e.addEventListener("error",r)});return A.set(t,e),t}(e);if(M.has(e))return M.get(e);const t=W(e);return t!==e&&(M.set(e,t),A.set(t,e)),t}const z=e=>A.get(e);const U=["get","getKey","getAll","getAllKeys","count"],$=["put","add","delete","clear"],J=new Map;function V(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(J.get(t))return J.get(t);const a=t.replace(/FromIndex$/,""),s=t!==a,n=$.includes(a);if(!(a in(s?IDBIndex:IDBObjectStore).prototype)||!n&&!U.includes(a))return;const r=async function(e,...t){const r=this.transaction(e,n?"readwrite":"readonly");let i=r.store;return s&&(i=i.index(t.shift())),(await Promise.all([i[a](...t),n&&r.done]))[0]};return J.set(t,r),r}T(e=>({...e,get:(t,a,s)=>V(t,a)||e.get(t,a,s),has:(t,a)=>!!V(t,a)||e.has(t,a)}));const _=["continue","continuePrimaryKey","advance"],H={},K=new WeakMap,G=new WeakMap,Q={get(e,t){if(!_.includes(t))return e[t];let a=H[t];return a||(a=H[t]=function(...e){K.set(this,G.get(this)[t](...e))}),a}};async function*X(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;const a=new Proxy(t,Q);for(G.set(a,t),A.set(a,z(t));t;)yield a,t=await(K.get(a)||t.continue()),K.delete(a)}function Y(e,t){return t===Symbol.asyncIterator&&B(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&B(e,[IDBIndex,IDBObjectStore])}T(e=>({...e,get:(t,a,s)=>Y(t,a)?X:e.get(t,a,s),has:(t,a)=>Y(t,a)||e.has(t,a)}));const Z=new class{db=null;async init(){return this.db||(this.db=await function(e,t,{blocked:a,upgrade:s,blocking:n,terminated:r}={}){const i=indexedDB.open(e,t),o=q(i);return s&&i.addEventListener("upgradeneeded",e=>{s(q(i.result),e.oldVersion,e.newVersion,q(i.transaction),e)}),a&&i.addEventListener("blocked",e=>a(e.oldVersion,e.newVersion,e)),o.then(e=>{r&&e.addEventListener("close",()=>r()),n&&e.addEventListener("versionchange",e=>n(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}("PlantCareDB",1,{upgrade(e){const t=e.createObjectStore("plants",{keyPath:"id"});t.createIndex("by-health","healthScore"),t.createIndex("by-date","dateAdded"),e.createObjectStore("images",{keyPath:"id"}),e.createObjectStore("settings",{keyPath:"key"})}})),this.db}async savePlant(e){const t=await this.init();await t.put("plants",e);const a=await this.getAllPlants();localStorage.setItem("plants",JSON.stringify(a))}async getPlant(e){const t=await this.init();return await t.get("plants",e)}async getAllPlants(){const e=await this.init();return(await e.getAll("plants")).map(e=>({...e,dateAdded:new Date(e.dateAdded),lastWatered:e.lastWatered?new Date(e.lastWatered):void 0,lastFertilized:e.lastFertilized?new Date(e.lastFertilized):void 0,images:e.images.map(e=>({...e,timestamp:new Date(e.timestamp)})),chatHistory:e.chatHistory.map(e=>({...e,timestamp:new Date(e.timestamp)})),notifications:e.notifications.map(e=>({...e,scheduledFor:new Date(e.scheduledFor)}))}))}async deletePlant(e){const t=await this.init();await t.delete("plants",e);const a=await this.getAllPlants();localStorage.setItem("plants",JSON.stringify(a))}async saveImageBlob(e,t,a){const s=await this.init();await s.put("images",{id:e,plantId:t,blob:a,timestamp:new Date})}async getImageBlob(e){const t=await this.init(),a=await t.get("images",e);return a?.blob}async saveSetting(e,t){const a=await this.init();await a.put("settings",{key:e,value:t})}async getSetting(e){const t=await this.init(),a=await t.get("settings",e);return a?.value}async exportData(){const e=await this.getAllPlants(),t={theme:await this.getSetting("theme"),notifications:await this.getSetting("notifications")};return JSON.stringify({plants:e,settings:t,exportDate:(new Date).toISOString(),version:"1.0.0"},null,2)}async importData(e){try{const t=JSON.parse(e);if(t.plants)for(const e of t.plants)await this.savePlant(e);if(t.settings)for(const[e,a]of Object.entries(t.settings))void 0!==a&&await this.saveSetting(e,a)}catch(t){throw new Error("Invalid data format")}}async clearAllData(){const e=await this.init();await e.clear("plants"),await e.clear("images"),await e.clear("settings"),localStorage.removeItem("plants")}};var ee=({title:t,children:a,delay:s=0})=>e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*s},className:"space-y-3",children:[e.jsx("h2",{className:"text-lg font-bold text-foreground px-4",children:t}),e.jsx("div",{className:"bg-muted/50 rounded-2xl overflow-hidden",children:a})]});const te=f.forwardRef(({className:s,...n},r)=>e.jsx(t,{className:N("peer inline-flex h-7 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...n,ref:r,children:e.jsx(a,{className:N("pointer-events-none block h-6 w-6 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));te.displayName=t.displayName;var ae=({icon:t,label:a,value:n,onClick:r,isLast:i=!1,type:o="button",disabled:l=!1,toggleState:c=!1,onToggleChange:d})=>{const u=j.useId(),m=e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-background",children:e.jsx(t,{size:18,className:"text-muted-foreground"})}),e.jsx("span",{className:"font-medium text-foreground",children:a})]}),e.jsxs("div",{className:"flex items-center gap-2",children:["button"===o&&e.jsxs(e.Fragment,{children:[n&&e.jsx("span",{className:"text-sm text-muted-foreground",children:n}),e.jsx(s,{size:16,className:"text-muted-foreground/50"})]}),"toggle"===o&&e.jsx(te,{id:u,checked:c,onCheckedChange:d,"aria-label":a})]})]}),g=N("flex w-full items-center justify-between p-3 text-left",!i&&"border-b border-background",r&&"transition-colors hover:bg-background/50");return"button"===o?e.jsx("button",{onClick:r,className:g,disabled:l,children:m}):e.jsx("label",{htmlFor:u,className:N(g,"cursor-pointer"),children:m})};const se=()=>{const[e,t]=f.useState(!1),{data:a=[]}=S(),s=e=>e.toISOString().split("T")[0],n=e=>{if(null==e)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?`"${t.replace(/"/g,'""')}"`:t},r=async e=>{t(!0);try{const t={exportDate:(new Date).toISOString(),plantCount:a.length,plants:a.map(t=>({id:t.id,name:t.name,nickname:t.nickname,species:t.species,location:t.location,plantEnvironment:t.plantEnvironment,lightRequirements:t.lightRequirements,healthScore:t.healthScore,lastWatered:t.lastWatered?.toISOString(),...e.includeImages&&{profileImageUrl:t.profileImageUrl},...e.includeChats&&{chatHistory:[]}})),metadata:{version:"1.0.0",source:"Plant Care Companion"}},n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"});i(n,`plantas-backup-${s(new Date)}.json`)}catch(n){throw new Error("Failed to export data as JSON")}finally{t(!1)}},i=(e,t)=>{const a=URL.createObjectURL(e),s=document.createElement("a");s.href=a,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)};return{exportData:async e=>{if(0===a.length)throw new Error("No hay plantas para exportar");switch(e.format){case"json":return r(e);case"csv":return(async e=>{t(!0);try{const t=["ID","Nombre","Apodo","Especie","Ubicación","Ambiente","Luz Requerida","Puntuación Salud","Último Riego"];e.includeImages&&t.push("Imagen Principal");const r=[t.join(",")];a.forEach(t=>{const a=[n(t.id),n(t.name),n(t.nickname||""),n(t.species),n(t.location),n(t.plantEnvironment||""),n(t.lightRequirements||""),n(t.healthScore||""),n(t.lastWatered?s(t.lastWatered):"")];e.includeImages&&a.push(n(t.profileImageUrl||"")),r.push(a.join(","))});const o=r.join("\n"),l=new Blob([o],{type:"text/csv;charset=utf-8;"});i(l,`plantas-${s(new Date)}.csv`)}catch(r){throw new Error("Failed to export data as CSV")}finally{t(!1)}})(e);default:throw new Error("Formato de exportación no soportado")}},isExporting:e,getExportSize:()=>{const e=1024*a.length,t=e/1048576;return{plantCount:a.length,estimatedSize:t>1?`${t.toFixed(1)} MB`:`${Math.round(e/1024)} KB`}},createAutoBackup:async()=>{try{const e=localStorage.getItem("last-auto-backup"),t=(new Date).getTime(),a=6048e5;(!e||t-parseInt(e)>a)&&(await r({format:"json",includeImages:!1,includeChats:!1}),localStorage.setItem("last-auto-backup",t.toString()))}catch(e){}},availableFormats:["json","csv"]}},ne=({isOpen:t,onClose:a})=>{const[s,u]=f.useState("json"),[m,g]=f.useState(!0),[p,x]=f.useState(!1),{exportData:h,isExporting:b,getExportSize:y}=se(),{showSuccess:j,showError:v}=I(),{plantCount:w,estimatedSize:N}=y();return t?e.jsx(D,{children:e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs(k.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},onClick:e=>e.stopPropagation(),className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl max-w-lg w-full max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:e.jsx(n,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"Exportar Datos"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Descarga una copia de tus datos de plantas"})]})]}),e.jsx("button",{onClick:a,disabled:b,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors p-1","aria-label":"Cerrar modal",children:e.jsx(r,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Plantas a exportar:"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:w})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Tamaño estimado:"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:N})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Formato de archivo"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{onClick:()=>u("json"),disabled:b,className:`\n                    p-4 rounded-lg border-2 transition-all text-left\n                    ${"json"===s?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}\n                  `,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{className:"w-5 h-5 "+("json"===s?"text-blue-600":"text-gray-500")}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium "+("json"===s?"text-blue-900 dark:text-blue-100":"text-gray-900 dark:text-gray-100"),children:"JSON"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Completo, reimportable"})]})]})}),e.jsx("button",{onClick:()=>u("csv"),disabled:b,className:`\n                    p-4 rounded-lg border-2 transition-all text-left\n                    ${"csv"===s?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}\n                  `,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{className:"w-5 h-5 "+("csv"===s?"text-blue-600":"text-gray-500")}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium "+("csv"===s?"text-blue-900 dark:text-blue-100":"text-gray-900 dark:text-gray-100"),children:"CSV"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Para Excel/Sheets"})]})]})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Incluir en la exportación"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:e=>g(e.target.checked),disabled:b,className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx(l,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Metadatos de imágenes"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer opacity-50",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:e=>x(e.target.checked),disabled:!0,className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx(c,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Historial de chat (próximamente)"})]})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(d,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-blue-800 dark:text-blue-200 font-medium mb-1",children:"Sobre la exportación"}),e.jsx("p",{className:"text-blue-700 dark:text-blue-300 leading-relaxed",children:"Los datos exportados incluyen toda la información de tus plantas: nombres, especies, cuidados, fechas de riego y ubicaciones. Las imágenes se incluyen como referencias URL."})]})]})})]}),e.jsxs("div",{className:"p-6 border-t border-gray-200 dark:border-gray-700 flex gap-3 justify-end",children:[e.jsx(C,{variant:"outline",onClick:a,disabled:b,children:"Cancelar"}),e.jsxs(C,{onClick:async()=>{try{await h({format:s,includeImages:m,includeChats:p}),j("Exportación completada",`Se descargaron los datos de ${w} plantas en formato ${s.toUpperCase()}.`),a()}catch(e){v("Error en la exportación",e instanceof Error?e.message:"No se pudo completar la exportación.")}},disabled:b||0===w,loading:b,className:"flex items-center gap-2",children:[e.jsx(n,{className:"w-4 h-4"}),b?"Exportando...":"Exportar Datos"]})]})]})})}):null},re={User:y,LogOut:b,Sun:h,Moon:x,Bell:p,Download:n,Trash2:g,HelpCircle:m,Shield:u,Info:d};var ie=()=>{const{settingsSections:t,isExportModalOpen:a,setIsExportModalOpen:s}=(()=>{const{isDark:e,toggleTheme:t}=v(),{signOut:a,profile:s}=w(),n=E(),[r,i]=f.useState(!1),o=async()=>{if(window.confirm("¿Estás seguro de que quieres cerrar sesión?"))try{await a(),n("/auth")}catch(e){}},l=()=>{i(!0)},c=async()=>{if(window.confirm("¿Estás seguro de que quieres eliminar todos tus datos? Esta acción es irreversible."))try{await Z.clearAllData(),await o()}catch(e){}};return{settingsSections:f.useMemo(()=>[{title:"Cuenta",items:[{id:"signout",icon:"LogOut",label:"Cerrar sesión",type:"button",onClick:o}]},{title:"Preferencias",items:[{id:"theme",icon:e?"Sun":"Moon",label:"Modo Oscuro",type:"toggle",toggleState:e,onToggleChange:t}]},{title:"Datos",items:[{id:"export",icon:"Download",label:"Exportar mis datos",type:"button",onClick:l,disabled:!s||!1},{id:"delete",icon:"Trash2",label:"Eliminar mis datos",type:"button",onClick:c,disabled:!s||!1}]},{title:"Soporte",items:[]}],[e,s,o,t]),isExportModalOpen:r,setIsExportModalOpen:i}})();return e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Configuración"}),e.jsx("p",{className:"text-muted-foreground",children:"Gestiona tu cuenta y preferencias de la app."})]}),t.map((t,a)=>e.jsx(ee,{title:t.title,delay:a,children:t.items.map((a,s)=>{const n=re[a.icon],r=s===t.items.length-1;return"toggle"===a.type?e.jsx(ae,{icon:n,label:a.label,isLast:r,type:"toggle",toggleState:"toggleState"in a&&a.toggleState,onToggleChange:"onToggleChange"in a?a.onToggleChange:void 0},a.id):e.jsx(ae,{icon:n,label:a.label,value:"value"in a&&"string"==typeof a.value?a.value:void 0,onClick:"onClick"in a?a.onClick:void 0,isLast:r,type:"button",disabled:"disabled"in a&&a.disabled},a.id)})},t.title)),e.jsx(ne,{isOpen:a,onClose:()=>s(!1)})]})};export{ie as default};
//# sourceMappingURL=Settings-zUraLGWs.js.map
