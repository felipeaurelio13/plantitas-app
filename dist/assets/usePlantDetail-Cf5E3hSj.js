import{c as v,y as m,r as g,s as D}from"./index-fgwvdg1Q.js";import{r as u,t as d,b as p,u as w}from"./index-BCksga6S.js";/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=v("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);function h(t){u(1,arguments);var e=d(t);return e.setHours(0,0,0,0),e}var _=864e5;function P(t,e){u(2,arguments);var r=h(t),a=h(e),s=r.getTime()-p(r),l=a.getTime()-p(a);return Math.round((s-l)/_)}function y(t,e){var r=t.getFullYear()-e.getFullYear()||t.getMonth()-e.getMonth()||t.getDate()-e.getDate()||t.getHours()-e.getHours()||t.getMinutes()-e.getMinutes()||t.getSeconds()-e.getSeconds()||t.getMilliseconds()-e.getMilliseconds();return r<0?-1:r>0?1:r}function M(t,e){u(2,arguments);var r=d(t),a=d(e),s=y(r,a),l=Math.abs(P(r,a));r.setDate(r.getDate()-s*l);var c=+(y(r,a)===-s),i=s*(l-c);return i===0?0:i}const A=async t=>{const{data:e,error:r}=await D.from("plants").select(`
      *,
      plant_images(*)
    `).eq("id",t).single();if(r)throw console.error(`Error fetching plant ${t}:`,r),r.code==="PGRST116"?new Error("Planta no encontrada."):new Error("Error al cargar la información de la planta.");const a=e;return{id:a.id,name:a.name,species:a.species,description:a.description??void 0,variety:a.variety??void 0,nickname:a.nickname??void 0,location:a.location,dateAdded:new Date(a.date_added),lastWatered:a.last_watered?new Date(a.last_watered):void 0,lastFertilized:a.last_fertilized?new Date(a.last_fertilized):void 0,healthScore:a.health_score??0,careProfile:a.care_profile,personality:a.personality,images:a.plant_images.map(s=>({id:s.id,url:s.url??"",timestamp:new Date(s.created_at),isProfileImage:s.is_profile_image??!1,healthAnalysis:s.health_analysis})),chatHistory:[],notifications:[]}},I=t=>{const{data:e,isLoading:r,error:a}=w({queryKey:["plant",t],queryFn:()=>A(t),enabled:!!t}),s=m(i=>i.setPlant),l=m(i=>i.selectPlant);g.useEffect(()=>(e&&(s(e),l(e.id)),()=>{l(null)}),[e,s,l]);const c=g.useMemo(()=>{if(!e)return[];const i=[];if(!e.images||e.images.length===0)return i;const f=e.images.map(n=>{var o;return((o=n.healthAnalysis)==null?void 0:o.confidence)||null}).filter(n=>n!==null);if(f.length>=3){const n=f.slice(-3);if(n[0]>n[1]&&n[1]>n[2]){const o=n[0]-n[2];i.push({type:"warning",title:"Tendencia de Salud a la Baja",message:`La salud de tu planta ha disminuido un ${o.toFixed(0)}% en las últimas revisiones.`})}}if(e.lastWatered&&e.careProfile){const n=M(new Date,new Date(e.lastWatered)),o=e.careProfile.wateringFrequency;n>o&&i.push({type:"tip",title:"Consejo de Riego",message:`Han pasado ${n} días desde el último riego. El intervalo recomendado es de ${o} días.`})}return i},[e]);return{plant:e,insights:c,loading:r,error:(a==null?void 0:a.message)||null}};export{F as A,I as u};
