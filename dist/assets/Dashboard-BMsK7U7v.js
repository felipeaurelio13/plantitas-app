import{c as k,u as T,p as O,a as b,j as e,m as o,T as M,r as h,t as w,C as D,L as F}from"./index-CRH81Qhq.js";import{u as B,L as R}from"./index-ULWBGHfb.js";import{f as $,l as U,I as q}from"./Input-BaS-CeSY.js";import{C,L as Q,a as S,b as H,c as I,d as A,D as L,S as x,W as G}from"./skeleton-Dg9MFGaK.js";import{B as z,A as f}from"./Button-CSly8ce6.js";import{S as J}from"./sun-C-cm-VOR.js";import{u as K}from"./usePlantMutations-eoVsyAqo.js";import{I as Z}from"./image-Dfpa8soe.js";/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=k("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y=k("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),V=()=>{const a=T(l=>l.user);return B({queryKey:["plants",a==null?void 0:a.id],queryFn:()=>a?O.getUserPlantSummaries(a.id):Promise.resolve([]),enabled:!!a,staleTime:1e3*60*5,refetchOnWindowFocus:!0})},X=({score:a})=>{const l=a>=80?"bg-green-500":a>=60?"bg-yellow-500":"bg-red-500";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"relative w-16 h-1.5 bg-neutral-200 dark:bg-neutral-700 rounded-full overflow-hidden",children:e.jsx(o.div,{className:`absolute top-0 left-0 h-full rounded-full ${l}`,initial:{width:0},animate:{width:`${a}%`},transition:{duration:.8,ease:"easeOut"}})}),e.jsxs("span",{className:"text-xs font-semibold text-text-secondary",children:[a,"%"]})]})},Y=({plant:a,index:l})=>{const n=b(),c=a.lastWatered&&a.wateringFrequency?new Date().getTime()-new Date(a.lastWatered).getTime()>a.wateringFrequency*24*60*60*1e3:!a.lastWatered,t=()=>n(`/plant/${a.id}`),d=g=>{g.stopPropagation(),n(`/plant/${a.id}/chat`)};return e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:l*.1,duration:.5,ease:"easeOut"},children:e.jsxs(C,{variant:"elevated",padding:"none",interactive:!0,onClick:t,className:"overflow-hidden",children:[e.jsxs("div",{className:"flex items-start p-4 space-x-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-lg overflow-hidden bg-neutral-100 dark:bg-neutral-800 flex-shrink-0",children:a.profileImageUrl?e.jsx(Q,{src:a.profileImageUrl,alt:a.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-text-muted",children:e.jsx(J,{size:32})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(S,{className:"p-0",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(H,{className:"truncate text-lg",children:a.nickname||a.name}),e.jsxs("p",{className:"text-sm text-text-muted truncate",children:[a.species," • ",a.location]})]}),c&&e.jsx("div",{className:"flex-shrink-0 ml-2",children:e.jsx(M,{className:"w-5 h-5 text-yellow-500 animate-pulse"})})]})}),e.jsx(I,{className:"p-0 mt-3",children:e.jsx(X,{score:a.healthScore})})]})]}),e.jsx(A,{className:"bg-neutral-50 dark:bg-neutral-800/50 p-2 border-t border-subtle",children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("div",{className:"flex items-center gap-1 text-xs text-text-muted",children:a.lastWatered&&e.jsxs(e.Fragment,{children:[e.jsx(L,{size:12}),e.jsxs("span",{children:["Regada ",$(new Date(a.lastWatered),{addSuffix:!0,locale:U})]})]})}),e.jsx(z,{size:"sm",variant:"ghost",onClick:d,children:e.jsx(_,{size:14})})]})})]})})},ee=()=>e.jsxs(C,{variant:"elevated",padding:"none",className:"overflow-hidden",children:[e.jsxs("div",{className:"flex items-start p-4 space-x-4",children:[e.jsx(x,{className:"w-20 h-20 rounded-lg flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(S,{className:"p-0",children:[e.jsx(x,{className:"h-6 w-3/4"}),e.jsx(x,{className:"h-4 w-1/2 mt-2"})]}),e.jsx(I,{className:"p-0 mt-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"w-16 h-1.5"}),e.jsx(x,{className:"w-8 h-3"})]})})]})]}),e.jsx(A,{className:"bg-neutral-50 dark:bg-neutral-800/50 p-2 border-t border-subtle",children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx(x,{className:"h-4 w-1/3"}),e.jsx(x,{className:"w-8 h-8 rounded"})]})})]}),ae=()=>{const[a,l]=h.useState(!1),n=b(),{createPlant:c,isCreatingPlant:t}=K();h.useEffect(()=>{const s=i=>{i.key==="Escape"&&l(!1)};return a&&document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[a]);const d=[{id:"camera",icon:D,label:"Tomar Foto",color:"bg-blue-500",action:()=>{l(!1),n("/camera")}},{id:"gallery",icon:Z,label:"Galería",color:"bg-purple-500",action:()=>j()},{id:"manual",icon:y,label:"Añadir Manualmente",color:"bg-green-500",action:()=>{l(!1),n("/add-plant/manual")}}],g=h.useCallback(s=>{const i=new FileReader;i.onload=m=>{var N;const E=(N=m.target)==null?void 0:N.result,v=window.prompt("¿Dónde está ubicada tu planta? (Ej: Interior, Balcón, Oficina)","Interior");if(!v){w.error("La ubicación es necesaria para continuar."),l(!1);return}const P=new Promise((p,W)=>{c({imageDataUrl:E,location:v},{onSuccess:u=>{u!=null&&u.id&&n(`/plant/${u.id}`),p(u)},onError:u=>W(u)})});w.promise(P,{loading:"Analizando imagen...",success:p=>`¡Planta "${p.name}" creada con éxito!`,error:p=>`Error: ${p.message}`}),l(!1)},i.readAsDataURL(s)},[c,n]),j=()=>{const s=document.createElement("input");s.type="file",s.accept="image/*",s.onchange=i=>{const m=i.target;m.files&&m.files[0]&&g(m.files[0])},s.click()},r=t?R:y;return e.jsxs("div",{className:"fixed bottom-20 right-4 z-50",children:[e.jsx(f,{children:a&&e.jsx(o.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.2)",zIndex:40},onClick:()=>l(!1)})}),e.jsx(f,{children:a&&e.jsx("div",{className:"absolute bottom-16 right-0 space-y-3",children:d.map((s,i)=>e.jsxs(o.button,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1,transition:{delay:i*.1}},exit:{scale:0,opacity:0,transition:{delay:(d.length-i)*.05}},onClick:s.action,disabled:t,style:{backgroundColor:s.color.includes("blue")?"#3b82f6":"#8b5cf6",color:"white",border:"none",borderRadius:"12px",padding:"12px",display:"flex",alignItems:"center",gap:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",cursor:t?"not-allowed":"pointer",minWidth:"140px"},children:[e.jsx(s.icon,{size:20}),e.jsx("span",{className:"text-sm font-medium",children:s.label})]},s.id))})}),e.jsx(o.button,{"aria-label":t?"Agregando planta":a?"Cerrar menú":"Agregar planta",onClick:()=>!t&&l(!a),disabled:t,style:{backgroundColor:"#22c55e",color:"white",border:"none",borderRadius:"50%",width:"56px",height:"56px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 10px 25px -3px rgba(0, 0, 0, 0.1)",cursor:t?"not-allowed":"pointer"},whileHover:{scale:t?1:1.05},whileTap:{scale:t?1:.95},animate:{rotate:a?45:0},children:e.jsx(r,{size:24,className:t?"animate-spin":""})}),e.jsx(f,{children:a&&e.jsx(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},style:{position:"fixed",bottom:"160px",right:"16px",left:"16px",zIndex:50},children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-xl border border-gray-200 dark:border-gray-700 mx-auto max-w-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-2",children:t?"Analizando tu planta...":"Agregar Nueva Planta"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:t?"Estamos identificando la especie y su estado de salud. ¡Un momento!":"Toma una foto o selecciona desde galería para identificar automáticamente tu planta"})]})})})})]})},se=()=>{const a=b();return e.jsxs(o.div,{className:"flex flex-col items-center justify-center text-center py-16 px-6",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5,ease:"easeOut"},children:[e.jsxs(o.div,{className:"relative w-24 h-24 mb-6",initial:{rotate:-15},animate:{rotate:[15,-10,10,-5,5,0]},transition:{duration:1,ease:"easeInOut"},children:[e.jsx(G,{className:"absolute top-0 left-0 w-8 h-8 text-sky-400 opacity-60"}),e.jsx(F,{className:"w-24 h-24 text-green-500"}),e.jsx(L,{className:"absolute bottom-0 right-0 w-10 h-10 text-blue-400 opacity-70"})]}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100 mb-2",children:"Tu jardín está vacío"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 max-w-sm mb-6",children:"Añade tu primera planta para empezar a monitorizar su salud y cuidados."}),e.jsxs(z,{size:"lg",onClick:()=>a("/camera"),children:[e.jsx(y,{className:"mr-2"}),"Añadir Planta"]})]})},me=()=>{const{data:a=[],isLoading:l,error:n}=V(),[c,t]=h.useState(""),[d,g]=h.useState("name"),j=h.useMemo(()=>[...a].filter(r=>r.name.toLowerCase().includes(c.toLowerCase())||r.species.toLowerCase().includes(c.toLowerCase())).sort((r,s)=>{var i,m;switch(d){case"health":return(s.healthScore||0)-(r.healthScore||0);case"lastWatered":return(((i=s.lastWatered)==null?void 0:i.getTime())||0)-(((m=r.lastWatered)==null?void 0:m.getTime())||0);default:return r.name.localeCompare(s.name)}}),[a,c,d]);return l?e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100",children:"Mi Jardín"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Buscando tus plantas..."})]}),e.jsx(x,{className:"h-10 w-10 rounded-full"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:Array.from({length:8}).map((r,s)=>e.jsx(ee,{},s))})]}):n?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsxs("div",{className:"text-xl text-red-500 text-center",children:[e.jsx("p",{children:"Ocurrió un error al cargar tus plantas:"}),e.jsx("p",{className:"text-sm mt-2",children:n.message})]})}):e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100",children:"Mi Jardín"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:[a.length," ",a.length===1?"planta":"plantas"," en tu colección"]})]}),e.jsx(ae,{})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx(q,{type:"text",placeholder:"Buscar por nombre o especie...",value:c,onChange:r=>t(r.target.value),className:"flex-grow"}),e.jsxs("select",{value:d,onChange:r=>g(r.target.value),className:"bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg px-4 py-2 h-10 text-gray-800 dark:text-gray-200 focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:"name",children:"Ordenar por Nombre"}),e.jsx("option",{value:"health",children:"Ordenar por Salud"}),e.jsx("option",{value:"lastWatered",children:"Ordenar por Riego"})]})]}),e.jsx(f,{children:j.length>0?e.jsx(o.div,{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",initial:"hidden",animate:"visible",variants:{visible:{transition:{staggerChildren:.05}}},children:j.map((r,s)=>e.jsx(Y,{plant:r,index:s},r.id))}):e.jsx(se,{})})]})};export{me as default};
