var Y=Object.defineProperty;var X=(a,t,s)=>t in a?Y(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var P=(a,t,s)=>X(a,typeof t!="symbol"?t+"":t,s);import{z as T,ab as Z,aq as K,aa as J,u as ee,r as h,j as e,m as l,a1 as A,R as L,a2 as ae,a as Q,n as E,A as I,a3 as S,Q as F,T as te,E as se}from"./index-S10IpQsS.js";import{B as k,S as G}from"./Button-sPj853_b.js";import{C as _,c as q}from"./Card-XIBIngO6.js";import{A as re}from"./index-DYDrsITg.js";import{S as B,A as ne,E as ie,L as le,M as oe}from"./sprout-DUn4usMi.js";import{a as H}from"./eye-By5j0b1s.js";import{f as ce,l as de,C as ue,S as me,T as xe}from"./TypingIndicator-BYdIlf2r.js";import{U as he}from"./user-B5kBmn6I.js";import{I as pe}from"./Input-5sD0LM7-.js";/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=T("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=T("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);class fe{constructor(t,s){P(this,"supabase");P(this,"cache");this.supabase=t,this.cache=s}async sendMessage(t,s,r){try{const{data:{session:n},error:c}=await this.supabase.auth.getSession();if(c||!(n!=null&&n.access_token))throw console.error("User session not available:",c),new Error("Usuario no autenticado. Por favor inicia sesi√≥n nuevamente.");const{data:m,error:i}=await this.supabase.functions.invoke("garden-ai-chat",{body:{message:t,sessionId:s,userId:r},headers:{Authorization:`Bearer ${n.access_token}`}});if(i)throw new Error(`Garden AI service error: ${i.message}`);if(!m)throw new Error("No data received from garden AI service");return m}catch(n){throw console.error("Error in garden chat service:",n),n}}async sendMessageToGardenAI(t,s,r){try{const n=await this.buildGardenContext(s),c=r.map(u=>({role:u.sender==="user"?"user":"assistant",content:u.content})),m="amigable, motivador, experto, c√°lido, y con un toque de humor ligero",{data:{session:i},error:o}=await this.supabase.auth.getSession();if(o||!(i!=null&&i.access_token))throw console.error("User session not available:",o),new Error("Usuario no autenticado. Por favor inicia sesi√≥n nuevamente.");const{data:x,error:j}=await this.supabase.functions.invoke("garden-ai-chat",{body:{userMessage:t,gardenContext:n,conversationHistory:c,tonePersona:m},headers:{Authorization:`Bearer ${i.access_token}`}});if(j)throw new Error(`Garden AI service error: ${j.message}`);if(!x)throw new Error("No data received from garden AI service");const g=typeof x=="string"?JSON.parse(x):x,y=(g.content||"").toLowerCase();return(!g.content||y.includes("no s√©")||y.includes("no tengo informaci√≥n")||y.includes("no puedo ayudarte")||y.length<30)&&J.warning("Respuesta gen√©rica","La respuesta de la IA fue muy gen√©rica o poco √∫til. Intenta preguntar de otra forma o proporciona m√°s detalles."),{content:g.content||"Lo siento, no pude procesar tu mensaje.",insights:g.insights||[],suggestedActions:g.suggestedActions||[]}}catch(n){throw n}}async verifyFunctionAvailability(){try{const t={userMessage:"ping",gardenContext:{totalPlants:0,plantsData:[],averageHealthScore:0,commonIssues:[],careScheduleSummary:{needsWatering:[],needsFertilizing:[],healthConcerns:[]},environmentalFactors:{locations:["test"]}},conversationHistory:[]},{data:{session:s},error:r}=await this.supabase.auth.getSession();if(r||!(s!=null&&s.access_token))throw console.error("User session not available:",r),new Error("Usuario no autenticado. Por favor inicia sesi√≥n nuevamente.");const{data:n,error:c}=await this.supabase.functions.invoke("garden-ai-chat",{body:t,headers:{Authorization:`Bearer ${s.access_token}`}});return c?c.message.includes("404")||c.message.includes("not found")?{available:!1,error:"La funci√≥n de chat de jard√≠n no est√° disponible en este momento"}:{available:!1,error:c.message}:n&&typeof n.content=="string"?{available:!0}:{available:!1,error:"Function returned unexpected response format"}}catch(t){return{available:!1,error:t instanceof Error?t.message:"Error desconocido"}}}async getGardenHealthSummary(t){try{const s=this.cache.getGardenSummary(t);if(s)return s;const r=await this.buildGardenContext(t),n=r.plantsData.filter(i=>i.healthScore>=80).length,c=r.careScheduleSummary.needsWatering.length+r.careScheduleSummary.healthConcerns.length,m={totalPlants:r.totalPlants,averageHealth:r.averageHealthScore,urgentActions:c,healthyPlants:n};return this.cache.setGardenSummary(t,m),m}catch(s){throw console.error("Error getting garden health summary:",s),s}}async getSuggestedQuestions(t){try{const s=await this.buildGardenContext(t),r=[];return s.totalPlants===0?(r.push("¬øC√≥mo agrego mi primera planta?"),r.push("¬øQu√© tipo de planta me recomiendas para empezar?"),r):(r.push("¬øCu√°ntas plantas tengo y c√≥mo est√°n?"),r.push("¬øCu√°l es la salud promedio de mi jard√≠n?"),s.careScheduleSummary.healthConcerns.length>0&&(r.push("¬øQu√© plantas necesitan atenci√≥n especial?"),r.push("¬øQu√© problemas de salud hay en mi jard√≠n?")),s.plantsData.some(n=>n.healthScore>=80)&&r.push("¬øCu√°les de mis plantas est√°n m√°s sanas?"),s.environmentalFactors.locations.length>1&&r.push("¬øC√≥mo afecta la ubicaci√≥n a mis plantas?"),s.totalPlants>5&&r.push("¬øC√≥mo organizar mejor mi espacio de plantas?"),s.plantsData.some(n=>"lastFertilized"in n&&!!n.lastFertilized)&&r.push("¬øCu√°ndo debo fertilizar mis plantas?"),new Set(s.plantsData.map(n=>n.species)).size>1&&r.push("¬øQu√© especie de planta es la m√°s resistente en mi jard√≠n?"),r.slice(0,6))}catch(s){return console.error("Error getting suggested questions:",s),["¬øCu√°ntas plantas tengo y c√≥mo est√°n?","¬øCu√°l es la salud promedio de mi jard√≠n?"]}}async refreshGardenData(t){try{this.invalidateCache(t),await this.buildGardenContext(t),console.log("[GardenChatService] Garden data refreshed for user:",t)}catch(s){throw console.error("Error refreshing garden data:",s),s}}async buildGardenContext(t){try{const s=this.cache.getGardenContext(t);if(s)return s;const{data:r,error:n}=await this.supabase.from("plants").select(`
          id,
          name,
          nickname,
          species,
          location,
          plant_environment,
          light_requirements,
          health_score,
          last_watered,
          last_fertilized,
          care_profile,
          date_added
        `).eq("user_id",t).order("created_at",{ascending:!1});if(n)throw n;const c=r.map(u=>{var b;return{id:u.id,name:u.name,nickname:u.nickname||void 0,species:u.species,location:u.location,plantEnvironment:u.plant_environment,lightRequirements:u.light_requirements,healthScore:u.health_score||85,lastWatered:u.last_watered?new Date(u.last_watered):void 0,wateringFrequency:(b=u.care_profile)==null?void 0:b.wateringFrequency}}),m=c.length,i=m>0?Math.round(c.reduce((u,b)=>u+b.healthScore,0)/m):0,o=new Date,x=[],j=[],g=[];c.forEach(u=>{if(u.lastWatered&&u.wateringFrequency){const b=new Date(u.lastWatered),w=new Date(b);w.setDate(b.getDate()+u.wateringFrequency),o>w&&x.push(u.id)}u.healthScore<70&&g.push(u.id)});const y=[...new Set(c.map(u=>u.location))],d={totalPlants:m,plantsData:c,averageHealthScore:i,commonIssues:[],careScheduleSummary:{needsWatering:x,needsFertilizing:j,healthConcerns:g},environmentalFactors:{locations:y,lightConditions:[],humidityNeeds:[]}};return this.cache.setGardenContext(t,d),d}catch(s){throw console.error("Error building garden context:",s),s}}invalidateCache(t){this.cache.invalidateCache(t),console.log("Cache invalidated for user:",t)}}const v=new fe(Z,K),ye=()=>{const{user:a}=ee(),[t,s]=h.useState([]),[r,n]=h.useState(!1),[c,m]=h.useState(!1),[i,o]=h.useState(null),[x,j]=h.useState(null),[g,y]=h.useState([]),[d,u]=h.useState("");h.useEffect(()=>{a!=null&&a.id&&b()},[a==null?void 0:a.id]);const b=async()=>{if(a!=null&&a.id){n(!0);try{const[p,z]=await Promise.all([v.getGardenHealthSummary(a.id),v.getSuggestedQuestions(a.id)]);if(j(p),y(z),t.length===0&&p.totalPlants>0){const D={id:`welcome-${Date.now()}`,sender:"ai",content:`¬°Hola! Soy tu asistente de jard√≠n üå± 

Veo que tienes ${p.totalPlants} plantas en tu jard√≠n con una salud promedio de ${p.averageHealth}%. ${p.urgentActions>0?`Hay ${p.urgentActions} acciones que podr√≠an necesitar tu atenci√≥n.`:"¬°Todo parece estar en buen estado!"}

¬øEn qu√© puedo ayudarte hoy con tu jard√≠n?`,timestamp:new Date,context:{queryType:"general"}};s([D])}}catch(p){console.error("Error loading initial garden data:",p),o("Error al cargar la informaci√≥n del jard√≠n")}finally{n(!1)}}},w=h.useCallback(async p=>{if(!(a!=null&&a.id)||!p.trim()||c)return;const z=await v.verifyFunctionAvailability();if(!z.available){o(`üöß El chat de jard√≠n no est√° disponible: ${z.error}`);return}const D={id:`user-${Date.now()}`,sender:"user",content:p.trim(),timestamp:new Date};u(p.trim()),s(f=>[...f,D]),m(!0),o(null);try{const f=await v.sendMessageToGardenAI(p.trim(),a.id,t),N={id:`ai-${Date.now()}`,sender:"ai",content:f.content,timestamp:new Date,context:{plantsAnalyzed:je(f),queryType:be(p),insights:f.insights||[],suggestedActions:f.suggestedActions||[]}};if(s(C=>[...C,N]),f.suggestedActions&&f.suggestedActions.length>0){const C=await v.getGardenHealthSummary(a.id);j(C)}}catch(f){console.error("Error sending message to garden AI:",f);let N="Error al enviar el mensaje. Por favor intenta de nuevo.";f instanceof Error&&(f.message.includes("funci√≥n de chat de jard√≠n no est√° disponible")?N="üöß El chat de jard√≠n est√° temporalmente no disponible. Estamos trabajando para solucionarlo.":f.message.includes("CORS")?N="üîß Error de configuraci√≥n. Por favor contacta al administrador.":f.message.includes("garden-ai-chat no existe")&&(N="‚ö†Ô∏è Servicio no configurado. El chat de jard√≠n necesita configuraci√≥n adicional.")),o(N),s(C=>C.slice(0,-1))}finally{m(!1)}},[a==null?void 0:a.id,t,c]),$=h.useCallback(async()=>{d&&await w(d)},[d,w]),W=h.useCallback(()=>{s([]),o(null),a!=null&&a.id&&b()},[a==null?void 0:a.id]),U=h.useCallback(async()=>{if(a!=null&&a.id){n(!0);try{await v.refreshGardenData(a.id),await b(),console.log("[useGardenChat] Garden data refreshed successfully")}catch(p){console.error("Error refreshing garden data:",p),o("Error al actualizar los datos del jard√≠n")}finally{n(!1)}}},[a==null?void 0:a.id]),O=h.useMemo(()=>r,[r]),V=h.useMemo(()=>{},[a==null?void 0:a.id,x]);return{messages:t,isLoading:O,isTyping:c,error:i,gardenSummary:x,suggestedQuestions:g,sendMessage:w,clearMessages:W,retryLastMessage:$,refreshGardenData:U,cacheStats:V}};function je(a){const t=[];return a.insights&&a.insights.forEach(s=>{s.affectedPlants&&t.push(...s.affectedPlants)}),a.suggestedActions&&a.suggestedActions.forEach(s=>{s.plantIds&&t.push(...s.plantIds)}),[...new Set(t)]}function be(a){const t=a.toLowerCase();return t.includes("salud")||t.includes("problema")||t.includes("enferm")?"health_analysis":t.includes("comparar")||t.includes("diferencia")||t.includes("mejor")?"care_comparison":t.includes("hongo")||t.includes("plaga")||t.includes("prevenir")?"disease_prevention":t.includes("crecimiento")||t.includes("progreso")||t.includes("tiempo")?"growth_tracking":"general"}const ve=({onClose:a})=>{const[t,s]=h.useState([{name:"garden-ai-chat",available:!1}]),[r,n]=h.useState(!1),c=async()=>{n(!0);const o=[],x=await v.verifyFunctionAvailability();o.push({name:"garden-ai-chat",available:x.available,error:x.error,lastChecked:new Date}),s(o),n(!1)};h.useEffect(()=>{c()},[]);const m=o=>o.available?e.jsx(ae,{className:"w-5 h-5 text-green-500"}):e.jsx(A,{className:"w-5 h-5 text-red-500"}),i=o=>o.available?"Disponible":"No disponible";return e.jsx(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:a,children:e.jsx(l.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:o=>o.stopPropagation(),className:"w-full max-w-md",children:e.jsxs(_,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(R,{className:"w-6 h-6 text-blue-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Diagn√≥stico del Sistema"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Estado de Funciones Edge"}),e.jsx("div",{className:"space-y-3",children:t.map(o=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[m(o),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:o.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i(o)})]})]}),o.error&&e.jsxs("div",{className:"text-xs text-red-500 max-w-32 text-right",children:[o.error.substring(0,50),"..."]})]},o.name))})]}),t.some(o=>!o.available)&&e.jsx(l.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-yellow-800 dark:text-yellow-200",children:"Servicios no disponibles"}),e.jsx("p",{className:"text-yellow-700 dark:text-yellow-300 mt-1",children:"Algunos servicios del chat de jard√≠n no est√°n funcionando. Verifica que las funciones Edge est√©n desplegadas en Supabase."})]})]})}),e.jsxs("div",{className:"flex gap-3 pt-3",children:[e.jsxs(k,{onClick:c,disabled:r,variant:"outline",size:"sm",className:"flex-1 gap-2",children:[e.jsx(L,{className:`w-4 h-4 ${r?"animate-spin":""}`}),"Verificar Nuevamente"]}),e.jsx(k,{onClick:a,variant:"secondary",size:"sm",className:"flex-1",children:"Cerrar"})]})]})]})})})},M=({gardenSummary:a,onClearChat:t,onRefresh:s,isRefreshing:r=!1})=>{const n=Q(),[c,m]=h.useState(!1),i=x=>x>=80?"text-green-500":x>=60?"text-green-400":"text-red-500",o=x=>x>=80?"Excelente":x>=60?"Buena":"Necesita atenci√≥n";return e.jsxs("header",{className:"sticky top-0 z-10 bg-background/80 backdrop-blur-sm border-b border-muted",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 pt-safe-top",children:[e.jsx("button",{onClick:()=>n(E.toDashboard()),className:"p-2 -ml-2 rounded-full hover:bg-muted transition-colors","aria-label":"Volver al dashboard",children:e.jsx(re,{size:20})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-full",children:e.jsx(B,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-foreground tracking-[0.2px]",children:"Asistente de Jard√≠n"}),a&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-neutral-600 dark:text-neutral-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ne,{size:12}),a.totalPlants," plantas"]}),e.jsx("span",{className:`font-medium ${i(a.averageHealth)} text-xs px-2 py-0.5 rounded-full`,style:{fontSize:"11px",padding:"2px 8px"},children:o(a.averageHealth)}),a.urgentActions>0&&e.jsxs(l.span,{className:"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 px-2 py-0.5 rounded-full text-xs font-medium",style:{fontSize:"11px",padding:"2px 8px"},initial:{scale:0},animate:{scale:1},transition:{delay:.2},children:[a.urgentActions," acciones"]})]})]})]})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>m(!0),className:"p-2 rounded-full hover:bg-muted transition-colors","aria-label":"Diagn√≥stico del sistema",children:e.jsx(R,{size:18})}),s&&e.jsx("button",{onClick:s,disabled:r,className:"p-2 rounded-full hover:bg-muted transition-colors disabled:opacity-50","aria-label":"Actualizar datos del jard√≠n",children:e.jsx(l.div,{animate:r?{rotate:360}:{},transition:r?{duration:1,repeat:1/0,ease:"linear"}:{},children:e.jsx(L,{size:18})})}),e.jsx("button",{onClick:t,className:"p-2 rounded-full hover:bg-muted transition-colors","aria-label":"Opciones del chat",children:e.jsx(ie,{size:20})})]})]}),e.jsx(I,{children:c&&e.jsx(ve,{onClose:()=>m(!1)})})]})},we=({message:a})=>{var n,c,m;const t=a.sender==="user",s=()=>{var i;if(!((i=a.context)!=null&&i.queryType))return e.jsx(F,{size:16});switch(a.context.queryType){case"health_analysis":return e.jsx(te,{size:16});case"care_comparison":return e.jsx(H,{size:16});case"disease_prevention":return e.jsx(ge,{size:16});case"growth_tracking":return e.jsx(le,{size:16});default:return e.jsx(F,{size:16})}},r=()=>{var i;if(t)return"text-primary-foreground/70";if(!((i=a.context)!=null&&i.queryType))return"text-green-500";switch(a.context.queryType){case"health_analysis":return"text-red-500";case"care_comparison":return"text-blue-500";case"disease_prevention":return"text-orange-500";case"growth_tracking":return"text-purple-500";default:return"text-green-500"}};return e.jsxs(l.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:S("flex items-end gap-2 max-w-[85%]",t?"justify-end ml-auto":"justify-start"),children:[!t&&e.jsx(l.div,{className:S("flex h-8 w-8 items-center justify-center rounded-full","bg-gradient-to-br from-green-100 to-green-200 dark:from-green-900/30 dark:to-green-800/30"),initial:{scale:0},animate:{scale:1},transition:{delay:.1},children:e.jsx("div",{className:r(),children:s()})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:S("rounded-2xl px-4 py-3 break-words shadow-adaptive",t?"rounded-br-lg bg-primary-700 text-white drop-shadow-sm ml-8":"rounded-bl-lg bg-contrast-surface text-contrast-medium mr-8 border border-contrast","rounded-[12px]"),children:[e.jsx("div",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:a.content}),((n=a.context)==null?void 0:n.insights)&&a.context.insights.length>0&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"font-semibold text-xs text-green-700 dark:text-green-300",children:"Recomendaciones y observaciones:"}),e.jsx("ul",{className:"space-y-1",children:a.context.insights.map((i,o)=>e.jsxs("li",{className:"text-xs bg-green-50 dark:bg-green-900/20 rounded-lg p-2 border border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"font-medium",children:[i.type==="warning"&&"‚ö†Ô∏è ",i.type==="tip"&&"üí° ",i.type==="recommendation"&&"üå± ",i.type==="observation"&&"üîé ",i.title]}),e.jsx("div",{children:i.description}),i.affectedPlants&&i.affectedPlants.length>0&&e.jsxs("div",{className:"mt-1 text-[11px] text-green-800 dark:text-green-200",children:["Plantas: ",i.affectedPlants.join(", ")]})]},o))})]}),((c=a.context)==null?void 0:c.suggestedActions)&&a.context.suggestedActions.length>0&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"font-semibold text-xs text-blue-700 dark:text-blue-300",children:"Acciones sugeridas:"}),e.jsx("ul",{className:"space-y-1",children:a.context.suggestedActions.map((i,o)=>e.jsxs("li",{className:"text-xs bg-blue-50 dark:bg-blue-900/20 rounded-lg p-2 border border-blue-200 dark:border-blue-800",children:[e.jsx("div",{className:"font-medium",children:i.action}),i.priority&&e.jsxs("div",{className:"text-[11px] text-blue-800 dark:text-blue-200",children:["Prioridad: ",i.priority]}),i.plantIds&&i.plantIds.length>0&&e.jsxs("div",{className:"text-[11px] text-blue-800 dark:text-blue-200",children:["Plantas: ",i.plantIds.join(", ")]})]},o))})]}),!t&&((m=a.context)==null?void 0:m.plantsAnalyzed)&&a.context.plantsAnalyzed.length>0&&e.jsxs(l.div,{className:"mt-2 flex items-center gap-1 text-xs opacity-70",initial:{opacity:0},animate:{opacity:.7},transition:{delay:.5},children:[e.jsx(H,{size:12}),e.jsxs("span",{children:["Analiz√≥ ",a.context.plantsAnalyzed.length," planta(s)"]})]}),e.jsx("div",{className:S("mt-2 text-xs",t?"text-primary-foreground/70":"text-muted-foreground/70","text-[#888] text-[12px]"),children:ce(new Date(a.timestamp),{addSuffix:!0,locale:de})})]})}),t&&e.jsx(l.div,{className:"flex h-8 w-8 items-center justify-center rounded-full bg-primary/10",initial:{scale:0},animate:{scale:1},transition:{delay:.1},children:e.jsx(he,{size:16,className:"text-primary"})})]})},Ne=({onSendMessage:a,isTyping:t,suggestedQuestions:s,isLoading:r=!1})=>{const[n,c]=h.useState(""),[m,i]=h.useState(!0),o=h.useRef(null),x=async()=>{var u;if(t)return;const d=(u=o.current)==null?void 0:u.value.trim();d&&(i(!1),o.current&&(o.current.value=""),await a(d))},j=d=>{d.key==="Enter"&&!d.shiftKey&&(d.preventDefault(),x())},g=async d=>{c(""),i(!1),await a(d)},y=()=>{s.length>0&&!n&&i(!0)};return e.jsx("footer",{className:"sticky bottom-0 z-10 bg-background/80 backdrop-blur-sm border-t border-border",children:e.jsxs("div",{className:"p-4 pb-safe-bottom space-y-3",children:[e.jsx(I,{children:m&&s.length>0&&!r&&e.jsxs(l.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(G,{size:12}),e.jsx("span",{children:"Preguntas sugeridas"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:s.slice(0,4).map((d,u)=>e.jsx(l.button,{onClick:()=>g(d),disabled:t,className:"px-3 py-1.5 text-xs bg-muted hover:bg-[#F0F0F0] active:bg-[#F0F0F0] rounded-full border border-border/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-left",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:u*.1},whileHover:{scale:1.02},whileTap:{scale:.98},children:d},d))})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pe,{type:"text",ref:o,onKeyDown:j,onFocus:y,placeholder:"Preg√∫ntame sobre tu jard√≠n...",className:"pr-12",disabled:t||r}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-muted-foreground",children:e.jsx(ue,{size:16})})]}),e.jsx(k,{"aria-label":"Enviar mensaje",onClick:x,disabled:!n.trim()||t||r,size:"icon",className:"shrink-0",children:t?e.jsx(l.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:e.jsx(G,{size:20})}):e.jsx(me,{size:20})})]}),r&&e.jsxs(l.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center justify-center gap-2 text-xs text-muted-foreground",children:[e.jsx(l.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:e.jsx(G,{size:12})}),e.jsx("span",{children:"Analizando tu jard√≠n..."})]})]})})},ke={plants:e.jsx("svg",{viewBox:"0 0 200 150",className:"w-32 h-24 text-primary-300 dark:text-primary-600",children:e.jsxs(l.g,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.8,ease:"easeOut"},children:[e.jsx(l.path,{d:"M60 120 L140 120 L130 100 L70 100 Z",fill:"currentColor",initial:{scaleY:0},animate:{scaleY:1},transition:{delay:.2,duration:.5}}),e.jsx(l.g,{initial:{scale:0,rotate:-10},animate:{scale:1,rotate:0},transition:{delay:.5,duration:.8,type:"spring"},children:e.jsx("path",{d:"M80 100 Q85 80 90 85 Q95 75 85 70 Q75 75 80 100",fill:"currentColor",opacity:"0.8"})}),e.jsx(l.g,{initial:{scale:0,rotate:10},animate:{scale:1,rotate:0},transition:{delay:.7,duration:.8,type:"spring"},children:e.jsx("path",{d:"M100 100 Q105 85 110 90 Q115 80 105 75 Q95 80 100 100",fill:"currentColor",opacity:"0.7"})}),e.jsx(l.g,{initial:{scale:0,rotate:-5},animate:{scale:1,rotate:0},transition:{delay:.9,duration:.8,type:"spring"},children:e.jsx("path",{d:"M120 100 Q125 90 130 95 Q135 85 125 80 Q115 85 120 100",fill:"currentColor",opacity:"0.6"})})]})}),search:e.jsx("svg",{viewBox:"0 0 200 150",className:"w-32 h-24 text-primary-300 dark:text-primary-600",children:e.jsxs(l.g,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},children:[e.jsx(l.circle,{cx:"80",cy:"70",r:"25",stroke:"currentColor",strokeWidth:"3",fill:"none",initial:{scale:0},animate:{scale:1},transition:{delay:.3,duration:.5,type:"spring"}}),e.jsx(l.line,{x1:"100",y1:"88",x2:"120",y2:"108",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",initial:{scaleX:0},animate:{scaleX:1},transition:{delay:.6,duration:.4}}),e.jsx(l.circle,{cx:"140",cy:"50",r:"2",fill:"currentColor",initial:{scale:0},animate:{scale:1},transition:{delay:1,duration:.3}}),e.jsx(l.circle,{cx:"150",cy:"40",r:"3",fill:"currentColor",initial:{scale:0},animate:{scale:1},transition:{delay:1.2,duration:.3}})]})}),chat:e.jsx("svg",{viewBox:"0 0 200 150",className:"w-32 h-24 text-primary-300 dark:text-primary-600",children:e.jsxs(l.g,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},children:[e.jsx(l.rect,{x:"50",y:"40",width:"100",height:"60",rx:"20",fill:"currentColor",opacity:"0.8",initial:{scale:0,y:20},animate:{scale:1,y:0},transition:{delay:.2,duration:.6,type:"spring"}}),e.jsx(l.path,{d:"M80 100 L70 115 L95 105 Z",fill:"currentColor",opacity:"0.8",initial:{scale:0},animate:{scale:1},transition:{delay:.5,duration:.4}}),e.jsxs(l.g,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8,duration:.5},children:[e.jsx("circle",{cx:"75",cy:"70",r:"3",fill:"white"}),e.jsx("circle",{cx:"100",cy:"70",r:"3",fill:"white"}),e.jsx("circle",{cx:"125",cy:"70",r:"3",fill:"white"})]})]})}),camera:e.jsx("svg",{viewBox:"0 0 200 150",className:"w-32 h-24 text-primary-300 dark:text-primary-600",children:e.jsxs(l.g,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},children:[e.jsx(l.rect,{x:"60",y:"60",width:"80",height:"50",rx:"8",fill:"currentColor",opacity:"0.8",initial:{scale:0},animate:{scale:1},transition:{delay:.2,duration:.5,type:"spring"}}),e.jsx(l.rect,{x:"85",y:"45",width:"30",height:"15",rx:"4",fill:"currentColor",opacity:"0.6",initial:{scaleY:0},animate:{scaleY:1},transition:{delay:.4,duration:.3}}),e.jsx(l.circle,{cx:"100",cy:"85",r:"15",stroke:"white",strokeWidth:"2",fill:"none",initial:{scale:0},animate:{scale:1},transition:{delay:.6,duration:.4,type:"spring"}}),e.jsx(l.circle,{cx:"120",cy:"70",r:"3",fill:"currentColor",opacity:"0.9",initial:{scale:0},animate:{scale:[0,1.2,1]},transition:{delay:.8,duration:.5}})]})}),settings:e.jsx("svg",{viewBox:"0 0 200 150",className:"w-32 h-24 text-primary-300 dark:text-primary-600",children:e.jsxs(l.g,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},children:[e.jsxs(l.g,{animate:{rotate:360},transition:{duration:20,repeat:1/0,ease:"linear"},style:{originX:"100px",originY:"75px"},children:[e.jsx("path",{d:"M100 50 L110 60 L120 50 L120 60 L130 70 L120 80 L120 90 L110 90 L100 100 L90 90 L80 90 L80 80 L70 70 L80 60 L80 50 Z",fill:"currentColor",opacity:"0.7"}),e.jsx("circle",{cx:"100",cy:"75",r:"8",fill:"white"})]}),e.jsxs(l.g,{animate:{rotate:-360},transition:{duration:15,repeat:1/0,ease:"linear"},style:{originX:"140px",originY:"95px"},children:[e.jsx("path",{d:"M140 85 L145 90 L150 85 L150 90 L155 95 L150 100 L150 105 L145 105 L140 110 L135 105 L130 105 L130 100 L125 95 L130 90 L130 85 Z",fill:"currentColor",opacity:"0.5"}),e.jsx("circle",{cx:"140",cy:"95",r:"5",fill:"white"})]})]})})},Ce=({icon:a,title:t,description:s,action:r,illustration:n="plants",className:c})=>e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},className:S("flex flex-col items-center justify-center text-center py-12 px-6 max-w-md mx-auto",c),children:[e.jsx(l.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2,duration:.5,ease:"easeOut"},className:"mb-6",children:a||ke[n]}),e.jsx(l.h3,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4,duration:.5},className:"text-xl font-semibold text-neutral-900 dark:text-neutral-100 mb-3",children:t}),e.jsx(l.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5,duration:.5},className:"text-neutral-600 dark:text-neutral-400 mb-6 leading-relaxed",children:s}),r&&e.jsx(l.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.6,duration:.5},children:e.jsx(k,{onClick:r.onClick,variant:"primary",size:"lg",className:"animate-glow",children:r.label})})]}),Ie=()=>{const a=Q(),t=se(d=>d.plants),{messages:s,isLoading:r,isTyping:n,error:c,gardenSummary:m,suggestedQuestions:i,sendMessage:o,clearMessages:x,retryLastMessage:j,refreshGardenData:g}=ye(),y=h.useRef(null);return h.useEffect(()=>{var d;(d=y.current)==null||d.scrollIntoView({behavior:"smooth"})},[s,n]),c&&!m?e.jsxs("div",{className:"flex flex-col h-screen bg-background text-foreground",children:[e.jsx(M,{gardenSummary:m}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center max-w-md",children:[e.jsx(A,{className:"w-16 h-16 text-destructive mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Error de conexi√≥n"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:c}),e.jsxs(k,{onClick:g,variant:"primary",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Reintentar"]})]})})]}):(m==null?void 0:m.totalPlants)===0?e.jsxs("div",{className:"flex flex-col h-screen bg-background text-foreground",children:[e.jsx(M,{gardenSummary:m}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(Ce,{illustration:"plants",title:"Tu jard√≠n est√° vac√≠o",description:"Agrega algunas plantas a tu jard√≠n para poder chatear conmigo sobre su cuidado y salud.",action:{label:"Agregar mi primera planta",onClick:()=>a(E.toCamera())}})})]}):e.jsxs("div",{className:"flex flex-col h-screen bg-background text-foreground",children:[e.jsx(M,{gardenSummary:m,onClearChat:x,onRefresh:g,isRefreshing:r&&s.length>0}),s.length===0&&t.length>0&&e.jsxs("div",{className:"p-4 border-b border-neutral-200 dark:border-neutral-700",children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-3",children:"Chats individuales con tus plantas:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.slice(0,4).map(d=>e.jsx(_,{variant:"glass",size:"sm",interactive:!0,className:"cursor-pointer hover:border-primary-300 dark:hover:border-primary-600",onClick:()=>a(E.toPlantChat(d.id)),children:e.jsx(q,{className:"p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary-100 dark:bg-primary-900 flex items-center justify-center",children:e.jsx(B,{className:"w-4 h-4 text-primary-600 dark:text-primary-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:d.nickname||d.name}),e.jsx("p",{className:"text-xs text-neutral-500 truncate",children:d.species})]}),e.jsx(oe,{className:"w-4 h-4 text-neutral-400"})]})})},d.id)),t.length>4&&e.jsx(_,{variant:"outline",size:"sm",interactive:!0,className:"cursor-pointer",onClick:()=>a(E.toDashboard()),children:e.jsx(q,{className:"p-3 flex items-center justify-center",children:e.jsxs("span",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:["+",t.length-4," m√°s"]})})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",style:{paddingBottom:"calc(88px + env(safe-area-inset-bottom))"},children:[e.jsxs("div",{className:"p-4 space-y-4 max-w-4xl mx-auto",children:[e.jsx(I,{children:s.map(d=>e.jsx(we,{message:d},d.id))}),n&&e.jsx(l.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:e.jsx(xe,{})}),c&&s.length>0&&e.jsx(l.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center justify-center",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3 max-w-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700 dark:text-red-300 text-sm",children:[e.jsx(A,{size:16}),e.jsx("span",{children:c})]}),e.jsxs(k,{onClick:j,size:"sm",variant:"outline",className:"mt-2 w-full",children:[e.jsx(L,{size:14,className:"mr-1"}),"Reintentar"]})]})}),e.jsx("div",{ref:y})]}),!1]}),e.jsx(Ne,{onSendMessage:o,isTyping:n,suggestedQuestions:i,isLoading:r})]})};export{Ie as default};
