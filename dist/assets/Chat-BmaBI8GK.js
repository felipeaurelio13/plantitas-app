import{c as h,b as g,a as p,u as b,v as u,r as d,j as e,m as l,e as x}from"./index-z65WOOMl.js";import{A as j,u as v}from"./usePlantDetail-XRR9fn-K.js";import{f as N,l as k,I as w}from"./Input-CGs5qppQ.js";import{B as f,A as C}from"./Button-BZbq9PYX.js";import{S as M}from"./sparkles-CtWVvJok.js";import{L as S}from"./index-Cblfo7Jl.js";/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=h("CornerDownLeft",[["polyline",{points:"9 10 4 15 9 20",key:"r3jprv"}],["path",{d:"M20 4v7a4 4 0 0 1-4 4H4",key:"6o5b7l"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=h("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=h("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),P=()=>{const{plantId:s}=g(),r=p(),{user:n}=b(),t=u(c=>c.getPlantById(s||"")),i=u(c=>c.addChatMessage),o=u(c=>c.isLoading);console.log("--- DEBUG CHAT ---"),console.log("ID de planta desde URL:",s),console.log("Planta encontrada en el store:",t);const a=d.useMemo(()=>{if(!t||!t.chatHistory||t.chatHistory.length===0)return!1;const c=t.chatHistory[t.chatHistory.length-1];return o&&c.sender==="user"},[t,o]);return{plant:t,isTyping:a,handleSendMessage:async c=>{if(!(!s||!n||!c.trim()))try{await i(s,c.trim(),n.id)}catch(y){console.error("Failed to send message:",y)}},handleGoBack:()=>{r(`/plant/${s}`)},currentUser:n}},E=({plant:s})=>{const r=p(),n=()=>{const t=s.healthScore/100,i=s.lastWatered?new Date(s.lastWatered).getTime():0,o=i?Math.max(0,1-(Date.now()-i)/(s.careProfile.wateringFrequency*24*60*60*1e3)):0,a=t*.6+o*.4;return a>.8?"radiante":a>.6?"feliz":a>.4?"estable":"necesitada de atenciÃ³n"};return e.jsx("header",{className:"sticky top-0 z-10 bg-background/80 backdrop-blur-sm border-b border-muted",children:e.jsxs("div",{className:"flex items-center gap-2 p-4 pt-safe-top",children:[e.jsx("button",{onClick:()=>r(`/plant/${s.id}`),className:"btn btn-ghost btn-circle",children:e.jsx(j,{size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"font-bold text-foreground truncate",children:s.nickname||s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground capitalize",children:["Se siente ",n()]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-destructive",children:[e.jsx(I,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.healthScore,"%"]})]})]})})},L=s=>{switch(s){case"happy":case"excited":return"ðŸ˜Š";case"grateful":return"ðŸ¥°";case"worried":return"ðŸ˜Ÿ";case"sad":return"ðŸ˜¢";default:return"ðŸŒ±"}},z=({message:s})=>{const r=s.sender==="user";return e.jsxs(l.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:x("flex items-end gap-2",r?"justify-end":"justify-start"),children:[!r&&e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-muted text-xl",children:L(s.emotion)}),e.jsxs("div",{className:x("max-w-xs rounded-2xl px-4 py-2 sm:max-w-sm md:max-w-md",r?"rounded-br-lg bg-primary text-primary-foreground":"rounded-bl-lg bg-muted text-muted-foreground"),children:[e.jsx("p",{className:"text-sm",children:s.content}),e.jsx("p",{className:x("mt-1 text-xs",r?"text-primary-foreground/70":"text-muted-foreground/70"),children:N(new Date(s.timestamp),{addSuffix:!0,locale:k})})]})]})},A=({messages:s})=>e.jsx("div",{className:"space-y-4",children:s.map(r=>e.jsx(z,{message:r},r.id))}),B=["Â¿CÃ³mo te sientes hoy?","Â¿Necesitas agua?","CuÃ©ntame un dato curioso sobre ti"],T=({onSendMessage:s,isTyping:r})=>{const[n,t]=d.useState(""),i=()=>{n.trim()&&(s(n.trim()),t(""))},o=a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),i())};return e.jsx("footer",{className:"sticky bottom-0 z-10 bg-background/80 backdrop-blur-sm border-t border-border",children:e.jsxs("div",{className:"p-4 pb-safe-bottom space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(w,{type:"text",value:n,onChange:a=>t(a.target.value),onKeyPress:o,placeholder:"Escribe un mensaje...",className:"pr-12",disabled:r}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-muted-foreground",children:e.jsx(D,{size:16})})]}),e.jsx(f,{"aria-label":"Enviar mensaje",onClick:i,disabled:!n.trim()||r,size:"icon",children:e.jsx(H,{size:20})})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:B.map(a=>e.jsx(f,{onClick:()=>t(a),disabled:r,variant:"secondary",size:"sm",children:a},a))})]})})},q=()=>{const s={initial:{y:0},animate:{y:[0,-4,0],transition:{duration:1,repeat:1/0,ease:"easeInOut"}}};return e.jsxs(l.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},className:"flex items-end gap-2",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-muted text-xl",children:"ðŸŒ±"}),e.jsxs("div",{className:"flex items-center gap-1 rounded-2xl rounded-bl-lg bg-muted px-4 py-3",children:[e.jsx(l.div,{variants:s,animate:"animate",style:{transitionDelay:"0s"},className:"h-2 w-2 rounded-full bg-muted-foreground/50"}),e.jsx(l.div,{variants:s,animate:"animate",style:{transitionDelay:"0.2s"},className:"h-2 w-2 rounded-full bg-muted-foreground/50"}),e.jsx(l.div,{variants:s,animate:"animate",style:{transitionDelay:"0.4s"},className:"h-2 w-2 rounded-full bg-muted-foreground/50"})]})]})},F=({plantName:s})=>e.jsxs(l.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5,ease:"easeOut"},className:"flex flex-1 flex-col items-center justify-center text-center p-8",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full bg-primary/10 mb-4",children:e.jsx(M,{className:"h-8 w-8 text-primary"})}),e.jsx("h3",{className:"text-xl font-bold text-foreground",children:"Inicia una conversaciÃ³n"}),e.jsxs("p",{className:"text-muted-foreground max-w-xs",children:[s," estÃ¡ esperando para charlar. Â¡PregÃºntale sobre sus cuidados o simplemente saluda!"]})]}),Z=()=>{const{plantId:s}=g(),{loading:r,error:n}=v(s),{plant:t,isTyping:i,handleSendMessage:o}=P(),a=d.useRef(null);return d.useEffect(()=>{var m;(m=a.current)==null||m.scrollIntoView({behavior:"smooth"})},[t==null?void 0:t.chatHistory,i]),r?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-background text-foreground",children:[e.jsx(S,{className:"w-12 h-12 animate-spin text-green-500"}),e.jsx("p",{className:"mt-4 text-lg",children:"Cargando chat..."})]}):n?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-background text-red-500",children:[e.jsxs("p",{className:"mb-4",children:["Error: ",n]}),e.jsx("button",{onClick:()=>window.history.back(),className:"btn btn-primary",children:"Volver"})]}):t?e.jsxs("div",{className:"flex flex-col h-screen bg-background text-foreground",children:[e.jsx(E,{plant:t}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsx(C,{children:t.chatHistory.length===0?e.jsx(F,{plantName:t.nickname||t.name}):e.jsx(A,{messages:t.chatHistory,plantNickname:t.nickname||t.name})}),i&&e.jsx(q,{}),e.jsx("div",{ref:a})]}),e.jsx(T,{onSendMessage:o,isTyping:i})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-background text-foreground",children:[e.jsx("p",{className:"mb-4",children:"Planta no encontrada."}),e.jsx("button",{onClick:()=>window.history.back(),className:"btn btn-primary",children:"Volver"})]})};export{Z as default};
