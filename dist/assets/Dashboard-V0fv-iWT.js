import{u as P,p as A,a as b,j as e,m as l,A as j,c as F,r as p,t as D,P as N,L as O}from"./index-DrqidrQV.js";import{u as T,L as H}from"./usePlantDetail-DmKFgZ8W.js";import{f as B,l as $,I as M}from"./Input-DA7b4EDv.js";import{C as w,a as k,b as U,c as C,d as S}from"./Card-DtKCPuc5.js";import{L as R,D as y,U as q,M as Q,S as x,W as G}from"./skeleton-CrOffylp.js";import{B as z,S as J}from"./Button-vPdajJSs.js";import{S as K}from"./sun-Dl4AA6-x.js";import{H as _}from"./heart-DAYx1avr.js";import{u as V,C as X}from"./usePlantMutations-D_qInL8k.js";import{I as Y}from"./image-B-FPyHJI.js";import"./index-Bnwr932r.js";import"./eye-DXNsoCuQ.js";const Z=()=>{const a=P(n=>n.user);return T({queryKey:["plants",a==null?void 0:a.id],queryFn:()=>a?A.getUserPlantSummaries(a.id):Promise.resolve([]),enabled:!!a,staleTime:1e3*60*5,refetchOnWindowFocus:!0})},ee=({score:a})=>{const r=(o=>o>=80?{color:"bg-success-500",textColor:"text-success-600 dark:text-success-400",emoji:"ðŸŒ±",status:"Excelente"}:o>=60?{color:"bg-warning-500",textColor:"text-warning-600 dark:text-warning-400",emoji:"ðŸŒ¿",status:"Bien"}:{color:"bg-error-500",textColor:"text-error-600 dark:text-error-400",emoji:"ðŸ¥º",status:"Necesita cuidados"})(a);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsxs("div",{className:"relative w-20 h-2 bg-neutral-200 dark:bg-neutral-700 rounded-full overflow-hidden",children:[e.jsx(l.div,{className:`absolute top-0 left-0 h-full rounded-full ${r.color}`,initial:{width:0},animate:{width:`${a}%`},transition:{duration:.8,ease:"easeOut",delay:.2}}),a>=80&&e.jsx(l.div,{className:"absolute inset-0 flex items-center justify-center",initial:{opacity:0},animate:{opacity:[0,1,0]},transition:{duration:2,repeat:1/0},children:e.jsx(J,{size:8,className:"text-white"})})]}),e.jsxs("span",{className:F("text-xs font-semibold",r.textColor),children:[a,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsx("span",{children:r.emoji}),e.jsx("span",{className:r.textColor,children:r.status})]})]})},ae=({plant:a,index:n})=>{const r=b(),o=a.lastWatered&&a.wateringFrequency?new Date().getTime()-new Date(a.lastWatered).getTime()>a.wateringFrequency*24*60*60*1e3:!a.lastWatered,i=()=>r(`/plant/${a.id}`),d=h=>{h.stopPropagation(),r(`/plant/${a.id}/chat`)},g=a.healthScore>=80;return e.jsx(l.div,{initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:n*.1,duration:.5,ease:[.4,0,.2,1],type:"spring",stiffness:300,damping:30},whileHover:{y:-4},className:"group",children:e.jsxs(w,{variant:"glass",size:"default",radius:"lg",interactive:!0,hover:!0,onClick:i,className:"overflow-hidden border-2 hover:border-primary-300 dark:hover:border-primary-600 transition-all duration-300",children:[e.jsx(k,{className:"p-4 pb-2",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"relative w-16 h-16 rounded-xl overflow-hidden bg-gradient-to-br from-primary-50 to-primary-100 dark:from-primary-950 dark:to-primary-900 flex-shrink-0 border border-primary-200 dark:border-primary-800",children:[a.profileImageUrl?e.jsx(R,{src:a.profileImageUrl,alt:a.name,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-primary-400 dark:text-primary-600",children:e.jsx(K,{size:24})}),e.jsx(j,{children:g&&e.jsx(l.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},className:"absolute -top-1 -right-1 w-6 h-6 bg-error-500 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(_,{size:12,className:"text-white fill-current"})})}),e.jsx(j,{children:o&&e.jsx(l.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},className:"absolute -bottom-1 -right-1 w-6 h-6 bg-warning-500 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(l.div,{animate:{scale:[1,1.2,1]},transition:{duration:1.5,repeat:1/0},children:e.jsx(y,{size:12,className:"text-white"})})})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(U,{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-100 truncate mb-1 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors",children:a.nickname||a.name}),e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 truncate mb-2",children:a.species}),e.jsx("div",{className:"flex items-center text-xs text-neutral-500 dark:text-neutral-500",children:e.jsxs("span",{className:"px-2 py-1 bg-neutral-100 dark:bg-neutral-800 rounded-md",children:["ðŸ“ ",a.location]})})]})]})}),e.jsx(C,{className:"px-4 pb-2",children:e.jsx(ee,{score:a.healthScore})}),e.jsx(S,{className:"px-4 py-3 bg-neutral-50/80 dark:bg-neutral-900/50 backdrop-blur-sm border-t border-neutral-200/50 dark:border-neutral-700/50",children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("div",{className:"flex items-center gap-2 text-xs text-neutral-600 dark:text-neutral-400",children:a.lastWatered?e.jsxs(e.Fragment,{children:[e.jsx(y,{size:12,className:"text-primary-500"}),e.jsx("span",{children:B(new Date(a.lastWatered),{addSuffix:!0,locale:$})})]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{size:12,className:"text-neutral-400"}),e.jsx("span",{children:"Sin registro de riego"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{plant:a,variant:"ghost",size:"icon-sm",showLabel:!1,className:"opacity-70 hover:opacity-100 transition-opacity"}),e.jsx(z,{size:"sm",variant:"ghost",onClick:d,className:"opacity-70 hover:opacity-100 transition-opacity","aria-label":`Chatear con ${a.nickname||a.name}`,children:e.jsx(Q,{size:16})})]})]})}),e.jsx(l.div,{className:"absolute inset-0 bg-gradient-to-t from-primary-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none",initial:!1})]})})},se=()=>e.jsxs(w,{variant:"elevated",size:"default",className:"overflow-hidden",children:[e.jsxs("div",{className:"flex items-start p-4 space-x-4",children:[e.jsx(x,{className:"w-20 h-20 rounded-lg flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(k,{className:"p-0",children:[e.jsx(x,{className:"h-6 w-3/4"}),e.jsx(x,{className:"h-4 w-1/2 mt-2"})]}),e.jsx(C,{className:"p-0 mt-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"w-16 h-1.5"}),e.jsx(x,{className:"w-8 h-3"})]})})]})]}),e.jsx(S,{className:"bg-neutral-50 dark:bg-neutral-800/50 p-2 border-t border-subtle",children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx(x,{className:"h-4 w-1/3"}),e.jsx(x,{className:"w-8 h-8 rounded"})]})})]}),te=()=>{const[a,n]=p.useState(!1),r=b(),{createPlant:o,isCreatingPlant:i}=V();p.useEffect(()=>{const s=c=>{c.key==="Escape"&&n(!1)};return a&&document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[a]);const d=[{id:"camera",icon:X,label:"Tomar Foto",color:"bg-blue-500",action:()=>{n(!1),r("/camera")}},{id:"gallery",icon:Y,label:"GalerÃ­a",color:"bg-purple-500",action:()=>h()}],g=p.useCallback(s=>{const c=new FileReader;c.onload=m=>{var v;const I=(v=m.target)==null?void 0:v.result,L="Interior",W=new Promise((f,E)=>{o({imageDataUrl:I,location:L},{onSuccess:u=>{u!=null&&u.id&&r(`/plant/${u.id}`),f(u)},onError:u=>E(u)})});D.promise(W,{loading:"Analizando imagen...",success:f=>`Â¡Planta "${f.name}" creada con Ã©xito!`,error:f=>`Error: ${f.message}`}),n(!1)},c.readAsDataURL(s)},[o,r]),h=()=>{const s=document.createElement("input");s.type="file",s.accept="image/*",s.onchange=c=>{const m=c.target;m.files&&m.files[0]&&g(m.files[0])},s.click()},t=i?H:N;return e.jsxs("div",{className:"fixed bottom-20 right-4 z-50",children:[e.jsx(j,{children:a&&e.jsx(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/20 z-30",onClick:()=>n(!1)})}),e.jsx(j,{children:a&&e.jsx("div",{className:"absolute bottom-16 right-0 space-y-3 z-40",children:d.map((s,c)=>e.jsxs(l.button,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1,transition:{delay:c*.1}},exit:{scale:0,opacity:0,transition:{delay:(d.length-c)*.05}},onClick:s.action,disabled:i,style:{backgroundColor:s.color.includes("blue")?"#3b82f6":"#8b5cf6",color:"white",border:"none",borderRadius:"12px",padding:"12px",display:"flex",alignItems:"center",gap:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",cursor:i?"not-allowed":"pointer",minWidth:"140px"},children:[e.jsx(s.icon,{size:20}),e.jsx("span",{className:"text-sm font-medium",children:s.label})]},s.id))})}),e.jsx(l.button,{"aria-label":i?"Agregando planta":a?"Cerrar menÃº":"Agregar planta",onClick:()=>!i&&n(!a),disabled:i,style:{backgroundColor:"#22c55e",color:"white",border:"none",borderRadius:"50%",width:"56px",height:"56px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 10px 25px -3px rgba(0, 0, 0, 0.1)",cursor:i?"not-allowed":"pointer"},whileHover:{scale:i?1:1.05},whileTap:{scale:i?1:.95},animate:{rotate:a?45:0},children:e.jsx(t,{size:24,className:i?"animate-spin":""})})]})},re=()=>{const a=b();return e.jsxs(l.div,{className:"flex flex-col items-center justify-center text-center py-16 px-6",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5,ease:"easeOut"},children:[e.jsxs(l.div,{className:"relative w-24 h-24 mb-6",initial:{rotate:-15},animate:{rotate:[15,-10,10,-5,5,0]},transition:{duration:1,ease:"easeInOut"},children:[e.jsx(G,{className:"absolute top-0 left-0 w-8 h-8 text-sky-400 opacity-60"}),e.jsx(O,{className:"w-24 h-24 text-green-500"}),e.jsx(y,{className:"absolute bottom-0 right-0 w-10 h-10 text-blue-400 opacity-70"})]}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100 mb-2",children:"Tu jardÃ­n estÃ¡ vacÃ­o"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 max-w-sm mb-6",children:"AÃ±ade tu primera planta para empezar a monitorizar su salud y cuidados."}),e.jsxs(z,{size:"lg",onClick:()=>a("/camera"),children:[e.jsx(N,{className:"mr-2"}),"AÃ±adir Planta"]})]})},fe=()=>{const{data:a=[],isLoading:n,error:r}=Z(),[o,i]=p.useState(""),[d,g]=p.useState("name"),h=p.useMemo(()=>[...a].filter(t=>t.name.toLowerCase().includes(o.toLowerCase())||t.species.toLowerCase().includes(o.toLowerCase())).sort((t,s)=>{var c,m;switch(d){case"health":return(s.healthScore||0)-(t.healthScore||0);case"lastWatered":return(((c=s.lastWatered)==null?void 0:c.getTime())||0)-(((m=t.lastWatered)==null?void 0:m.getTime())||0);default:return t.name.localeCompare(s.name)}}),[a,o,d]);return n?e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100",children:"Mi JardÃ­n"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Buscando tus plantas..."})]}),e.jsx(x,{className:"h-10 w-10 rounded-full"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:Array.from({length:8}).map((t,s)=>e.jsx(se,{},s))})]}):r?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsxs("div",{className:"text-xl text-red-500 text-center",children:[e.jsx("p",{children:"OcurriÃ³ un error al cargar tus plantas:"}),e.jsx("p",{className:"text-sm mt-2",children:r.message})]})}):e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100",children:"Mi JardÃ­n"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:[a.length," ",a.length===1?"planta":"plantas"," en tu colecciÃ³n"]})]}),e.jsx(te,{})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx(M,{type:"text",placeholder:"Buscar por nombre o especie...",value:o,onChange:t=>i(t.target.value),className:"flex-grow"}),e.jsxs("select",{value:d,onChange:t=>g(t.target.value),className:"bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg px-4 py-2 h-10 text-gray-800 dark:text-gray-200 focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:"name",children:"Ordenar por Nombre"}),e.jsx("option",{value:"health",children:"Ordenar por Salud"}),e.jsx("option",{value:"lastWatered",children:"Ordenar por Riego"})]})]}),e.jsx(j,{children:h.length>0?e.jsx(l.div,{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",initial:"hidden",animate:"visible",variants:{visible:{transition:{staggerChildren:.05}}},children:h.map((t,s)=>e.jsx(ae,{plant:t,index:s},t.id))}):e.jsx(re,{})})]})};export{fe as default};
