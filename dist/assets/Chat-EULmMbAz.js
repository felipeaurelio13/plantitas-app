import{S as g,u as h,D as j,G as u,r as l,j as e,n as y,m as p,a as x,a6 as N,A as v}from"./index-IWlstUSv.js";import{u as k,L as w}from"./usePlantDetail-DLl7IC-K.js";import{A as C}from"./arrow-left-mk6TicAG.js";import{H as S}from"./heart-B4hyXJDK.js";import{f as M,l as E,C as D,S as H,T as I}from"./TypingIndicator-BZLU30Eo.js";import{B as f,S as z}from"./Button-DJtJhVfV.js";import{I as P}from"./Input-DHfS_pDa.js";import"./index-Bnwr932r.js";import"./eye-BR_0WJm5.js";const L=()=>{const{plantId:s}=g(),t=h(),{user:n}=j(),a=u(o=>o.getPlantById(s||"")),r=u(o=>o.addChatMessage),i=u(o=>o.isLoading),c=l.useMemo(()=>{if(!a||!a.chatHistory||a.chatHistory.length===0)return!1;const o=a.chatHistory[a.chatHistory.length-1];return i&&o.sender==="user"},[a,i]);return{plant:a,isTyping:c,handleSendMessage:async o=>{if(!(!s||!n||!o.trim()))try{await r(s,o.trim(),n.id)}catch(b){console.error("Failed to send message:",b)}},handleGoBack:()=>{t(`/plant/${s}`)},currentUser:n}},A=({plant:s})=>{const t=h(),n=s!=null&&s.healthScore?s.healthScore/100:0,a=()=>{const i=s.healthScore/100*.6+n*.4;return i>.8?"radiante":i>.6?"feliz":i>.4?"estable":"necesitada de atención"};return e.jsx("header",{className:"sticky top-0 z-10 bg-background/80 backdrop-blur-sm border-b border-muted",children:e.jsxs("div",{className:"flex items-center gap-2 p-4 pt-safe-top",children:[e.jsx("button",{onClick:()=>t(y.toPlantDetail(s.id)),className:"btn btn-ghost btn-circle",children:e.jsx(C,{size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"font-bold text-foreground truncate text-heading-4",children:s.nickname||s.name}),e.jsxs("p",{className:"text-caption text-muted-foreground capitalize",children:["Se siente ",a()]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-ui font-semibold text-destructive",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.healthScore,"%"]})]})]})})},B=s=>{switch(s){case"happy":case"excited":return"😊";case"grateful":return"🥰";case"worried":return"😟";case"sad":return"😢";default:return"🌱"}},F=({message:s})=>{const t=s.sender==="user",n=a=>{N.success("¡Gracias por tu feedback!",a?"Nos alegra que la respuesta te haya sido útil.":"Trabajaremos para mejorar las respuestas.")};return e.jsxs(p.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:x("flex items-end gap-2",t?"justify-end":"justify-start"),children:[!t&&e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-muted text-xl",children:B(s.emotion)}),e.jsxs("div",{className:x("max-w-xs rounded-2xl px-4 py-2 sm:max-w-sm md:max-w-md shadow-adaptive",t?"rounded-br-lg bg-primary text-white":"rounded-bl-lg bg-contrast-surface text-contrast-medium border border-contrast"),children:[e.jsx("p",{className:"text-sm",children:s.content}),e.jsx("p",{className:x("mt-1 text-xs",t?"text-white/80":"text-contrast-soft"),children:M(new Date(s.timestamp),{addSuffix:!0,locale:E})}),!t&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{"aria-label":"Respuesta útil",className:"text-green-600 hover:text-green-800 text-lg focus:outline-none",onClick:()=>n(!0),children:"👍"}),e.jsx("button",{"aria-label":"Respuesta no útil",className:"text-red-500 hover:text-red-700 text-lg focus:outline-none",onClick:()=>n(!1),children:"👎"})]})]})]})},R=({messages:s})=>e.jsx("div",{className:"space-y-4",children:s.map(t=>e.jsx(F,{message:t},t.id))}),G=["¿Cómo te sientes hoy?","¿Necesitas agua?","Cuéntame un dato curioso sobre ti"],T=({onSendMessage:s,isTyping:t})=>{const[n,a]=l.useState(""),r=()=>{n.trim()&&(s(n.trim()),a(""))},i=c=>{c.key==="Enter"&&!c.shiftKey&&!c.nativeEvent.isComposing&&(c.preventDefault(),r())};return e.jsx("footer",{className:"sticky bottom-0 z-10 bg-background/80 backdrop-blur-sm border-t border-border",children:e.jsxs("div",{className:"p-4 pb-safe-bottom space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(P,{type:"text",value:n,onChange:c=>a(c.target.value),onKeyDown:i,placeholder:"Escribe un mensaje...",className:"pr-12",disabled:t}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-muted-foreground",children:e.jsx(D,{size:16})})]}),e.jsx(f,{"aria-label":"Enviar mensaje",onClick:r,disabled:!n.trim()||t,size:"icon",children:e.jsx(H,{size:20})})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:G.map(c=>e.jsx(f,{onClick:()=>a(c),disabled:t,variant:"secondary",size:"sm",children:c},c))})]})})},K=({plantName:s})=>e.jsxs(p.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5,ease:"easeOut"},className:"flex flex-1 flex-col items-center justify-center text-center p-8",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full bg-primary/10 mb-4",children:e.jsx(z,{className:"h-8 w-8 text-primary"})}),e.jsx("h3",{className:"text-xl font-bold text-foreground",children:"Inicia una conversación"}),e.jsxs("p",{className:"text-muted-foreground max-w-xs",children:[s," está esperando para charlar. ¡Pregúntale sobre sus cuidados o simplemente saluda!"]})]}),Y=()=>{const{plantId:s}=g(),t=h(),{loading:n,error:a}=k(s),{plant:r,isTyping:i,handleSendMessage:c}=L(),d=l.useRef(null);return l.useEffect(()=>{var m;(m=d.current)==null||m.scrollIntoView({behavior:"smooth"})},[r==null?void 0:r.chatHistory,i]),n?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-background text-foreground",children:[e.jsx(w,{className:"w-12 h-12 animate-spin text-green-500"}),e.jsx("p",{className:"mt-4 text-lg",children:"Cargando chat..."})]}):a?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-background text-red-500",children:[e.jsxs("p",{className:"mb-4",children:["Error: ",a]}),e.jsx("button",{onClick:()=>t(-1),className:"btn btn-primary",children:"Volver"})]}):r?e.jsxs("div",{className:"flex flex-col h-screen bg-background text-foreground",children:[e.jsx(A,{plant:r}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsx(v,{children:r.chatHistory.length===0?e.jsx(K,{plantName:r.nickname||r.name}):e.jsx(R,{messages:r.chatHistory,plantNickname:r.nickname||r.name})}),i&&e.jsx(I,{}),e.jsx("div",{ref:d})]}),e.jsx(T,{onSendMessage:c,isTyping:i})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-background text-foreground",children:[e.jsx("p",{className:"mb-4",children:"Planta no encontrada."}),e.jsx("button",{onClick:()=>t(-1),className:"btn btn-primary",children:"Volver"})]})};export{Y as default};
