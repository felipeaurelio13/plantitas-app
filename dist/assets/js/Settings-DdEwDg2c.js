import{j as d}from"./query-BtyC95ZO.js";import{r as l,R as te,b as ne}from"./vendor-ohv-86MT.js";import{u as re,a as oe,c as x}from"./index-DhY4zXqz.js";import{u as se}from"./router-Lz5I7iQY.js";import{m as ie,n as ae,I as ce,a1 as le,a2 as ue,s as de,a3 as fe,a4 as he,v as pe,f as ge,a5 as me,$ as be}from"./ui-BKcRNX0w.js";import"./supabase-ChG5PfJU.js";const j=(e,t)=>t.some(n=>e instanceof n);let B,O;function ye(){return B||(B=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function we(){return O||(O=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const D=new WeakMap,I=new WeakMap,C=new WeakMap;function Se(e){const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{n(b(e.result)),o()},i=()=>{r(e.error),o()};e.addEventListener("success",s),e.addEventListener("error",i)});return C.set(t,e),t}function ve(e){if(D.has(e))return;const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{n(),o()},i=()=>{r(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)});D.set(e,t)}let k={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return D.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return b(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function F(e){k=e(k)}function xe(e){return we().includes(e)?function(...t){return e.apply(N(this),t),b(this.request)}:function(...t){return b(e.apply(N(this),t))}}function Ce(e){return typeof e=="function"?xe(e):(e instanceof IDBTransaction&&ve(e),j(e,ye())?new Proxy(e,k):e)}function b(e){if(e instanceof IDBRequest)return Se(e);if(I.has(e))return I.get(e);const t=Ce(e);return t!==e&&(I.set(e,t),C.set(t,e)),t}const N=e=>C.get(e);function Ee(e,t,{blocked:n,upgrade:r,blocking:o,terminated:s}={}){const i=indexedDB.open(e,t),a=b(i);return r&&i.addEventListener("upgradeneeded",c=>{r(b(i.result),c.oldVersion,c.newVersion,b(i.transaction),c)}),n&&i.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),a.then(c=>{s&&c.addEventListener("close",()=>s()),o&&c.addEventListener("versionchange",u=>o(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const Ie=["get","getKey","getAll","getAllKeys","count"],Pe=["put","add","delete","clear"],P=new Map;function M(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(P.get(t))return P.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=Pe.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(o||Ie.includes(n)))return;const s=async function(i,...a){const c=this.transaction(i,o?"readwrite":"readonly");let u=c.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[n](...a),o&&c.done]))[0]};return P.set(t,s),s}F(e=>({...e,get:(t,n,r)=>M(t,n)||e.get(t,n,r),has:(t,n)=>!!M(t,n)||e.has(t,n)}));const je=["continue","continuePrimaryKey","advance"],A={},R=new WeakMap,W=new WeakMap,De={get(e,t){if(!je.includes(t))return e[t];let n=A[t];return n||(n=A[t]=function(...r){R.set(this,W.get(this)[t](...r))}),n}};async function*ke(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,De);for(W.set(n,t),C.set(n,N(t));t;)yield n,t=await(R.get(n)||t.continue()),R.delete(n)}function T(e,t){return t===Symbol.asyncIterator&&j(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&j(e,[IDBIndex,IDBObjectStore])}F(e=>({...e,get(t,n,r){return T(t,n)?ke:e.get(t,n,r)},has(t,n){return T(t,n)||e.has(t,n)}}));class Ne{db=null;async init(){return this.db?this.db:(this.db=await Ee("PlantCareDB",1,{upgrade(t){const n=t.createObjectStore("plants",{keyPath:"id"});n.createIndex("by-health","healthScore"),n.createIndex("by-date","dateAdded"),t.createObjectStore("images",{keyPath:"id"}),t.createObjectStore("settings",{keyPath:"key"})}}),this.db)}async savePlant(t){await(await this.init()).put("plants",t);const r=await this.getAllPlants();localStorage.setItem("plants",JSON.stringify(r))}async getPlant(t){return await(await this.init()).get("plants",t)}async getAllPlants(){return(await(await this.init()).getAll("plants")).map(r=>({...r,dateAdded:new Date(r.dateAdded),lastWatered:r.lastWatered?new Date(r.lastWatered):void 0,lastFertilized:r.lastFertilized?new Date(r.lastFertilized):void 0,images:r.images.map(o=>({...o,timestamp:new Date(o.timestamp)})),chatHistory:r.chatHistory.map(o=>({...o,timestamp:new Date(o.timestamp)})),notifications:r.notifications.map(o=>({...o,scheduledFor:new Date(o.scheduledFor)}))}))}async deletePlant(t){await(await this.init()).delete("plants",t);const r=await this.getAllPlants();localStorage.setItem("plants",JSON.stringify(r))}async saveImageBlob(t,n,r){await(await this.init()).put("images",{id:t,plantId:n,blob:r,timestamp:new Date})}async getImageBlob(t){return(await(await this.init()).get("images",t))?.blob}async saveSetting(t,n){await(await this.init()).put("settings",{key:t,value:n})}async getSetting(t){return(await(await this.init()).get("settings",t))?.value}async exportData(){const t=await this.getAllPlants(),n={theme:await this.getSetting("theme"),notifications:await this.getSetting("notifications")};return JSON.stringify({plants:t,settings:n,exportDate:new Date().toISOString(),version:"1.0.0"},null,2)}async importData(t){try{const n=JSON.parse(t);if(n.plants)for(const r of n.plants)await this.savePlant(r);if(n.settings)for(const[r,o]of Object.entries(n.settings))o!==void 0&&await this.saveSetting(r,o)}catch{throw new Error("Invalid data format")}}async clearAllData(){const t=await this.init();await t.clear("plants"),await t.clear("images"),await t.clear("settings"),localStorage.removeItem("plants")}}const L=new Ne,Re=()=>{const{isDark:e,toggleTheme:t}=re(),{signOut:n,profile:r}=oe(),o=se(),s=async()=>{if(window.confirm("¿Estás seguro de que quieres cerrar sesión?"))try{await n(),o("/auth")}catch(u){console.error("Error signing out:",u)}},i=async()=>{try{const u=await L.exportData(),f=new Blob([u],{type:"application/json"}),h=URL.createObjectURL(f),p=document.createElement("a");p.href=h,p.download=`plantitas-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(h)}catch(u){console.error("Error exporting data:",u)}},a=async()=>{if(window.confirm("¿Estás seguro de que quieres eliminar todos tus datos? Esta acción es irreversible."))try{await L.clearAllData(),await s()}catch(u){console.error("Error clearing data:",u)}};return{settingsSections:l.useMemo(()=>[{title:"Cuenta",items:[{id:"signout",icon:"LogOut",label:"Cerrar sesión",type:"button",onClick:s}]},{title:"Preferencias",items:[{id:"theme",icon:e?"Sun":"Moon",label:"Modo Oscuro",type:"toggle",toggleState:e,onToggleChange:t}]},{title:"Datos",items:[{id:"export",icon:"Download",label:"Exportar mis datos",type:"button",onClick:i,disabled:!r||!1},{id:"delete",icon:"Trash2",label:"Eliminar mis datos",type:"button",onClick:a,disabled:!r||!1}]},{title:"Soporte",items:[]}],[e,r,s,t])}},Be=({title:e,children:t,delay:n=0})=>d.jsxs(ie.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:n*.1},className:"space-y-3",children:[d.jsx("h2",{className:"text-lg font-bold text-foreground px-4",children:e}),d.jsx("div",{className:"bg-muted/50 rounded-2xl overflow-hidden",children:t})]});function Oe(e,t,{checkForDefaultPrevented:n=!0}={}){return function(o){if(e?.(o),n===!1||!o.defaultPrevented)return t?.(o)}}function _(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function $(...e){return t=>{let n=!1;const r=e.map(o=>{const s=_(o,t);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let o=0;o<r.length;o++){const s=r[o];typeof s=="function"?s():_(e[o],null)}}}}function V(...e){return l.useCallback($(...e),e)}function Me(e,t=[]){let n=[];function r(s,i){const a=l.createContext(i),c=n.length;n=[...n,i];const u=h=>{const{scope:p,children:g,...m}=h,y=p?.[e]?.[c]||a,w=l.useMemo(()=>m,Object.values(m));return d.jsx(y.Provider,{value:w,children:g})};u.displayName=s+"Provider";function f(h,p){const g=p?.[e]?.[c]||a,m=l.useContext(g);if(m)return m;if(i!==void 0)return i;throw new Error(`\`${h}\` must be used within \`${s}\``)}return[u,f]}const o=()=>{const s=n.map(i=>l.createContext(i));return function(a){const c=a?.[e]||s;return l.useMemo(()=>({[`__scope${e}`]:{...a,[e]:c}}),[a,c])}};return o.scopeName=e,[r,Ae(o,...t)]}function Ae(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:c,scopeName:u})=>{const h=c(s)[`__scope${u}`];return{...a,...h}},{});return l.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return n.scopeName=t.scopeName,n}var H=globalThis?.document?l.useLayoutEffect:()=>{},Te=te[" useInsertionEffect ".trim().toString()]||H;function Le({prop:e,defaultProp:t,onChange:n=()=>{},caller:r}){const[o,s,i]=_e({defaultProp:t,onChange:n}),a=e!==void 0,c=a?e:o;{const f=l.useRef(e!==void 0);l.useEffect(()=>{const h=f.current;h!==a&&console.warn(`${r} is changing from ${h?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),f.current=a},[a,r])}const u=l.useCallback(f=>{if(a){const h=ze(f)?f(e):f;h!==e&&i.current?.(h)}else s(f)},[a,e,s,i]);return[c,u]}function _e({defaultProp:e,onChange:t}){const[n,r]=l.useState(e),o=l.useRef(n),s=l.useRef(t);return Te(()=>{s.current=t},[t]),l.useEffect(()=>{o.current!==n&&(s.current?.(n),o.current=n)},[n,o]),[n,r,s]}function ze(e){return typeof e=="function"}function Fe(e){const t=l.useRef({value:e,previous:e});return l.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}function We(e){const[t,n]=l.useState(void 0);return H(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const s=o[0];let i,a;if("borderBoxSize"in s){const c=s.borderBoxSize,u=Array.isArray(c)?c[0]:c;i=u.inlineSize,a=u.blockSize}else i=e.offsetWidth,a=e.offsetHeight;n({width:i,height:a})});return r.observe(e,{box:"border-box"}),()=>r.unobserve(e)}else n(void 0)},[e]),t}function $e(e){const t=Ve(e),n=l.forwardRef((r,o)=>{const{children:s,...i}=r,a=l.Children.toArray(s),c=a.find(Ue);if(c){const u=c.props.children,f=a.map(h=>h===c?l.Children.count(u)>1?l.Children.only(null):l.isValidElement(u)?u.props.children:null:h);return d.jsx(t,{...i,ref:o,children:l.isValidElement(u)?l.cloneElement(u,void 0,f):null})}return d.jsx(t,{...i,ref:o,children:s})});return n.displayName=`${e}.Slot`,n}function Ve(e){const t=l.forwardRef((n,r)=>{const{children:o,...s}=n;if(l.isValidElement(o)){const i=Je(o),a=qe(s,o.props);return o.type!==l.Fragment&&(a.ref=r?$(r,i):i),l.cloneElement(o,a)}return l.Children.count(o)>1?l.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var He=Symbol("radix.slottable");function Ue(e){return l.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===He}function qe(e,t){const n={...t};for(const r in t){const o=e[r],s=t[r];/^on[A-Z]/.test(r)?o&&s?n[r]=(...a)=>{const c=s(...a);return o(...a),c}:o&&(n[r]=o):r==="style"?n[r]={...o,...s}:r==="className"&&(n[r]=[o,s].filter(Boolean).join(" "))}return{...e,...n}}function Je(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var Ke=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],U=Ke.reduce((e,t)=>{const n=$e(`Primitive.${t}`),r=l.forwardRef((o,s)=>{const{asChild:i,...a}=o,c=i?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),d.jsx(c,{...a,ref:s})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{}),E="Switch",[Ge,at]=Me(E),[Xe,Ze]=Ge(E),q=l.forwardRef((e,t)=>{const{__scopeSwitch:n,name:r,checked:o,defaultChecked:s,required:i,disabled:a,value:c="on",onCheckedChange:u,form:f,...h}=e,[p,g]=l.useState(null),m=V(t,v=>g(v)),y=l.useRef(!1),w=p?f||!!p.closest("form"):!0,[S,Y]=Le({prop:o,defaultProp:s??!1,onChange:u,caller:E});return d.jsxs(Xe,{scope:n,checked:S,disabled:a,children:[d.jsx(U.button,{type:"button",role:"switch","aria-checked":S,"aria-required":i,"data-state":X(S),"data-disabled":a?"":void 0,disabled:a,value:c,...h,ref:m,onClick:Oe(e.onClick,v=>{Y(ee=>!ee),w&&(y.current=v.isPropagationStopped(),y.current||v.stopPropagation())})}),w&&d.jsx(G,{control:p,bubbles:!y.current,name:r,value:c,checked:S,required:i,disabled:a,form:f,style:{transform:"translateX(-100%)"}})]})});q.displayName=E;var J="SwitchThumb",K=l.forwardRef((e,t)=>{const{__scopeSwitch:n,...r}=e,o=Ze(J,n);return d.jsx(U.span,{"data-state":X(o.checked),"data-disabled":o.disabled?"":void 0,...r,ref:t})});K.displayName=J;var Qe="SwitchBubbleInput",G=l.forwardRef(({__scopeSwitch:e,control:t,checked:n,bubbles:r=!0,...o},s)=>{const i=l.useRef(null),a=V(i,s),c=Fe(n),u=We(t);return l.useEffect(()=>{const f=i.current;if(!f)return;const h=window.HTMLInputElement.prototype,g=Object.getOwnPropertyDescriptor(h,"checked").set;if(c!==n&&g){const m=new Event("click",{bubbles:r});g.call(f,n),f.dispatchEvent(m)}},[c,n,r]),d.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...o,tabIndex:-1,ref:a,style:{...o.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});G.displayName=Qe;function X(e){return e?"checked":"unchecked"}var Z=q,Ye=K;const Q=l.forwardRef(({className:e,...t},n)=>d.jsx(Z,{className:x("peer inline-flex h-7 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...t,ref:n,children:d.jsx(Ye,{className:x("pointer-events-none block h-6 w-6 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));Q.displayName=Z.displayName;const z=({icon:e,label:t,value:n,onClick:r,isLast:o=!1,type:s="button",disabled:i=!1,toggleState:a=!1,onToggleChange:c})=>{const u=ne.useId(),f=d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-background",children:d.jsx(e,{size:18,className:"text-muted-foreground"})}),d.jsx("span",{className:"font-medium text-foreground",children:t})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[s==="button"&&d.jsxs(d.Fragment,{children:[n&&d.jsx("span",{className:"text-sm text-muted-foreground",children:n}),d.jsx(ae,{size:16,className:"text-muted-foreground/50"})]}),s==="toggle"&&d.jsx(Q,{id:u,checked:a,onCheckedChange:c,"aria-label":t})]})]}),h=x("flex w-full items-center justify-between p-3 text-left",!o&&"border-b border-background",r&&"transition-colors hover:bg-background/50");return s==="button"?d.jsx("button",{onClick:r,className:h,disabled:i,children:f}):d.jsx("label",{htmlFor:u,className:x(h,"cursor-pointer"),children:f})},et={User:be,LogOut:me,Sun:ge,Moon:pe,Bell:he,Download:fe,Trash2:de,HelpCircle:ue,Shield:le,Info:ce},ct=()=>{const{settingsSections:e}=Re();return d.jsxs("div",{className:"p-4 space-y-6",children:[d.jsxs("header",{children:[d.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Configuración"}),d.jsx("p",{className:"text-muted-foreground",children:"Gestiona tu cuenta y preferencias de la app."})]}),e.map((t,n)=>d.jsx(Be,{title:t.title,delay:n,children:t.items.map((r,o)=>{const s=et[r.icon],i=o===t.items.length-1;return r.type==="toggle"?d.jsx(z,{icon:s,label:r.label,isLast:i,type:"toggle",toggleState:"toggleState"in r?r.toggleState:!1,onToggleChange:"onToggleChange"in r?r.onToggleChange:void 0},r.id):d.jsx(z,{icon:s,label:r.label,value:"value"in r&&typeof r.value=="string"?r.value:void 0,onClick:"onClick"in r?r.onClick:void 0,isLast:i,type:"button",disabled:"disabled"in r?r.disabled:!1},r.id)})},t.title))]})};export{ct as default};
