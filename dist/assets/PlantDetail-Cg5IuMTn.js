import{d as Ze,i as Je,f as B,e as me,g as Te,p as es,v as ss,h as ts,k as as,l as rs,o as Le,q as ns,s as ls,w as ue,x as O,r as j,y as He,z as ge,M as is,B as re,c as N,C as De,D as Re,E as he,F as _,G as pe,H as os,I as cs,j as e,m as x,A as q,X as qe,J as ds,K as ms,u as Fe,N as fe,O as us,T as ie,P as je,Q as oe,R as hs,a as ce,S as xs,n as ye}from"./index-IWlstUSv.js";import{L as Q,u as gs}from"./usePlantDetail-DLl7IC-K.js";import{a as X,C as H,u as ps,I as Oe}from"./usePlantMutations-BJp3ryRm.js";import{C as U,c as J,a as ve,b as be,M as fs}from"./Card-C-20Zba6.js";import{L as ee,U as js,W as ys,S as f}from"./skeleton-By94OR74.js";import{C as vs,T as bs,M as Ns}from"./trash-2-Xa7qe-NQ.js";import{B as C,S as T}from"./Button-DJtJhVfV.js";import{A as ws}from"./arrow-left-mk6TicAG.js";import{E as ks,S as Cs,L as Be}from"./sprout-DhCP3zdl.js";import{S as V}from"./sun-BGxn3_Au.js";import"./index-Bnwr932r.js";const Y=new WeakMap;let M;const Ve=(s,t,r)=>(a,n)=>n&&n[0]?n[0][s+"Size"]:Je(a)&&"getBBox"in a?a.getBBox()[t]:a[r],Es=Ve("inline","width","offsetWidth"),Is=Ve("block","height","offsetHeight");function Ss({target:s,borderBoxSize:t}){var r;(r=Y.get(s))==null||r.forEach(a=>{a(s,{get width(){return Es(s,t)},get height(){return Is(s,t)}})})}function Ps(s){s.forEach(Ss)}function zs(){typeof ResizeObserver>"u"||(M=new ResizeObserver(Ps))}function As(s,t){M||zs();const r=Ze(s);return r.forEach(a=>{let n=Y.get(a);n||(n=new Set,Y.set(a,n)),n.add(t),M==null||M.observe(a)}),()=>{r.forEach(a=>{const n=Y.get(a);n==null||n.delete(t),n!=null&&n.size||M==null||M.unobserve(a)})}}const Z=new Set;let R;function Ms(){R=()=>{const s={get width(){return window.innerWidth},get height(){return window.innerHeight}};Z.forEach(t=>t(s))},window.addEventListener("resize",R)}function Ts(s){return Z.add(s),R||Ms(),()=>{Z.delete(s),!Z.size&&typeof R=="function"&&(window.removeEventListener("resize",R),R=void 0)}}function Ls(s,t){return typeof s=="function"?Ts(s):As(s,t)}function Ue(s,t){let r;const a=()=>{const{currentTime:n}=t,u=(n===null?0:n.value)/100;r!==u&&s(u),r=u};return B.preUpdate(a,!0),()=>me(a)}function Hs(...s){const t=!Array.isArray(s[0]),r=t?0:-1,a=s[0+r],n=s[1+r],o=s[2+r],u=s[3+r],l=Te(n,o,u);return t?l(a):l}const Ds=50,Ne=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),Rs=()=>({time:0,x:Ne(),y:Ne()}),qs={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function we(s,t,r,a){const n=r[t],{length:o,position:u}=qs[t],l=n.current,c=r.time;n.current=s[`scroll${u}`],n.scrollLength=s[`scroll${o}`]-s[`client${o}`],n.offset.length=0,n.offset[0]=0,n.offset[1]=n.scrollLength,n.progress=es(0,n.scrollLength,n.current);const d=a-c;n.velocity=d>Ds?0:ss(n.current-l,d)}function Fs(s,t,r){we(s,"x",t,r),we(s,"y",t,r),t.time=r}function Os(s,t){const r={x:0,y:0};let a=s;for(;a&&a!==t;)if(ts(a))r.x+=a.offsetLeft,r.y+=a.offsetTop,a=a.offsetParent;else if(a.tagName==="svg"){const n=a.getBoundingClientRect();a=a.parentElement;const o=a.getBoundingClientRect();r.x+=n.left-o.left,r.y+=n.top-o.top}else if(a instanceof SVGGraphicsElement){const{x:n,y:o}=a.getBBox();r.x+=n,r.y+=o;let u=null,l=a.parentNode;for(;!u;)l.tagName==="svg"&&(u=l),l=a.parentNode;a=u}else break;return r}const de={start:0,center:.5,end:1};function ke(s,t,r=0){let a=0;if(s in de&&(s=de[s]),typeof s=="string"){const n=parseFloat(s);s.endsWith("px")?a=n:s.endsWith("%")?s=n/100:s.endsWith("vw")?a=n/100*document.documentElement.clientWidth:s.endsWith("vh")?a=n/100*document.documentElement.clientHeight:s=n}return typeof s=="number"&&(a=t*s),r+a}const Bs=[0,0];function Vs(s,t,r,a){let n=Array.isArray(s)?s:Bs,o=0,u=0;return typeof s=="number"?n=[s,s]:typeof s=="string"&&(s=s.trim(),s.includes(" ")?n=s.split(" "):n=[s,de[s]?s:"0"]),o=ke(n[0],r,a),u=ke(n[1],t),o-u}const Us={All:[[0,0],[1,1]]},$s={x:0,y:0};function Ws(s){return"getBBox"in s&&s.tagName!=="svg"?s.getBBox():{width:s.clientWidth,height:s.clientHeight}}function Gs(s,t,r){const{offset:a=Us.All}=r,{target:n=s,axis:o="y"}=r,u=o==="y"?"height":"width",l=n!==s?Os(n,s):$s,c=n===s?{width:s.scrollWidth,height:s.scrollHeight}:Ws(n),d={width:s.clientWidth,height:s.clientHeight};t[o].offset.length=0;let m=!t[o].interpolate;const i=a.length;for(let h=0;h<i;h++){const g=Vs(a[h],d[u],c[u],l[o]);!m&&g!==t[o].interpolatorOffsets[h]&&(m=!0),t[o].offset[h]=g}m&&(t[o].interpolate=Te(t[o].offset,as(a),{clamp:!1}),t[o].interpolatorOffsets=[...t[o].offset]),t[o].progress=rs(0,1,t[o].interpolate(t[o].current))}function _s(s,t=s,r){if(r.x.targetOffset=0,r.y.targetOffset=0,t!==s){let a=t;for(;a&&a!==s;)r.x.targetOffset+=a.offsetLeft,r.y.targetOffset+=a.offsetTop,a=a.offsetParent}r.x.targetLength=t===s?t.scrollWidth:t.clientWidth,r.y.targetLength=t===s?t.scrollHeight:t.clientHeight,r.x.containerLength=s.clientWidth,r.y.containerLength=s.clientHeight}function Ks(s,t,r,a={}){return{measure:n=>{_s(s,a.target,r),Fs(s,r,n),(a.offset||a.target)&&Gs(s,r,a)},notify:()=>t(r)}}const F=new WeakMap,Ce=new WeakMap,ne=new WeakMap,Ee=s=>s===document.scrollingElement?window:s;function $e(s,{container:t=document.scrollingElement,...r}={}){if(!t)return Le;let a=ne.get(t);a||(a=new Set,ne.set(t,a));const n=Rs(),o=Ks(t,s,n,r);if(a.add(o),!F.has(t)){const l=()=>{for(const i of a)i.measure(ns.timestamp);B.preUpdate(c)},c=()=>{for(const i of a)i.notify()},d=()=>B.read(l);F.set(t,d);const m=Ee(t);window.addEventListener("resize",d,{passive:!0}),t!==document.documentElement&&Ce.set(t,Ls(t,d)),m.addEventListener("scroll",d,{passive:!0}),d()}const u=F.get(t);return B.read(u,!1,!0),()=>{var d;me(u);const l=ne.get(t);if(!l||(l.delete(o),l.size))return;const c=F.get(t);F.delete(t),c&&(Ee(t).removeEventListener("scroll",c),(d=Ce.get(t))==null||d(),window.removeEventListener("resize",c))}}const Ie=new Map;function Qs(s){const t={value:0},r=$e(a=>{t.value=a[s.axis].progress*100},s);return{currentTime:t,cancel:r}}function We({source:s,container:t,...r}){const{axis:a}=r;s&&(t=s);const n=Ie.get(t)??new Map;Ie.set(t,n);const o=r.target??"self",u=n.get(o)??{},l=a+(r.offset??[]).join(",");return u[l]||(u[l]=!r.target&&ls()?new ScrollTimeline({source:t,axis:a}):Qs({container:t,...r})),u[l]}function Xs(s,t){const r=We(t);return s.attachTimeline({timeline:t.target?void 0:r,observe:a=>(a.pause(),Ue(n=>{a.time=a.duration*n},r))})}function Ys(s){return s.length===2}function Zs(s,t){return Ys(s)?$e(r=>{s(r[t.axis].progress,r)},t):Ue(s,We(t))}function Js(s,{axis:t="y",container:r=document.scrollingElement,...a}={}){if(!r)return Le;const n={axis:t,container:r,...a};return typeof s=="function"?Zs(s,n):Xs(s,n)}const et=()=>({scrollX:O(0),scrollY:O(0),scrollXProgress:O(0),scrollYProgress:O(0)}),K=s=>s?!s.current:!1;function st({container:s,target:t,...r}={}){const a=ue(et),n=j.useRef(null),o=j.useRef(!1),u=j.useCallback(()=>(n.current=Js((l,{x:c,y:d})=>{a.scrollX.set(c.current),a.scrollXProgress.set(c.progress),a.scrollY.set(d.current),a.scrollYProgress.set(d.progress)},{...r,container:(s==null?void 0:s.current)||void 0,target:(t==null?void 0:t.current)||void 0}),()=>{var l;(l=n.current)==null||l.call(n)}),[s,t,JSON.stringify(r.offset)]);return He(()=>{if(o.current=!1,K(s)||K(t)){o.current=!0;return}else return u()},[u]),j.useEffect(()=>{if(o.current)return ge(!K(s)),ge(!K(t)),u()},[u]),a}function tt(s){const t=ue(()=>O(s)),{isStatic:r}=j.useContext(is);if(r){const[,a]=j.useState(s);j.useEffect(()=>t.on("change",a),[])}return t}function Ge(s,t){const r=tt(t()),a=()=>r.set(t());return a(),He(()=>{const n=()=>B.preRender(a,!1,!0),o=s.map(u=>u.on("change",n));return()=>{o.forEach(u=>u()),me(a)}}),r}function at(s){re.current=[],s();const t=Ge(re.current,s);return re.current=void 0,t}function Se(s,t,r,a){if(typeof s=="function")return at(s);const n=typeof t=="function"?t:Hs(t,r,a);return Array.isArray(s)?Pe(s,n):Pe([s],([o])=>n(o))}function Pe(s,t){const r=ue(()=>[]);return Ge(s,()=>{r.length=0;const a=s.length;for(let n=0;n<a;n++)r[n]=s[n].get();return t(r)})}/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=N("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=N("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=N("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=N("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=N("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=N("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=N("Flower",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M12 16.5A4.5 4.5 0 1 1 7.5 12 4.5 4.5 0 1 1 12 7.5a4.5 4.5 0 1 1 4.5 4.5 4.5 4.5 0 1 1-4.5 4.5",key:"14wa3c"}],["path",{d:"M12 7.5V9",key:"1oy5b0"}],["path",{d:"M7.5 12H9",key:"eltsq1"}],["path",{d:"M16.5 12H15",key:"vk5kw4"}],["path",{d:"M12 16.5V15",key:"k7eayi"}],["path",{d:"m8 8 1.88 1.88",key:"nxy4qf"}],["path",{d:"M14.12 9.88 16 8",key:"1lst6k"}],["path",{d:"m8 16 1.88-1.88",key:"h2eex1"}],["path",{d:"M14.12 14.12 16 16",key:"uqkrx3"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=N("HeartPulse",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}],["path",{d:"M3.22 12H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"1uw2ng"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=N("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=N("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=N("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=N("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=N("Syringe",[["path",{d:"m18 2 4 4",key:"22kx64"}],["path",{d:"m17 7 3-3",key:"1w1zoj"}],["path",{d:"M19 9 8.7 19.3c-1 1-2.5 1-3.4 0l-.6-.6c-1-1-1-2.5 0-3.4L15 5",key:"1exhtz"}],["path",{d:"m9 11 4 4",key:"rovt3i"}],["path",{d:"m5 19-3 3",key:"59f2uf"}],["path",{d:"m14 4 6 6",key:"yqp9t2"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=N("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=N("TreePine",[["path",{d:"m17 14 3 3.3a1 1 0 0 1-.7 1.7H4.7a1 1 0 0 1-.7-1.7L7 14h-.3a1 1 0 0 1-.7-1.7L9 9h-.2A1 1 0 0 1 8 7.3L12 3l4 4.3a1 1 0 0 1-.8 1.7H15l3 3.3a1 1 0 0 1-.7 1.7H17Z",key:"cpyugq"}],["path",{d:"M12 22v-3",key:"kmzjlo"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=N("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=N("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=N("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),xt=()=>{const s=De(),t=Re(l=>l.user),r=t==null?void 0:t.id,{addToast:a}=he(),n=X({mutationFn:async({plantId:l,imageDataUrl:c,note:d})=>{var m;if(!r)throw new Error("User not authenticated");console.log("🖼️ [Image] Iniciando proceso de subida de imagen...");try{console.log("🔬 [Image] Analizando imagen con IA...");const i=await os(c);if(!i||!i.health)throw new Error("No se pudo obtener un análisis válido de la imagen");console.log("☁️ [Image] Subiendo imagen a Storage...");const h=await cs(c,"plant-images",`${r}/${l}`);if(!h)throw new Error("No se pudo obtener la URL de la imagen subida");console.log("💾 [Image] Guardando registro en base de datos...");const g=await _.addPlantImage(l,{url:h,timestamp:new Date,isProfileImage:!1,healthAnalysis:i.health},r);if(!g||!g.id)throw new Error("No se pudo guardar la imagen en la base de datos");return(m=i.health)!=null&&m.confidence&&typeof i.health.confidence=="number"&&(console.log("🏥 [Image] Actualizando health score de la planta..."),await _.updatePlantHealthScore(l,r,i.health.confidence,i.health,g.id)),console.log("✅ [Image] Proceso completado exitosamente"),{image:g,analysis:i,note:d}}catch(i){throw console.error("💥 [Image] Error en proceso de subida:",i),i instanceof Error?i.message.includes("Storage error")?new Error("Error al subir la imagen. Verifica tu conexión a internet."):i.message.includes("analyze image")?new Error("Error al analizar la imagen. Intenta con una foto más clara."):i.message.includes("database")?new Error("Error al guardar la imagen. Intenta de nuevo."):i:new Error("Error inesperado al procesar la imagen")}},onSuccess:(l,c)=>{var i,h,g;s.invalidateQueries({queryKey:["plants"]}),s.invalidateQueries({queryKey:["plant",c.plantId]});const{setPlant:d}=pe.getState(),m=pe.getState().getPlantById(c.plantId);if(m){const b={...m,images:[...m.images,l.image],healthScore:((i=l.analysis.health)==null?void 0:i.confidence)||m.healthScore};d(b)}a({type:"success",title:"Nueva imagen añadida",message:`Análisis completado. Salud actual: ${((g=(h=l.analysis.health)==null?void 0:h.confidence)==null?void 0:g.toFixed(0))||"N/A"}%`})},onError:l=>{console.error("💥 [Image] Error en proceso de subida:",l),a({type:"error",title:"Error al agregar imagen",message:l.message})}}),o=X({mutationFn:async({plantId:l,imageId:c})=>{if(!r)throw new Error("User not authenticated");return console.log("🖼️ [Profile] Cambiando imagen de perfil..."),await _.setProfileImage(l,c,r),{plantId:l,imageId:c}},onSuccess:l=>{s.invalidateQueries({queryKey:["plants"]}),s.invalidateQueries({queryKey:["plant",l.plantId]}),a({type:"success",title:"Imagen de perfil actualizada",message:"La imagen principal de la planta ha sido cambiada"})},onError:l=>{a({type:"error",title:"Error al cambiar imagen de perfil",message:l.message})}}),u=X({mutationFn:async({plantId:l,imageId:c})=>{if(!r)throw new Error("User not authenticated");return console.log("🗑️ [Image] Eliminando imagen..."),await _.deleteImage(c,r),{plantId:l,imageId:c}},onSuccess:l=>{s.invalidateQueries({queryKey:["plants"]}),s.invalidateQueries({queryKey:["plant",l.plantId]}),a({type:"success",title:"Imagen eliminada",message:"La imagen ha sido eliminada de tu planta"})},onError:l=>{a({type:"error",title:"Error al eliminar imagen",message:l.message})}});return{addPlantImage:n.mutate,isAddingImage:n.isPending,setProfileImage:o.mutate,isSettingProfileImage:o.isPending,deleteImage:u.mutate,isDeletingImage:u.isPending}};function gt({images:s}){const[t,r]=j.useState(null);if(!s||s.length===0)return e.jsx(U,{className:"mt-4",children:e.jsx(J,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(H,{className:"w-12 h-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No hay imágenes para esta planta todavía."}),e.jsx("p",{className:"text-sm text-muted-foreground/70 mt-2",children:"¡Agrega algunas fotos para seguir su progreso!"})]})})});const a=[...s].sort((c,d)=>new Date(d.timestamp).getTime()-new Date(c.timestamp).getTime()),n=c=>{r(c)},o=()=>{r(null)},u=c=>{if(t===null)return;const d=c==="prev"?(t-1+a.length)%a.length:(t+1)%a.length;r(d)},l=c=>(c instanceof Date?c:new Date(c)).toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"});return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold tracking-tight flex items-center",children:[e.jsx(H,{className:"w-5 h-5 mr-2 text-primary"}),"Galería de Imágenes"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[a.length," foto",a.length!==1?"s":""]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:a.map((c,d)=>e.jsxs(x.div,{className:"aspect-square relative rounded-xl overflow-hidden cursor-pointer group",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>n(d),children:[e.jsx(ee,{src:c.url,alt:`Imagen de planta del ${l(c.timestamp)}`,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-3",children:e.jsxs("div",{className:"flex items-center text-white text-xs gap-2",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(se,{className:"w-3 h-3 mr-1"}),l(c.timestamp)]}),(()=>{const m=c.healthAnalysis;if(!m)return null;const i={excellent:95,good:80,fair:60,poor:30};let h;return m.overallHealth&&i[m.overallHealth]?h=i[m.overallHealth]:typeof m.confidence=="number"&&(h=m.confidence<=1?m.confidence*100:m.confidence),h!==void 0?e.jsxs("span",{className:"ml-2",children:[Math.round(h),"% salud"]}):null})()]})})}),c.isProfileImage&&e.jsx("div",{className:"absolute top-2 right-2 bg-primary text-primary-foreground text-xs px-2 py-1 rounded-full font-medium",children:"Principal"})]},c.id))}),e.jsx(q,{children:t!==null&&e.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",onClick:o,children:e.jsxs(x.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},className:"relative max-w-4xl max-h-full",onClick:c=>c.stopPropagation(),children:[e.jsx("button",{onClick:o,className:"absolute top-4 right-4 z-10 bg-black/50 text-white p-2 rounded-full hover:bg-black/70 transition-colors",children:e.jsx(qe,{className:"w-6 h-6"})}),a.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>u("prev"),className:"absolute left-4 top-1/2 -translate-y-1/2 z-10 bg-black/50 text-white p-2 rounded-full hover:bg-black/70 transition-colors",children:e.jsx(it,{className:"w-6 h-6"})}),e.jsx("button",{onClick:()=>u("next"),className:"absolute right-4 top-1/2 -translate-y-1/2 z-10 bg-black/50 text-white p-2 rounded-full hover:bg-black/70 transition-colors",children:e.jsx(vs,{className:"w-6 h-6"})})]}),e.jsx("img",{src:a[t].url,alt:`Imagen de planta del ${l(a[t].timestamp)}`,className:"max-w-full max-h-full object-contain rounded-lg"}),e.jsxs("div",{className:"absolute bottom-4 left-4 right-4 bg-black/50 text-white p-4 rounded-lg backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm",children:l(a[t].timestamp)})]}),e.jsxs("span",{className:"text-sm text-white/70",children:[t+1," de ",a.length]})]}),e.jsx("div",{className:"mt-2 text-sm flex items-center gap-2",children:(()=>{const c=a[t].healthAnalysis;if(!c)return e.jsx("span",{className:"italic text-white/60",children:"Sin análisis"});let d="🌱",m="Excelente";switch(c.overallHealth){case"excellent":d="🌱",m="Excelente";break;case"good":d="🌿",m="Buena";break;case"fair":d="🍃",m="Regular";break;case"poor":d="🥀",m="Baja";break;default:d="🌱",m=c.overallHealth}let i;const h={excellent:95,good:80,fair:60,poor:30};return c.overallHealth&&h[c.overallHealth]?i=h[c.overallHealth]:typeof c.confidence=="number"&&(i=c.confidence<=1?c.confidence*100:c.confidence),e.jsxs("span",{children:["Salud: ",e.jsx("span",{className:"font-semibold",children:m})," ",e.jsx("span",{children:d}),i!==void 0&&e.jsxs("span",{className:"ml-2",children:["(",Math.round(i),"%)"]})]})})()}),a[t].isProfileImage&&e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"bg-primary text-primary-foreground text-xs px-2 py-1 rounded-full",children:"Imagen Principal"})})]})]})})})]})}const pt=new ms,ft=()=>{const[s,t]=j.useState(!1),r=De(),a=Re(l=>l.user),{addToast:n}=he(),o=X({mutationFn:async({plantId:l,species:c,commonName:d})=>{if(!a)throw new Error("User not authenticated");t(!0),n({type:"info",title:"🤖 Completando información",message:`Consultando IA para ${d||c}...`,duration:3e3});try{const m=await ds(c,d);return await pt.updatePlantInfo(l,a.id,{plantEnvironment:m.plantEnvironment,lightRequirements:m.lightRequirements,description:m.description,funFacts:m.funFacts})}catch(m){throw console.error("❌ [COMPLETAR IA] Error durante el proceso:",m),m}finally{t(!1)}},onSuccess:l=>{console.log("🔄 [COMPLETAR IA] Refrescando datos en cache..."),n({type:"success",title:"✅ ¡Información completada!",message:`Se agregaron datos de ambiente y luz para ${l.name}`,duration:5e3}),r.invalidateQueries({queryKey:["plant",l.id]}),r.invalidateQueries({queryKey:["plants"]}),console.log("✅ [COMPLETAR IA] Cache actualizado correctamente")},onError:l=>{console.error("💥 [COMPLETAR IA] Error final en la operación:",l),n({type:"error",title:"❌ Error al completar información",message:"No se pudo obtener los datos de IA. Intenta de nuevo.",duration:7e3}),t(!1)}});return{completeInfo:(l,c,d)=>o.mutate({plantId:l,species:c,commonName:d}),isCompleting:s||o.isPending,error:o.error,isSuccess:o.isSuccess}},jt=({plant:s})=>{var $,W;const t=Fe(),[r,a]=j.useState(!1),[n,o]=j.useState(!1),{deletePlant:u,isDeletingPlant:l}=ps(),{completeInfo:c,isCompleting:d}=ft(),{scrollY:m}=st(),i=Se(m,[0,300],[0,150]),h=Se(m,[0,200],[1,.3]),g=(($=s.images)==null?void 0:$.find(p=>p.isProfileImage))||((W=s.images)==null?void 0:W[0]),b=!s.plantEnvironment||!s.lightRequirements,v=()=>{window.confirm("¿Estás seguro de que quieres eliminar esta planta? Esta acción es irreversible.")&&u(s.id,{onSuccess:()=>{t("/")}})},P=()=>{console.log("🎯 [UI] Usuario solicitó completar información con IA"),console.log("🌱 [UI] Datos de la planta:",{id:s.id,nombre:s.name,especie:s.species,ambienteActual:s.plantEnvironment||"No especificado",luzActual:s.lightRequirements||"No especificado"}),a(!1),o(!0)},I=()=>{console.log("✅ [UI] Usuario confirmó el completado automático"),o(!1),c(s.id,s.species,s.name)},A=()=>{console.log("❌ [UI] Usuario canceló el completado automático"),o(!1)},E=p=>(p instanceof Date?p:new Date(p)).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"}),z=p=>{switch(p){case"interior":return e.jsx(fe,{className:"w-4 h-4 mr-2"});case"exterior":return e.jsx(ze,{className:"w-4 h-4 mr-2"});case"ambos":return e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-3 h-3 mr-1"}),e.jsx(ze,{className:"w-3 h-3 mr-1"})]});default:return null}},w=p=>{switch(p){case"interior":return"Interior";case"exterior":return"Exterior";case"ambos":return"Interior/Exterior";default:return null}},y=p=>{switch(p){case"poca_luz":return e.jsx(Ns,{className:"w-4 h-4 mr-2"});case"luz_indirecta":return e.jsx(V,{className:"w-4 h-4 mr-2 opacity-60"});case"luz_directa_parcial":return e.jsx(V,{className:"w-4 h-4 mr-2 opacity-80"});case"pleno_sol":return e.jsx(V,{className:"w-4 h-4 mr-2"});default:return null}},S=p=>{switch(p){case"poca_luz":return"Poca luz";case"luz_indirecta":return"Luz indirecta";case"luz_directa_parcial":return"Sol parcial";case"pleno_sol":return"Pleno sol";default:return null}},te={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.2,delayChildren:.1}}},L={hidden:{y:20,opacity:0},visible:{y:0,opacity:1,transition:{type:"spring",damping:25,stiffness:120}}},ae={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.6}}};return j.useEffect(()=>{const p=()=>a(!1);if(r)return document.addEventListener("click",p),()=>document.removeEventListener("click",p)},[r]),e.jsxs(x.div,{className:"relative h-96 w-full overflow-hidden",variants:te,initial:"hidden",animate:"visible",children:[e.jsx(x.div,{className:"absolute inset-0 scale-110",style:{y:i,opacity:h},children:g?e.jsx(ee,{src:g.url,alt:s.name,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full bg-gradient-to-br from-green-400 via-green-500 to-green-600",children:e.jsx("div",{className:"absolute inset-0 opacity-30",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='7' cy='7' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}})})}),e.jsxs(x.div,{className:"absolute inset-0",variants:ae,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent via-transparent to-black/30"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-background/60 to-transparent"})]}),e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 pt-safe-top z-20",children:e.jsxs(x.div,{className:"flex items-center justify-between",variants:L,children:[e.jsx(C,{"aria-label":"Volver atrás",variant:"ghost",size:"icon",onClick:()=>t("/"),className:"glass-button-white-text rounded-full transition-all duration-300",children:e.jsx(ws,{size:20})}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(C,{"aria-label":"Más opciones",variant:"ghost",size:"icon",onClick:p=>{p.stopPropagation(),a(k=>!k)},className:"glass-button-white-text rounded-full transition-all duration-300",children:e.jsx(ks,{size:20})}),e.jsx(q,{children:r&&e.jsx(x.div,{initial:{opacity:0,scale:.95,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-10},transition:{duration:.15},className:"absolute right-0 mt-2 w-48 origin-top-right rounded-xl bg-background/95 backdrop-blur-lg shadow-xl ring-1 ring-black/10 focus:outline-none z-30 border border-border/50",onClick:p=>p.stopPropagation(),children:e.jsxs("div",{className:"py-2",children:[b&&e.jsxs("button",{onClick:P,disabled:d,className:"flex w-full items-center px-4 py-3 text-sm text-foreground hover:bg-muted/70 transition-colors rounded-lg mx-2",children:[d?e.jsx(Q,{className:"mr-3 h-4 w-4 animate-spin"}):e.jsx(T,{className:"mr-3 h-4 w-4"}),e.jsx("span",{children:d?"Completando...":"Completar con IA"})]}),e.jsx("div",{className:"flex w-full items-center px-2 py-1",children:e.jsx(js,{plant:s,variant:"outline",size:"sm",showLabel:!0,className:"w-full"})}),e.jsxs("button",{onClick:v,disabled:l,className:"flex w-full items-center px-4 py-3 text-sm text-destructive hover:bg-destructive/10 transition-colors rounded-lg mx-2",children:[l?e.jsx(Q,{className:"mr-3 h-4 w-4 animate-spin"}):e.jsx(bs,{className:"mr-3 h-4 w-4"}),e.jsx("span",{children:l?"Eliminando...":"Eliminar planta"})]})]})})})]})})]})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 pb-safe-bottom z-10",children:e.jsxs(x.div,{className:"space-y-4",variants:L,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x.h1,{className:"text-heading-1 font-bold text-white drop-shadow-lg",variants:L,children:s.nickname||s.name}),e.jsx(x.p,{className:"text-body-large text-white/90 font-medium",variants:L,children:s.species})]}),e.jsxs(x.div,{className:"flex flex-wrap gap-4 pt-2",variants:L,children:[s.location&&e.jsxs("div",{className:"flex items-center text-white/80 bg-black/30 backdrop-blur-sm px-3 py-2 rounded-full border border-white/20",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-ui font-medium",children:s.location})]}),s.dateAdded&&e.jsxs("div",{className:"flex items-center text-white/80 bg-black/30 backdrop-blur-sm px-3 py-2 rounded-full border border-white/20",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{className:"text-ui font-medium",children:["Desde ",E(s.dateAdded)]})]}),s.plantEnvironment&&w(s.plantEnvironment)&&e.jsxs("div",{className:"flex items-center text-white/80 bg-black/30 backdrop-blur-sm px-3 py-2 rounded-full border border-white/20",children:[z(s.plantEnvironment),e.jsx("span",{className:"text-ui font-medium",children:w(s.plantEnvironment)})]}),s.lightRequirements&&S(s.lightRequirements)&&e.jsxs("div",{className:"flex items-center text-white/80 bg-black/30 backdrop-blur-sm px-3 py-2 rounded-full border border-white/20",children:[y(s.lightRequirements),e.jsx("span",{className:"text-ui font-medium",children:S(s.lightRequirements)})]}),s.images&&s.images.length>0&&e.jsx("div",{className:"flex items-center text-white/80 bg-black/30 backdrop-blur-sm px-3 py-2 rounded-full border border-white/20",children:e.jsxs("span",{className:"text-sm font-medium",children:[s.images.length," foto",s.images.length!==1?"s":""]})})]})]})}),e.jsx(q,{children:n&&e.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:A,children:e.jsxs(x.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:p=>p.stopPropagation(),className:"bg-white dark:bg-gray-900 rounded-2xl p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center",children:e.jsx(T,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Completar con IA"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Información automática"})]})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:"¿Quieres que la IA complete la información faltante de esta planta?"}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-2xl",children:"🌱"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:s.name})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-2xl",children:"🔬"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:s.species})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("p",{className:"font-medium mb-1",children:"La IA agregará:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• Ambiente recomendado (interior/exterior)"}),e.jsx("li",{children:"• Necesidades de luz específicas"})]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(C,{variant:"outline",onClick:A,className:"flex-1",disabled:d,children:"Cancelar"}),e.jsx(C,{onClick:I,className:"flex-1 bg-green-600 hover:bg-green-700 text-white",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-4 h-4 mr-2 animate-spin"}),"Completando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Completar"]})})]})]})})})]})},D=({icon:s,label:t,value:r})=>e.jsxs("div",{className:"flex items-start space-x-4 p-4 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 flex items-center justify-center text-primary",children:s}),e.jsxs("div",{children:[e.jsx("p",{className:"text-ui text-muted-foreground",children:t}),e.jsx("p",{className:"text-heading-4 font-semibold text-foreground capitalize",children:r})]})]}),yt=({plant:s})=>{const{careProfile:t,personality:r}=s;return t?e.jsxs("div",{className:"bg-background p-6 rounded-lg shadow-lg w-full space-y-8",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold text-foreground mb-4 flex items-center",children:[e.jsx(_e,{className:"mr-3 text-primary"})," Perfil de Cuidados"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(D,{icon:e.jsx(V,{size:24}),label:"Luz Solar",value:t.sunlightRequirement}),e.jsx(D,{icon:e.jsx(ys,{size:24}),label:"Humedad",value:t.humidityPreference}),e.jsx(D,{icon:e.jsx(Qe,{size:24}),label:"Temperatura Ideal",value:`${t.temperatureRange.min}°C - ${t.temperatureRange.max}°C`}),e.jsx(D,{icon:e.jsx(T,{size:24}),label:"Fertilización",value:`Cada ${t.fertilizingFrequency} días`}),e.jsx(D,{icon:e.jsx(Cs,{size:24}),label:"Tipo de Suelo",value:t.soilType})]}),t.specialCare&&t.specialCare.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-semibold text-lg mb-2",children:"Cuidados Especiales:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-muted-foreground",children:t.specialCare.map((a,n)=>e.jsx("li",{children:a},n))})]})]}),r&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold text-foreground mb-4 flex items-center",children:[e.jsx(us,{className:"mr-3 text-primary"})," Personalidad de la Planta"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(D,{icon:e.jsx(ct,{size:24}),label:"Estilo de Comunicación",value:r.communicationStyle}),e.jsxs("div",{className:"md:col-span-2 lg:col-span-3 bg-muted/50 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-semibold text-lg mb-2 flex items-center",children:[e.jsx(dt,{className:"mr-2"})," Frases Típicas"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.catchphrases.map((a,n)=>e.jsxs("span",{className:"bg-primary/10 text-primary px-3 py-1 rounded-full text-sm",children:['"',a,'"']},n))})]})]})]})]}):e.jsx("div",{className:"bg-background p-6 rounded-lg shadow-lg w-full text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No hay perfil de cuidados disponible para esta planta."})})},vt=({description:s,funFacts:t})=>{const r={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{staggerChildren:.1}}},a={hidden:{opacity:0,y:10},visible:{opacity:1,y:0}};return e.jsxs(x.div,{className:"bg-white/0 dark:bg-transparent p-3 sm:p-4 w-full",variants:r,initial:"hidden",animate:"visible",children:[e.jsxs(x.div,{className:"mb-4",variants:a,children:[e.jsx("p",{className:"text-base text-foreground mb-2",children:s}),t&&t.length>0&&e.jsx("ul",{className:"list-disc pl-5 text-sm text-muted-foreground",children:t.map((n,o)=>e.jsx("li",{children:n},o))})]}),t&&t.length>0&&e.jsxs(x.div,{variants:a,children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"p-3 bg-yellow-500/10 rounded-full mr-4",children:e.jsx(T,{className:"w-6 h-6 text-yellow-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-foreground",children:"Datos Curiosos"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Descubre cosas increíbles sobre esta planta"})]})]}),e.jsx("div",{className:"grid gap-4",children:t.map((n,o)=>e.jsxs(x.div,{className:"group flex items-start bg-yellow-500/5 hover:bg-yellow-500/10 border border-yellow-500/20 rounded-xl p-4 transition-all duration-300 hover:shadow-md",variants:a,whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx("div",{className:"flex-shrink-0 mr-4 mt-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Be,{className:"w-5 h-5 text-yellow-500 group-hover:text-yellow-600 transition-colors"}),e.jsx("div",{className:"absolute -inset-2 bg-yellow-500/20 rounded-full opacity-0 group-hover:opacity-100 transition-opacity pulse"})]})}),e.jsx("p",{className:"text-foreground/90 leading-relaxed font-medium group-hover:text-foreground transition-colors",children:n})]},o))})]}),(!t||t.length===0)&&s&&e.jsx(x.div,{className:"mt-8 flex items-center justify-center p-6 bg-muted/30 rounded-xl border border-dashed border-muted-foreground/20",variants:a,children:e.jsxs("div",{className:"text-center",children:[e.jsx(T,{className:"w-6 h-6 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground font-medium",children:"No hay datos curiosos disponibles"}),e.jsx("p",{className:"text-xs text-muted-foreground/70 mt-1",children:"¡Pronto agregaremos información interesante!"})]})})]})},bt=s=>{switch(s){case"pest":return e.jsx(ie,{className:"text-red-500","aria-label":"Plaga"});case"disease":return e.jsx(ut,{className:"text-orange-500","aria-label":"Enfermedad"});case"overwatering":case"underwatering":case"light":case"nutrient":return e.jsx(ie,{className:"text-yellow-500","aria-label":"Problema de riego/luz/nutrientes"});default:return e.jsx(T,{className:"text-blue-500","aria-label":"Otro"})}},Nt=({analysis:s})=>{if(!s)return null;const t=s.issues&&s.issues.length>0;return e.jsxs("div",{className:"p-3 sm:p-4 w-full",role:"region","aria-label":"Análisis de salud de la planta",children:[t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg mb-3",children:"Problemas Detectados"}),e.jsxs("p",{className:"mb-2 text-sm text-red-700 dark:text-red-300 font-medium",children:[s.issues.length," problema",s.issues.length!==1?"s":""," detectado",s.issues.length!==1?"s":""]}),e.jsx("ul",{className:"space-y-4",children:s.issues.map((r,a)=>e.jsxs("li",{className:"flex items-start p-4 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 flex items-center justify-center",children:bt(r.type)}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"font-semibold capitalize",children:r.type}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.description})]})]},a))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg mb-3",children:"Tratamientos Sugeridos"}),e.jsx("ul",{className:"space-y-3 list-disc list-inside text-muted-foreground",children:s.issues.map((r,a)=>e.jsx("li",{children:r.treatment},a))})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-center p-6 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("span",{className:"text-4xl mb-2",role:"img","aria-label":"Planta saludable",children:"🌱"}),e.jsx(mt,{className:"w-12 h-12 text-green-500 mb-3","aria-label":"Todo en orden"}),e.jsxs("h4",{className:"font-semibold text-lg text-green-700 dark:text-green-300 flex items-center gap-2",children:["¡Todo en orden!",e.jsx("span",{className:"text-base","aria-hidden":"true",children:"🌱"})]}),e.jsx("p",{className:"text-muted-foreground",children:"El análisis inicial no detectó problemas de salud significativos."})]}),s.recommendations&&s.recommendations.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-semibold text-lg mb-3",children:"Recomendaciones Adicionales"}),e.jsx("ul",{className:"space-y-3 list-disc list-inside text-muted-foreground",children:s.recommendations.map((r,a)=>e.jsx("li",{children:r},a))})]})]})},wt=({plant:s,onAddPhoto:t})=>{const[r,a]=j.useState(null),n=j.useMemo(()=>{if(!s.images||s.images.length===0)return[];const i=[...s.images].sort((P,I)=>new Date(P.timestamp).getTime()-new Date(I.timestamp).getTime()),h=[],g=30*24*60*60*1e3;let b=new Date(i[0].timestamp),v=[];return i.forEach((P,I)=>{const A=new Date(P.timestamp);if(A.getTime()-b.getTime()<=g)v.push(P);else{if(v.length>0){const E=v.map(w=>{const y=w.healthAnalysis;if(!y)return;const S={excellent:95,good:80,fair:60,poor:30};if(y.overallHealth&&S[y.overallHealth])return S[y.overallHealth];if(typeof y.confidence=="number")return y.confidence<=1?y.confidence*100:y.confidence}).filter(w=>w!==void 0),z=E.length>0?E.reduce((w,y)=>w+y,0)/E.length:0;h.push({id:`period-${h.length}`,images:[...v],startDate:new Date(v[0].timestamp),endDate:new Date(v[v.length-1].timestamp),avgHealthScore:z,trend:h.length>0?z>h[h.length-1].avgHealthScore?"improving":"declining":"stable",photoCount:v.length})}b=A,v=[P]}if(I===i.length-1&&v.length>0){const E=v.map(w=>{const y=w.healthAnalysis;if(!y)return;const S={excellent:95,good:80,fair:60,poor:30};if(y.overallHealth&&S[y.overallHealth])return S[y.overallHealth];if(typeof y.confidence=="number")return y.confidence<=1?y.confidence*100:y.confidence}).filter(w=>w!==void 0),z=E.length>0?E.reduce((w,y)=>w+y,0)/E.length:0;h.push({id:`period-${h.length}`,images:[...v],startDate:new Date(v[0].timestamp),endDate:new Date(v[v.length-1].timestamp),avgHealthScore:z,trend:h.length>0?z>h[h.length-1].avgHealthScore?"improving":"declining":"stable",photoCount:v.length})}}),h},[s.images]),o=i=>i.toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"}),u=i=>{switch(i){case"improving":return e.jsx(Xe,{className:"w-4 h-4 text-success-500"});case"declining":return e.jsx(ht,{className:"w-4 h-4 text-error-500"});default:return e.jsx(le,{className:"w-4 h-4 text-warning-500"})}},l=i=>{switch(i){case"improving":return"text-success-500 bg-success-50 border-success-200";case"declining":return"text-error-500 bg-error-50 border-error-200";default:return"text-warning-500 bg-warning-50 border-warning-200"}};function c(i){if(i.length<2)return null;const h=i[i.length-1]-i[0];return h>5?{icon:"⬆️",label:"Mejorando",color:"text-green-600 bg-green-50"}:h<-5?{icon:"⬇️",label:"Declive",color:"text-red-600 bg-red-50"}:{icon:"➡️",label:"Estable",color:"text-gray-600 bg-gray-50"}}if(n.length===0)return e.jsxs(U,{className:"mt-6",children:[e.jsx(ve,{children:e.jsxs(be,{className:"flex items-center",children:[e.jsx(le,{className:"w-5 h-5 mr-2 text-primary"}),"Evolución de tu Planta"]})}),e.jsx(J,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(H,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"¡Comienza a documentar la evolución!"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Agrega más fotos a lo largo del tiempo para ver cómo progresa tu planta."}),e.jsxs(C,{onClick:t,className:"gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),"Agregar Primera Foto"]})]})})]});const d=n.map(i=>i.avgHealthScore??0),m=c(d);return e.jsxs(U,{className:"mt-6",children:[e.jsx(ve,{children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsxs(be,{className:"flex items-center min-w-0",children:[e.jsx(le,{className:"w-5 h-5 mr-2 text-primary shrink-0"}),e.jsx("span",{className:"truncate",children:"Evolución de tu Planta"})]}),n.length>1&&m&&m.icon&&m.label&&e.jsxs("span",{className:`inline-flex items-center min-w-[90px] justify-center px-2 py-1 rounded-full text-xs font-medium border border-neutral-200 ${m.color}`,"aria-label":`Tendencia: ${m.label}`,children:[e.jsx("span",{className:"mr-1",role:"img","aria-label":m.label,children:m.icon}),m.label]})]}),e.jsxs(C,{variant:"primary",size:"default",onClick:t,"aria-label":"Agregar nueva foto de evolución",className:"gap-1 rounded-full px-5 shadow-lg hover:shadow-xl transition-all duration-300 active:scale-95 w-full sm:w-auto",children:[e.jsx(je,{className:"w-5 h-5"}),"Agregar Foto"]})]})}),e.jsxs(J,{className:"mt-4 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground uppercase tracking-wide",children:"Períodos de Evolución"}),e.jsx("div",{className:"space-y-3",children:n.map((i,h)=>e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:h*.1},className:`p-4 rounded-xl border cursor-pointer transition-all duration-200 ${r===i.id?"border-primary-300 bg-primary-50 shadow-sm":"border-neutral-200 hover:border-neutral-300 hover:shadow-sm"}`,onClick:()=>a(r===i.id?null:i.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg border ${l(i.trend)}`,children:u(i.trend)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:o(i.startDate)}),e.jsx(rt,{className:"w-3 h-3 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:o(i.endDate)})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Oe,{className:"w-3 h-3"}),i.photoCount," fotos"]}),e.jsxs("span",{children:["Salud promedio: ",Math.max(0,Math.min(100,i.avgHealthScore)).toFixed(0),"%"]})]})]})]}),i.images.length>0&&e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden border border-neutral-200",children:e.jsx(ee,{src:i.images[i.images.length-1].url,alt:`Evolución ${o(i.endDate)}`,className:"w-full h-full object-cover"})})]})},i.id))})]}),e.jsx(q,{children:r&&e.jsx(x.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"border-t pt-6",children:(()=>{const i=n.find(h=>h.id===r);return i?e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3",children:i.images.map((h,g)=>e.jsx(x.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:g*.05},className:"aspect-square rounded-lg overflow-hidden border border-neutral-200 hover:border-primary-300 transition-colors cursor-pointer group",children:e.jsx(ee,{src:h.url,alt:`Evolución ${o(new Date(h.timestamp))}`,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"})},h.id))})}):null})()})})]})]})},kt=({isOpen:s,onClose:t,onPhotoAdded:r,plantName:a})=>{const[n,o]=j.useState("choose"),[u,l]=j.useState(null),[c,d]=j.useState(""),[m,i]=j.useState(null),[h,g]=j.useState(!1),b=j.useRef(null),{addToast:v}=he(),P=j.useCallback(()=>{o("choose"),l(null),d(""),i(null),g(!1)},[]),I=j.useCallback(()=>{P(),t()},[P,t]),A=j.useCallback(p=>{const k=new FileReader;k.onload=G=>{var xe;const Ye=(xe=G.target)==null?void 0:xe.result;l(Ye),o("preview")},k.readAsDataURL(p)},[]),E=j.useCallback(()=>{b.current&&b.current.click()},[]),z=j.useCallback(()=>{E()},[E]),w=j.useCallback(p=>{var G;const k=(G=p.target.files)==null?void 0:G[0];if(k){if(!k.type.startsWith("image/")){i("Por favor selecciona un archivo de imagen válido (JPG, PNG, etc.).");return}if(k.size>5*1024*1024){i("La imagen es demasiado grande. Máximo 5MB. Intenta con una imagen más pequeña.");return}if(k.size===0){i("El archivo está vacío. Selecciona una imagen válida.");return}i(null),A(k)}},[A]),y=j.useCallback(async()=>{if(u)try{o("uploading"),g(!0),await r(u,c.trim()||void 0),o("success"),g(!1),v({type:"success",title:"Foto agregada exitosamente",message:`Nueva imagen añadida a ${a}`}),setTimeout(()=>{I()},1500)}catch(p){console.error("Error en handleUpload:",p);let k="Error al subir la imagen";p instanceof Error?k=p.message:typeof p=="string"&&(k=p),i(k),o("error"),g(!1),v({type:"error",title:"Error al agregar foto",message:k})}},[u,c,r,a,v,I]),S=()=>(console.log("[AddPhotoModal] Renderizando botón Tomar Foto:",e.jsx(H,{className:"w-6 h-6"}),"Tomar Foto"),console.log("[AddPhotoModal] Renderizando botón Elegir de Galería:",e.jsx(Ae,{className:"w-6 h-6"}),"Elegir de Galería"),e.jsxs(x.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"text-center space-y-6",children:[e.jsxs("div",{children:[e.jsx(H,{className:"w-16 h-16 text-primary mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Agregar Nueva Foto"}),e.jsxs("p",{className:"text-muted-foreground",children:["Documenta el progreso de ",e.jsx("span",{className:"font-medium",children:a})]})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs(C,{variant:"primary",size:"lg",onClick:z,className:"h-16 gap-3 text-primary-foreground",children:[e.jsx(H,{className:"w-6 h-6"}),"Tomar Foto"]}),e.jsxs(C,{variant:"secondary",size:"lg",onClick:E,className:"h-16 gap-3 text-primary-foreground",children:[e.jsx(Ae,{className:"w-6 h-6"}),"Elegir de Galería"]})]}),e.jsx("input",{ref:b,type:"file",accept:"image/*",onChange:w,className:"hidden","data-testid":"file-input"})]})),te=()=>e.jsxs(x.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Vista Previa"}),e.jsxs("p",{className:"text-muted-foreground",children:["Revisa la imagen antes de agregar a ",a]})]}),u&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"aspect-video max-h-80 mx-auto rounded-lg overflow-hidden border",children:e.jsx("img",{src:u,alt:"Vista previa",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Nota (opcional)"}),e.jsx("textarea",{value:c,onChange:p=>d(p.target.value),placeholder:"Agrega una nota sobre esta foto...",className:"w-full p-3 border border-neutral-200 rounded-lg resize-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",rows:3,maxLength:200}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[c.length,"/200"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(C,{variant:"secondary",onClick:()=>o("choose"),className:"flex-1",children:"Cambiar Imagen"}),e.jsxs(C,{variant:"primary",onClick:y,className:"flex-1 gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),"Analizar y Guardar"]})]})]})]}),L=()=>e.jsxs(x.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center space-y-6 py-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(Q,{className:"w-16 h-16 text-primary mx-auto animate-spin"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:h?"Analizando imagen...":"Subiendo foto..."}),e.jsx("p",{className:"text-muted-foreground",children:h?"La IA está evaluando la salud de tu planta. Esto puede tomar unos segundos.":"Guardando la nueva imagen en tu jardín"})]})]}),e.jsx("div",{className:"w-full bg-neutral-200 rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full animate-pulse",style:{width:"70%"}})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:h?"Analizando con IA...":"Procesando imagen..."})]}),ae=()=>e.jsxs(x.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"text-center space-y-6 py-8",children:[e.jsx(hs,{className:"w-16 h-16 text-success-500 mx-auto"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"¡Foto agregada exitosamente!"}),e.jsxs("p",{className:"text-muted-foreground",children:["La nueva imagen ha sido añadida al progreso de ",a]}),e.jsx("p",{className:"text-sm text-success-600 mt-2",children:"El análisis de salud se ha completado y actualizado"})]})]}),$=()=>e.jsxs(x.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"text-center space-y-6 py-8",children:[e.jsx(oe,{className:"w-16 h-16 text-error-500 mx-auto"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Error al subir"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:m||"Hubo un problema al procesar la imagen"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(C,{variant:"secondary",onClick:()=>o("choose"),children:"Intentar de Nuevo"}),e.jsx(C,{variant:"primary",onClick:I,children:"Cerrar"})]})]})]}),W=()=>{switch(n){case"choose":return S();case"preview":return te();case"uploading":return L();case"success":return ae();case"error":return $();default:return S()}};return e.jsx(q,{children:s&&e.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",onClick:p=>{p.target===p.currentTarget&&n!=="uploading"&&I()},children:e.jsx(x.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"w-full max-w-md",children:e.jsx(U,{children:e.jsxs(J,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"font-medium text-sm text-muted-foreground",children:"NUEVA FOTO"})]}),n!=="uploading"&&e.jsx(C,{variant:"ghost",size:"icon-sm",onClick:I,children:e.jsx(qe,{className:"w-4 h-4"})})]}),W()]})})})})})},Ct=({plant:s})=>{var d,m,i;const{healthScore:t,careProfile:r}=s,a=(m=(d=s.images)==null?void 0:d[0])==null?void 0:m.healthAnalysis,n=s.dateAdded?Math.ceil((Date.now()-s.dateAdded.getTime())/(1e3*60*60*24)):0,o=()=>t>=80?{text:"Excelente",emoji:"🌱",color:"text-green-600"}:t>=60?{text:"Buena",emoji:"🌿",color:"text-green-500"}:t>=40?{text:"Regular",emoji:"🍃",color:"text-yellow-600"}:{text:"Necesita atención",emoji:"🥀",color:"text-red-600"},u=h=>{switch(h){case"poca_luz":return"Poca luz";case"luz_indirecta":return"Luz indirecta";case"luz_directa_parcial":return"Luz directa parcial";case"pleno_sol":return"Pleno sol";default:return h}},l=o(),c={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};return e.jsx(x.div,{initial:"hidden",animate:"visible",variants:{visible:{transition:{staggerChildren:.1}}},children:e.jsxs(U,{variant:"glass",className:"content-spacing-sm element-spacing",children:[e.jsxs(x.div,{variants:c,className:"flex items-center justify-between",children:[e.jsxs("div",{className:ce("flex items-center space-x-1.5 px-2 py-1 radius-full",t>=70?"bg-green-100 dark:bg-green-900/30":t>=50?"bg-yellow-100 dark:bg-yellow-900/30":"bg-red-100 dark:bg-red-900/30"),children:[e.jsx("span",{className:"text-body",children:l.emoji}),e.jsxs("span",{className:ce("font-semibold text-caption",l.color),children:[t,"% ",l.text]})]}),e.jsxs("div",{className:"flex items-center space-x-1 text-contrast-soft",children:[e.jsx(se,{className:"w-3 h-3"}),e.jsxs("span",{className:"text-caption",children:["Día ",n]})]})]}),e.jsx(x.div,{variants:c,className:"element-spacing-sm",children:e.jsxs("div",{className:"flex items-center space-x-2 content-spacing-sm radius-sm bg-blue-50 dark:bg-blue-900/20",children:[e.jsx(V,{className:"w-4 h-4 text-blue-500 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-caption text-contrast-soft",children:"Luz"}),e.jsx("p",{className:"font-semibold text-caption text-blue-600 dark:text-blue-400 truncate",children:s.lightRequirements?u(s.lightRequirements):"No especificada"})]})]})}),(s.plantEnvironment||(r==null?void 0:r.temperatureRange))&&e.jsxs(x.div,{variants:c,className:"element-spacing-sm",children:[s.plantEnvironment&&e.jsxs("div",{className:"flex items-center space-x-2 content-spacing-sm radius-sm bg-purple-50 dark:bg-purple-900/20",children:[e.jsx(Ke,{className:"w-4 h-4 text-purple-500 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-caption text-contrast-soft",children:"Ambiente"}),e.jsx("p",{className:"font-semibold text-caption text-purple-600 dark:text-purple-400 capitalize truncate",children:s.plantEnvironment==="ambos"?"Interior/Exterior":s.plantEnvironment})]})]}),(r==null?void 0:r.temperatureRange)&&e.jsxs("div",{className:"flex items-center space-x-2 content-spacing-sm radius-sm bg-orange-50 dark:bg-orange-900/20",children:[e.jsx(Qe,{className:"w-4 h-4 text-orange-500 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-caption text-contrast-soft",children:"Temperatura"}),e.jsxs("p",{className:"font-semibold text-caption text-orange-600 dark:text-orange-400",children:[r.temperatureRange.min,"°-",r.temperatureRange.max,"°C"]})]})]})]}),(a==null?void 0:a.issues)&&a.issues.length>0&&e.jsx(x.div,{variants:c,className:"content-spacing-sm bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 radius-sm",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(ie,{className:"w-4 h-4 text-red-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"font-semibold text-red-700 dark:text-red-300 text-caption mb-1",children:[a.issues.length," problema",a.issues.length!==1?"s":""," detectado",a.issues.length!==1?"s":""]}),e.jsxs("p",{className:"text-caption text-red-600 dark:text-red-400",children:[a.issues[0].description,a.issues.length>1&&` y ${a.issues.length-1} más...`]})]})]})}),s.funFacts&&s.funFacts.length>0&&e.jsx(x.div,{variants:c,className:"content-spacing-sm bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 radius-sm border border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Be,{className:"w-4 h-4 text-yellow-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-semibold text-yellow-700 dark:text-yellow-300 text-caption mb-1",children:"💡 Dato curioso"}),e.jsx("p",{className:"text-caption text-yellow-600 dark:text-yellow-400 leading-relaxed",children:s.funFacts[0]}),s.funFacts.length>1&&e.jsxs("p",{className:"text-caption text-yellow-500 mt-1",children:["+",s.funFacts.length-1," dato",s.funFacts.length>2?"s":""," más"]})]})]})}),((i=s.personality)==null?void 0:i.communicationStyle)&&e.jsx(x.div,{variants:c,className:"content-spacing-sm bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 radius-sm border border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"font-semibold text-green-700 dark:text-green-300 text-caption mb-1",children:["🤖 Personalidad: ",s.personality.communicationStyle]}),s.personality.catchphrases&&s.personality.catchphrases.length>0&&e.jsxs("p",{className:"text-caption text-green-600 dark:text-green-400 italic",children:['"',s.personality.catchphrases[0],'"']})]})})]})})},Et=({plant:s,onAddPhoto:t})=>{var d,m,i,h;const[r,a]=j.useState("evolution"),n=(m=(d=s.images)==null?void 0:d[0])==null?void 0:m.healthAnalysis,o=(n==null?void 0:n.issues)&&n.issues.length>0,u=s.images&&s.images.length>1,l=[{id:"evolution",title:"Evolución y Progreso",icon:e.jsx(Xe,{className:"w-5 h-5"}),badge:u?`${((i=s.images)==null?void 0:i.length)||0} fotos`:"Nueva",component:e.jsx(wt,{plant:s,onAddPhoto:t}),priority:1},{id:"health",title:"Análisis de Salud",icon:e.jsx(ot,{className:"w-5 h-5"}),badge:o?"Atención":"Saludable",component:e.jsx(Nt,{analysis:n}),priority:o?1:3},{id:"care",title:"Perfil de Cuidados",icon:e.jsx(_e,{className:"w-5 h-5"}),badge:s.careProfile?"Completo":"Pendiente",component:e.jsx(yt,{plant:s}),priority:s.careProfile?2:1},{id:"description",title:"Información General",icon:e.jsx(nt,{className:"w-5 h-5"}),badge:(h=s.funFacts)!=null&&h.length?`${s.funFacts.length} datos`:void 0,component:e.jsx(vt,{species:s.species,description:s.description,funFacts:s.funFacts}),priority:4}].filter(g=>g.id==="health"?!!n:!0).sort((g,b)=>g.priority-b.priority),c=(g,b)=>g==="health"&&b==="Atención"?"badge-error":b==="Pendiente"?"badge-warning":b==="Nueva"?"badge-info":"badge-success";return e.jsx("div",{className:"flex flex-col gap-y-1",children:l.map(g=>{const b=r===g.id;return e.jsxs("div",{className:"rounded-xl bg-white/70 dark:bg-neutral-900/70 backdrop-blur-md transition-shadow duration-200",children:[e.jsxs(x.button,{onClick:()=>a(b?"":g.id),className:"w-full flex items-center justify-between px-3 py-2 sm:px-4 sm:py-3 min-h-12 text-left focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 active:bg-primary-50 dark:active:bg-primary-900/20",style:{position:b?"sticky":"static",top:0,zIndex:2,background:"inherit"},whileTap:{scale:.98},children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("span",{className:"p-1.5 rounded-lg bg-primary/10 text-primary flex-shrink-0 flex items-center justify-center",children:g.icon}),e.jsx("span",{className:"font-semibold text-lg truncate text-neutral-900 dark:text-neutral-100",children:g.title}),g.badge&&e.jsx("span",{className:ce("ml-auto px-2 py-0.5 text-xs font-medium rounded-full",c(g.id,g.badge)),children:g.badge})]}),e.jsx(x.div,{animate:{rotate:b?180:0},transition:{duration:.2},className:"flex-shrink-0",children:e.jsx(lt,{className:"w-6 h-6 text-neutral-600 dark:text-neutral-400"})})]}),e.jsx(q,{children:b&&e.jsx(x.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:e.jsx("div",{className:"px-3 pb-3 sm:px-4 sm:pb-4 max-h-[60vh] overflow-y-auto",children:g.component})})})]},g.id)})})},Me=()=>e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"relative h-96 w-full overflow-hidden bg-gradient-to-br from-muted/50 to-muted",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/80 via-background/20 to-transparent"}),e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 pt-safe-top",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(f,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{className:"h-10 w-10 rounded-full"}),e.jsx(f,{className:"h-10 w-10 rounded-full"})]})]})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 pb-safe-bottom",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{className:"h-8 w-64"}),e.jsx(f,{className:"h-6 w-48"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(f,{className:"h-8 w-24 rounded-full"}),e.jsx(f,{className:"h-8 w-32 rounded-full"}),e.jsx(f,{className:"h-8 w-20 rounded-full"})]})]})})]}),e.jsxs("div",{className:"p-4 space-y-6 pb-20",children:[e.jsxs("div",{className:"bg-background p-6 rounded-2xl shadow-lg border border-border/50",children:[e.jsxs("div",{className:"mb-6 flex items-center",children:[e.jsx(f,{className:"h-12 w-12 rounded-full mr-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{className:"h-6 w-48"}),e.jsx(f,{className:"h-4 w-64"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(f,{className:"h-4 w-full"}),e.jsx(f,{className:"h-4 w-5/6"}),e.jsx(f,{className:"h-4 w-4/5"}),e.jsx(f,{className:"h-4 w-3/4"})]}),e.jsxs("div",{className:"mt-8 space-y-4",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(f,{className:"h-12 w-12 rounded-full mr-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{className:"h-6 w-32"}),e.jsx(f,{className:"h-4 w-56"})]})]}),[1,2,3].map(s=>e.jsxs("div",{className:"flex items-start bg-muted/20 rounded-xl p-4",children:[e.jsx(f,{className:"h-5 w-5 rounded-full mr-4 mt-1"}),e.jsx(f,{className:"h-4 w-full"})]},s))]})]}),e.jsxs("div",{className:"bg-background p-6 rounded-2xl shadow-lg border border-border/50",children:[e.jsxs("div",{className:"mb-4 flex items-center",children:[e.jsx(f,{className:"h-6 w-6 mr-3"}),e.jsx(f,{className:"h-6 w-48"})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-6",children:[e.jsx(f,{className:"h-12 w-12 mx-auto mb-3"}),e.jsx(f,{className:"h-6 w-32 mx-auto mb-2"}),e.jsx(f,{className:"h-4 w-48 mx-auto"})]})]}),e.jsxs("div",{className:"bg-background p-6 rounded-2xl shadow-lg border border-border/50",children:[e.jsxs("div",{className:"mb-4 flex items-center",children:[e.jsx(f,{className:"h-6 w-6 mr-3"}),e.jsx(f,{className:"h-6 w-40"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(s=>e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[e.jsx(f,{className:"h-8 w-8 mb-2"}),e.jsx(f,{className:"h-4 w-16 mb-1"}),e.jsx(f,{className:"h-5 w-24"})]},s))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(f,{className:"h-5 w-5 mr-2"}),e.jsx(f,{className:"h-6 w-32"})]}),e.jsx(f,{className:"h-4 w-16"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[1,2,3,4,5,6].map(s=>e.jsx(f,{className:"aspect-square rounded-xl"},s))})]})]}),e.jsxs("div",{className:"fixed bottom-4 right-4 z-40 flex flex-col-reverse gap-3",children:[[1,2,3].map(s=>e.jsx(f,{className:"h-14 w-14 rounded-full"},s)),e.jsx(f,{className:"h-16 w-16 rounded-full"})]})]}),qt=()=>{const{plantId:s}=xs(),t=Fe(),{plant:r,loading:a,error:n}=gs(s),{addPlantImage:o}=xt(),[u,l]=j.useState(!1),c=async(d,m)=>{if(!s)throw new Error("Plant ID is required");return new Promise((i,h)=>{o({plantId:s,imageDataUrl:d,note:m},{onSuccess:()=>i(),onError:g=>h(g)})})};return a?e.jsx(Me,{}):n?e.jsx("main",{className:"flex flex-1 flex-col items-center justify-center p-4 text-center h-screen",children:e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-4",children:[e.jsx(oe,{className:"w-16 h-16 text-destructive mx-auto"}),e.jsx("h1",{className:"text-2xl font-bold text-destructive",children:"Ocurrió un Error"}),e.jsx("p",{className:"text-muted-foreground max-w-md",children:n}),e.jsx(C,{onClick:()=>window.location.reload(),className:"mt-4",children:"Intentar de nuevo"})]})}):r?e.jsx(j.Suspense,{fallback:e.jsx(Me,{}),children:e.jsxs(x.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[e.jsx(jt,{plant:r}),e.jsxs("main",{className:"p-3 sm:p-4 space-y-3 sm:space-y-4 pb-20",children:[e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsx(Ct,{plant:r})}),e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:e.jsx(Et,{plant:r,onAddPhoto:()=>l(!0)})}),e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},children:e.jsx(gt,{images:r.images})})]}),e.jsxs(x.div,{className:"fixed bottom-20 sm:bottom-24 right-3 sm:right-4 z-40 flex flex-col-reverse gap-2 sm:gap-3",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.5},children:[e.jsxs(x.button,{onClick:()=>l(!0),className:"bg-primary hover:bg-primary/90 text-primary-foreground p-2.5 sm:p-3 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 group flex items-center",whileHover:{scale:1.1},whileTap:{scale:.95},title:"Agregar nueva foto",children:[e.jsx(H,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"ml-2 text-xs font-medium block sm:hidden",children:"Agregar foto"}),e.jsx("span",{className:"absolute right-full mr-3 top-1/2 -translate-y-1/2 tooltip-contrast text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap shadow-lg hidden sm:block",children:"Agregar foto"})]}),e.jsxs(x.button,{onClick:()=>t(ye.toPlantChat(r.id)),className:"bg-blue-500 hover:bg-blue-600 text-white p-2.5 sm:p-3 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 group flex items-center",whileHover:{scale:1.1},whileTap:{scale:.95},title:"Chat con la planta",children:[e.jsx(fs,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"ml-2 text-xs font-medium block sm:hidden",children:"Chat"}),e.jsx("span",{className:"absolute right-full mr-3 top-1/2 -translate-y-1/2 tooltip-contrast text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap shadow-lg hidden sm:block",children:"Chat"})]})]}),e.jsx(kt,{isOpen:u,onClose:()=>l(!1),onPhotoAdded:c,plantName:r.nickname||r.name})]})}):e.jsx("main",{className:"flex flex-1 flex-col items-center justify-center p-4 text-center h-screen",children:e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-4",children:[e.jsx(oe,{className:"w-16 h-16 text-muted-foreground mx-auto"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Planta no encontrada"}),e.jsx("p",{className:"text-muted-foreground max-w-md",children:"No se pudo encontrar la información de la planta solicitada."}),e.jsx(C,{onClick:()=>t(ye.toDashboard()),className:"mt-4",children:"Volver al inicio"})]})})};export{qt as default};
