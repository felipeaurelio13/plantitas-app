import{z as j,F as h,a as f,u as b,a0 as m,r as l,j as e,m as g,K as u,A as y}from"./index-Dhf-XWmn.js";import{u as N}from"./usePlantDetail-CezqKeLY.js";import{A as v}from"./arrow-left-DKFp8Bl7.js";import{f as k,l as w,I as C}from"./Input-BpgjMn4Y.js";import{B as x}from"./Button-Bj5BxFWx.js";import{C as S,S as M,T as I}from"./TypingIndicator-ncbZ8Cpg.js";import{S as P}from"./sparkles-HE6tk_tZ.js";import{L as E}from"./loader-circle-ID8N8TGJ.js";import"./index-Bnwr932r.js";/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=j("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),z=()=>{const{plantId:s}=h(),r=f(),{user:n}=b(),t=m(o=>o.getPlantById(s||"")),c=m(o=>o.addChatMessage),i=m(o=>o.isLoading);console.log("--- DEBUG CHAT ---"),console.log("ID de planta desde URL:",s),console.log("Planta encontrada en el store:",t);const a=l.useMemo(()=>{if(!t||!t.chatHistory||t.chatHistory.length===0)return!1;const o=t.chatHistory[t.chatHistory.length-1];return i&&o.sender==="user"},[t,i]);return{plant:t,isTyping:a,handleSendMessage:async o=>{if(!(!s||!n||!o.trim()))try{await c(s,o.trim(),n.id)}catch(p){console.error("Failed to send message:",p)}},handleGoBack:()=>{r(`/plant/${s}`)},currentUser:n}},D=({plant:s})=>{const r=f(),n=()=>{const t=s.healthScore/100,c=s.lastWatered?new Date(s.lastWatered).getTime():0,i=c?Math.max(0,1-(Date.now()-c)/(s.careProfile.wateringFrequency*24*60*60*1e3)):0,a=t*.6+i*.4;return a>.8?"radiante":a>.6?"feliz":a>.4?"estable":"necesitada de atenciÃ³n"};return e.jsx("header",{className:"sticky top-0 z-10 bg-background/80 backdrop-blur-sm border-b border-muted",children:e.jsxs("div",{className:"flex items-center gap-2 p-4 pt-safe-top",children:[e.jsx("button",{onClick:()=>r(`/plant/${s.id}`),className:"btn btn-ghost btn-circle",children:e.jsx(v,{size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"font-bold text-foreground truncate",children:s.nickname||s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground capitalize",children:["Se siente ",n()]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-destructive",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.healthScore,"%"]})]})]})})},L=s=>{switch(s){case"happy":case"excited":return"ðŸ˜Š";case"grateful":return"ðŸ¥°";case"worried":return"ðŸ˜Ÿ";case"sad":return"ðŸ˜¢";default:return"ðŸŒ±"}},A=({message:s})=>{const r=s.sender==="user";return e.jsxs(g.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:u("flex items-end gap-2",r?"justify-end":"justify-start"),children:[!r&&e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-muted text-xl",children:L(s.emotion)}),e.jsxs("div",{className:u("max-w-xs rounded-2xl px-4 py-2 sm:max-w-sm md:max-w-md",r?"rounded-br-lg bg-primary text-primary-foreground":"rounded-bl-lg bg-muted text-muted-foreground"),children:[e.jsx("p",{className:"text-sm",children:s.content}),e.jsx("p",{className:u("mt-1 text-xs",r?"text-primary-foreground/70":"text-muted-foreground/70"),children:k(new Date(s.timestamp),{addSuffix:!0,locale:w})})]})]})},B=({messages:s})=>e.jsx("div",{className:"space-y-4",children:s.map(r=>e.jsx(A,{message:r},r.id))}),T=["Â¿CÃ³mo te sientes hoy?","Â¿Necesitas agua?","CuÃ©ntame un dato curioso sobre ti"],F=({onSendMessage:s,isTyping:r})=>{const[n,t]=l.useState(""),c=()=>{n.trim()&&(s(n.trim()),t(""))},i=a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),c())};return e.jsx("footer",{className:"sticky bottom-0 z-10 bg-background/80 backdrop-blur-sm border-t border-border",children:e.jsxs("div",{className:"p-4 pb-safe-bottom space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(C,{type:"text",value:n,onChange:a=>t(a.target.value),onKeyPress:i,placeholder:"Escribe un mensaje...",className:"pr-12",disabled:r}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-muted-foreground",children:e.jsx(S,{size:16})})]}),e.jsx(x,{"aria-label":"Enviar mensaje",onClick:c,disabled:!n.trim()||r,size:"icon",children:e.jsx(M,{size:20})})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:T.map(a=>e.jsx(x,{onClick:()=>t(a),disabled:r,variant:"secondary",size:"sm",children:a},a))})]})})},K=({plantName:s})=>e.jsxs(g.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5,ease:"easeOut"},className:"flex flex-1 flex-col items-center justify-center text-center p-8",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full bg-primary/10 mb-4",children:e.jsx(P,{className:"h-8 w-8 text-primary"})}),e.jsx("h3",{className:"text-xl font-bold text-foreground",children:"Inicia una conversaciÃ³n"}),e.jsxs("p",{className:"text-muted-foreground max-w-xs",children:[s," estÃ¡ esperando para charlar. Â¡PregÃºntale sobre sus cuidados o simplemente saluda!"]})]}),Q=()=>{const{plantId:s}=h(),{loading:r,error:n}=N(s),{plant:t,isTyping:c,handleSendMessage:i}=z(),a=l.useRef(null);return l.useEffect(()=>{var d;(d=a.current)==null||d.scrollIntoView({behavior:"smooth"})},[t==null?void 0:t.chatHistory,c]),r?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-background text-foreground",children:[e.jsx(E,{className:"w-12 h-12 animate-spin text-green-500"}),e.jsx("p",{className:"mt-4 text-lg",children:"Cargando chat..."})]}):n?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-background text-red-500",children:[e.jsxs("p",{className:"mb-4",children:["Error: ",n]}),e.jsx("button",{onClick:()=>window.history.back(),className:"btn btn-primary",children:"Volver"})]}):t?e.jsxs("div",{className:"flex flex-col h-screen bg-background text-foreground",children:[e.jsx(D,{plant:t}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsx(y,{children:t.chatHistory.length===0?e.jsx(K,{plantName:t.nickname||t.name}):e.jsx(B,{messages:t.chatHistory,plantNickname:t.nickname||t.name})}),c&&e.jsx(I,{}),e.jsx("div",{ref:a})]}),e.jsx(F,{onSendMessage:i,isTyping:c})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-background text-foreground",children:[e.jsx("p",{className:"mb-4",children:"Planta no encontrada."}),e.jsx("button",{onClick:()=>window.history.back(),className:"btn btn-primary",children:"Volver"})]})};export{Q as default};
