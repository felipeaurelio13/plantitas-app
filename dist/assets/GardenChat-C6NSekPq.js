var O=Object.defineProperty;var X=(a,t,s)=>t in a?O(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var F=(a,t,s)=>X(a,typeof t!="symbol"?t+"":t,s);import{z as q,a1 as j,u as Y,r as c,j as e,m,J as A,Q as z,ab as Z,a as ee,S as M,A as H,K as E,T as ae}from"./index-Dhf-XWmn.js";import{r as B,t as G}from"./index-Bnwr932r.js";import{B as N}from"./Button-Bj5BxFWx.js";import{C as te}from"./Card-lYAqW3g2.js";import{A as se}from"./arrow-left-DKFp8Bl7.js";import{E as re,B as $,L as ne}from"./lightbulb-DN3gBAW9.js";import{E as L}from"./eye-BilG-0Oh.js";import{f as ie,l as oe,I as le}from"./Input-BpgjMn4Y.js";import{U as ce}from"./user-IDKhe3Ij.js";import{S as _}from"./sparkles-HE6tk_tZ.js";import{C as de,S as ue,T as me}from"./TypingIndicator-ncbZ8Cpg.js";/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=q("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=q("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=q("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);function ge(a){if(a===null||a===!0||a===!1)return NaN;var t=Number(a);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function fe(a,t){B(2,arguments);var s=G(a),n=ge(t);return isNaN(n)?new Date(NaN):(n&&s.setDate(s.getDate()+n),s)}function pe(a,t){B(2,arguments);var s=G(a),n=G(t);return s.getTime()>n.getTime()}const b=class b{static getInstance(){return b.instance||(b.instance=new b),b.instance}async sendMessage(t,s,n){try{const{data:{session:r},error:l}=await j.auth.getSession();if(l||!(r!=null&&r.access_token))throw console.error("User session not available:",l),new Error("Usuario no autenticado. Por favor inicia sesiÃ³n nuevamente.");const{data:d,error:u}=await j.functions.invoke("garden-ai-chat",{body:{message:t,sessionId:s,userId:n},headers:{Authorization:`Bearer ${r.access_token}`}});if(u)throw new Error(`Garden AI service error: ${u.message}`);if(!d)throw new Error("No data received from garden AI service");return d}catch(r){throw console.error("Error in garden chat service:",r),r}}async sendMessageToGardenAI(t,s,n){try{const r=await this.buildGardenContext(s),l=n.map(f=>({role:f.sender==="user"?"user":"assistant",content:f.content})),{data:{session:d},error:u}=await j.auth.getSession();if(u||!(d!=null&&d.access_token))throw console.error("User session not available:",u),new Error("Usuario no autenticado. Por favor inicia sesiÃ³n nuevamente.");const{data:o,error:h}=await j.functions.invoke("garden-ai-chat",{body:{userMessage:t,gardenContext:r,conversationHistory:l},headers:{Authorization:`Bearer ${d.access_token}`}});if(h)throw new Error(`Garden AI service error: ${h.message}`);if(!o)throw new Error("No data received from garden AI service");const g=typeof o=="string"?JSON.parse(o):o;return{content:g.content||"Lo siento, no pude procesar tu mensaje.",insights:g.insights||[],suggestedActions:g.suggestedActions||[]}}catch(r){throw console.error("Error sending message to garden AI:",r),r}}async verifyFunctionAvailability(){try{const t={userMessage:"ping",gardenContext:{totalPlants:0,plantsData:[],averageHealthScore:0,commonIssues:[],careScheduleSummary:{needsWatering:[],needsFertilizing:[],healthConcerns:[]},environmentalFactors:{locations:["test"]}},conversationHistory:[]},{data:{session:s},error:n}=await j.auth.getSession();if(n||!(s!=null&&s.access_token))throw console.error("User session not available:",n),new Error("Usuario no autenticado. Por favor inicia sesiÃ³n nuevamente.");const{data:r,error:l}=await j.functions.invoke("garden-ai-chat",{body:t,headers:{Authorization:`Bearer ${s.access_token}`}});return l?l.message.includes("404")||l.message.includes("not found")?{available:!1,error:"La funciÃ³n de chat de jardÃ­n no estÃ¡ disponible en este momento"}:{available:!1,error:l.message}:r&&typeof r.content=="string"?{available:!0}:{available:!1,error:"Function returned unexpected response format"}}catch(t){return{available:!1,error:t instanceof Error?t.message:"Error desconocido"}}}async getGardenHealthSummary(t){try{const s=await this.buildGardenContext(t),n=s.plantsData.filter(l=>l.healthScore>=80).length,r=s.careScheduleSummary.needsWatering.length+s.careScheduleSummary.healthConcerns.length;return{totalPlants:s.totalPlants,averageHealth:s.averageHealthScore,urgentActions:r,healthyPlants:n}}catch(s){throw console.error("Error getting garden health summary:",s),s}}async getSuggestedQuestions(t){try{const s=await this.buildGardenContext(t),n=["Â¿CÃ³mo estÃ¡ la salud general de mi jardÃ­n?","Â¿QuÃ© plantas necesitan mÃ¡s atenciÃ³n?","Â¿CuÃ¡les son mis prÃ³ximas tareas de cuidado?"];return s.careScheduleSummary.needsWatering.length>0&&n.push("Â¿QuÃ© plantas necesitan riego?"),s.careScheduleSummary.healthConcerns.length>0&&n.push("Â¿QuÃ© plantas tienen problemas de salud?"),s.totalPlants>5&&n.push("Â¿CÃ³mo organizar mejor mi espacio de plantas?"),n}catch(s){return console.error("Error getting suggested questions:",s),["Â¿CÃ³mo estÃ¡ la salud general de mi jardÃ­n?","Â¿QuÃ© plantas necesitan mÃ¡s atenciÃ³n?","Â¿CuÃ¡les son mis prÃ³ximas tareas de cuidado?"]}}async refreshGardenData(t){try{this.invalidateCache(t),await this.buildGardenContext(t),console.log("[GardenChatService] Garden data refreshed for user:",t)}catch(s){throw console.error("Error refreshing garden data:",s),s}}async buildGardenContext(t){try{const{data:s,error:n}=await j.from("plants").select(`
          id,
          name,
          nickname,
          species,
          location,
          plant_environment,
          light_requirements,
          health_score,
          last_watered,
          last_fertilized,
          care_profile,
          date_added
        `).eq("user_id",t).order("created_at",{ascending:!1});if(n)throw n;const r=s.map(i=>{var y;return{id:i.id,name:i.name,nickname:i.nickname||void 0,species:i.species,location:i.location,plantEnvironment:i.plant_environment,lightRequirements:i.light_requirements,healthScore:i.health_score||85,lastWatered:i.last_watered?new Date(i.last_watered):void 0,wateringFrequency:(y=i.care_profile)==null?void 0:y.wateringFrequency}}),l=r.length,d=l>0?Math.round(r.reduce((i,y)=>i+y.healthScore,0)/l):0,u=new Date,o=[],h=[],g=[];r.forEach(i=>{if(i.lastWatered&&i.wateringFrequency){const y=fe(i.lastWatered,i.wateringFrequency);pe(u,y)&&o.push(i.id)}i.healthScore<70&&g.push(i.id)});const f=[...new Set(r.map(i=>i.location))];return{totalPlants:l,plantsData:r,averageHealthScore:d,commonIssues:[],careScheduleSummary:{needsWatering:o,needsFertilizing:h,healthConcerns:g},environmentalFactors:{locations:f,lightConditions:[],humidityNeeds:[]}}}catch(s){throw console.error("Error building garden context:",s),s}}invalidateCache(t){console.log("Cache invalidated for user:",t)}};F(b,"instance");let T=b;const v=T.getInstance(),ye=()=>{const{user:a}=Y(),[t,s]=c.useState([]),[n,r]=c.useState(!1),[l,d]=c.useState(!1),[u,o]=c.useState(null),[h,g]=c.useState(null),[f,S]=c.useState([]),[i,y]=c.useState("");c.useEffect(()=>{a!=null&&a.id&&I()},[a==null?void 0:a.id]);const I=async()=>{if(a!=null&&a.id){r(!0);try{const[x,C]=await Promise.all([v.getGardenHealthSummary(a.id),v.getSuggestedQuestions(a.id)]);if(g(x),S(C),t.length===0&&x.totalPlants>0){const P={id:`welcome-${Date.now()}`,sender:"ai",content:`Â¡Hola! Soy tu asistente de jardÃ­n ðŸŒ± 

Veo que tienes ${x.totalPlants} plantas en tu jardÃ­n con una salud promedio de ${x.averageHealth}%. ${x.urgentActions>0?`Hay ${x.urgentActions} acciones que podrÃ­an necesitar tu atenciÃ³n.`:"Â¡Todo parece estar en buen estado!"}

Â¿En quÃ© puedo ayudarte hoy con tu jardÃ­n?`,timestamp:new Date,context:{queryType:"general"}};s([P])}}catch(x){console.error("Error loading initial garden data:",x),o("Error al cargar la informaciÃ³n del jardÃ­n")}finally{r(!1)}}},D=c.useCallback(async x=>{if(!(a!=null&&a.id)||!x.trim()||l)return;const C=await v.verifyFunctionAvailability();if(!C.available){o(`ðŸš§ El chat de jardÃ­n no estÃ¡ disponible: ${C.error}`);return}const P={id:`user-${Date.now()}`,sender:"user",content:x.trim(),timestamp:new Date};y(x.trim()),s(p=>[...p,P]),d(!0),o(null);try{const p=await v.sendMessageToGardenAI(x.trim(),a.id,t),w={id:`ai-${Date.now()}`,sender:"ai",content:p.content,timestamp:new Date,context:{plantsAnalyzed:je(p),queryType:ve(x)}};if(s(k=>[...k,w]),p.suggestedActions&&p.suggestedActions.length>0){const k=await v.getGardenHealthSummary(a.id);g(k)}}catch(p){console.error("Error sending message to garden AI:",p);let w="Error al enviar el mensaje. Por favor intenta de nuevo.";p instanceof Error&&(p.message.includes("funciÃ³n de chat de jardÃ­n no estÃ¡ disponible")?w="ðŸš§ El chat de jardÃ­n estÃ¡ temporalmente no disponible. Estamos trabajando para solucionarlo.":p.message.includes("CORS")?w="ðŸ”§ Error de configuraciÃ³n. Por favor contacta al administrador.":p.message.includes("garden-ai-chat no existe")&&(w="âš ï¸ Servicio no configurado. El chat de jardÃ­n necesita configuraciÃ³n adicional.")),o(w),s(k=>k.slice(0,-1))}finally{d(!1)}},[a==null?void 0:a.id,t,l]),Q=c.useCallback(async()=>{i&&await D(i)},[i,D]),R=c.useCallback(()=>{s([]),o(null),a!=null&&a.id&&I()},[a==null?void 0:a.id]),V=c.useCallback(async()=>{if(a!=null&&a.id){r(!0);try{await v.refreshGardenData(a.id),await I(),console.log("[useGardenChat] Garden data refreshed successfully")}catch(x){console.error("Error refreshing garden data:",x),o("Error al actualizar los datos del jardÃ­n")}finally{r(!1)}}},[a==null?void 0:a.id]),K=c.useMemo(()=>n,[n]),J=c.useMemo(()=>{},[a==null?void 0:a.id,h]);return{messages:t,isLoading:K,isTyping:l,error:u,gardenSummary:h,suggestedQuestions:f,sendMessage:D,clearMessages:R,retryLastMessage:Q,refreshGardenData:V,cacheStats:J}};function je(a){const t=[];return a.insights&&a.insights.forEach(s=>{s.affectedPlants&&t.push(...s.affectedPlants)}),a.suggestedActions&&a.suggestedActions.forEach(s=>{s.plantIds&&t.push(...s.plantIds)}),[...new Set(t)]}function ve(a){const t=a.toLowerCase();return t.includes("salud")||t.includes("problema")||t.includes("enferm")?"health_analysis":t.includes("comparar")||t.includes("diferencia")||t.includes("mejor")?"care_comparison":t.includes("hongo")||t.includes("plaga")||t.includes("prevenir")?"disease_prevention":t.includes("crecimiento")||t.includes("progreso")||t.includes("tiempo")?"growth_tracking":"general"}const be=({onClose:a})=>{const[t,s]=c.useState([{name:"garden-ai-chat",available:!1}]),[n,r]=c.useState(!1),l=async()=>{r(!0);const o=[],h=await v.verifyFunctionAvailability();o.push({name:"garden-ai-chat",available:h.available,error:h.error,lastChecked:new Date}),s(o),r(!1)};c.useEffect(()=>{l()},[]);const d=o=>o.available?e.jsx(Z,{className:"w-5 h-5 text-green-500"}):e.jsx(A,{className:"w-5 h-5 text-red-500"}),u=o=>o.available?"Disponible":"No disponible";return e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:a,children:e.jsx(m.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:o=>o.stopPropagation(),className:"w-full max-w-md",children:e.jsxs(te,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(W,{className:"w-6 h-6 text-blue-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"DiagnÃ³stico del Sistema"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Estado de Funciones Edge"}),e.jsx("div",{className:"space-y-3",children:t.map(o=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[d(o),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:o.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:u(o)})]})]}),o.error&&e.jsxs("div",{className:"text-xs text-red-500 max-w-32 text-right",children:[o.error.substring(0,50),"..."]})]},o.name))})]}),t.some(o=>!o.available)&&e.jsx(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-yellow-800 dark:text-yellow-200",children:"Servicios no disponibles"}),e.jsx("p",{className:"text-yellow-700 dark:text-yellow-300 mt-1",children:"Algunos servicios del chat de jardÃ­n no estÃ¡n funcionando. Verifica que las funciones Edge estÃ©n desplegadas en Supabase."})]})]})}),e.jsxs("div",{className:"flex gap-3 pt-3",children:[e.jsxs(N,{onClick:l,disabled:n,variant:"outline",size:"sm",className:"flex-1 gap-2",children:[e.jsx(z,{className:`w-4 h-4 ${n?"animate-spin":""}`}),"Verificar Nuevamente"]}),e.jsx(N,{onClick:a,variant:"default",size:"sm",className:"flex-1",children:"Cerrar"})]})]})]})})})},U=({gardenSummary:a,onClearChat:t,onRefresh:s,isRefreshing:n=!1})=>{const r=ee(),[l,d]=c.useState(!1),u=h=>h>=80?"text-green-500":h>=60?"text-yellow-500":"text-red-500",o=h=>h>=80?"Excelente":h>=60?"Buena":"Necesita atenciÃ³n";return e.jsxs("header",{className:"sticky top-0 z-10 bg-background/80 backdrop-blur-sm border-b border-muted",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 pt-safe-top",children:[e.jsx("button",{onClick:()=>r("/"),className:"p-2 -ml-2 rounded-full hover:bg-muted transition-colors","aria-label":"Volver al dashboard",children:e.jsx(se,{size:20})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-full",children:e.jsx(M,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-foreground",children:"Asistente de JardÃ­n"}),a&&e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(he,{size:12}),a.totalPlants," plantas"]}),e.jsx("span",{className:`font-medium ${u(a.averageHealth)}`,children:o(a.averageHealth)}),a.urgentActions>0&&e.jsxs(m.span,{className:"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 px-2 py-0.5 rounded-full",initial:{scale:0},animate:{scale:1},transition:{delay:.2},children:[a.urgentActions," acciones"]})]})]})]})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>d(!0),className:"p-2 rounded-full hover:bg-muted transition-colors","aria-label":"DiagnÃ³stico del sistema",children:e.jsx(W,{size:18})}),s&&e.jsx("button",{onClick:s,disabled:n,className:"p-2 rounded-full hover:bg-muted transition-colors disabled:opacity-50","aria-label":"Actualizar datos del jardÃ­n",children:e.jsx(m.div,{animate:n?{rotate:360}:{},transition:n?{duration:1,repeat:1/0,ease:"linear"}:{},children:e.jsx(z,{size:18})})}),e.jsx("button",{onClick:t,className:"p-2 rounded-full hover:bg-muted transition-colors","aria-label":"Opciones del chat",children:e.jsx(re,{size:20})})]})]}),e.jsx(H,{children:l&&e.jsx(be,{onClose:()=>d(!1)})})]})},we=({message:a})=>{var r;const t=a.sender==="user",s=()=>{var l;if(!((l=a.context)!=null&&l.queryType))return e.jsx($,{size:16});switch(a.context.queryType){case"health_analysis":return e.jsx(ae,{size:16});case"care_comparison":return e.jsx(L,{size:16});case"disease_prevention":return e.jsx(xe,{size:16});case"growth_tracking":return e.jsx(ne,{size:16});default:return e.jsx($,{size:16})}},n=()=>{var l;if(t)return"text-primary-foreground/70";if(!((l=a.context)!=null&&l.queryType))return"text-green-500";switch(a.context.queryType){case"health_analysis":return"text-red-500";case"care_comparison":return"text-blue-500";case"disease_prevention":return"text-orange-500";case"growth_tracking":return"text-purple-500";default:return"text-green-500"}};return e.jsxs(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:E("flex items-end gap-2 max-w-[85%]",t?"justify-end ml-auto":"justify-start"),children:[!t&&e.jsx(m.div,{className:E("flex h-8 w-8 items-center justify-center rounded-full","bg-gradient-to-br from-green-100 to-green-200 dark:from-green-900/30 dark:to-green-800/30"),initial:{scale:0},animate:{scale:1},transition:{delay:.1},children:e.jsx("div",{className:n(),children:s()})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:E("rounded-2xl px-4 py-3 break-words",t?"rounded-br-lg bg-primary text-primary-foreground ml-8":"rounded-bl-lg bg-muted text-muted-foreground mr-8"),children:[e.jsx("div",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:a.content}),!t&&((r=a.context)==null?void 0:r.plantsAnalyzed)&&a.context.plantsAnalyzed.length>0&&e.jsxs(m.div,{className:"mt-2 flex items-center gap-1 text-xs opacity-70",initial:{opacity:0},animate:{opacity:.7},transition:{delay:.5},children:[e.jsx(L,{size:12}),e.jsxs("span",{children:["AnalizÃ³ ",a.context.plantsAnalyzed.length," planta(s)"]})]}),e.jsx("div",{className:E("mt-2 text-xs",t?"text-primary-foreground/70":"text-muted-foreground/70"),children:ie(new Date(a.timestamp),{addSuffix:!0,locale:oe})})]})}),t&&e.jsx(m.div,{className:"flex h-8 w-8 items-center justify-center rounded-full bg-primary/10",initial:{scale:0},animate:{scale:1},transition:{delay:.1},children:e.jsx(ce,{size:16,className:"text-primary"})})]})},Ne=({onSendMessage:a,isTyping:t,suggestedQuestions:s,isLoading:n=!1})=>{const[r,l]=c.useState(""),[d,u]=c.useState(!0),o=async()=>{if(!r.trim()||t)return;const i=r.trim();l(""),u(!1),await a(i)},h=i=>{i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),o())},g=async i=>{l(""),u(!1),await a(i)},f=()=>{s.length>0&&!r&&u(!0)},S=i=>{l(i.target.value),i.target.value.length>0?u(!1):u(!0)};return e.jsx("footer",{className:"sticky bottom-0 z-10 bg-background/80 backdrop-blur-sm border-t border-border",children:e.jsxs("div",{className:"p-4 pb-safe-bottom space-y-3",children:[e.jsx(H,{children:d&&s.length>0&&!n&&e.jsxs(m.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(_,{size:12}),e.jsx("span",{children:"Preguntas sugeridas"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.slice(0,4).map((i,y)=>e.jsx(m.button,{onClick:()=>g(i),disabled:t,className:"px-3 py-1.5 text-xs bg-muted hover:bg-muted/80 rounded-full border border-border/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-left",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:y*.1},whileHover:{scale:1.02},whileTap:{scale:.98},children:i},i))})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(le,{type:"text",value:r,onChange:S,onKeyPress:h,onFocus:f,placeholder:"PregÃºntame sobre tu jardÃ­n...",className:"pr-12",disabled:t||n}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-muted-foreground",children:e.jsx(de,{size:16})})]}),e.jsx(N,{"aria-label":"Enviar mensaje",onClick:o,disabled:!r.trim()||t||n,size:"icon",className:"shrink-0",children:t?e.jsx(m.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:e.jsx(_,{size:20})}):e.jsx(ue,{size:20})})]}),n&&e.jsxs(m.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center justify-center gap-2 text-xs text-muted-foreground",children:[e.jsx(m.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:e.jsx(_,{size:12})}),e.jsx("span",{children:"Analizando tu jardÃ­n..."})]})]})})},Te=()=>{const{messages:a,isLoading:t,isTyping:s,error:n,gardenSummary:r,suggestedQuestions:l,sendMessage:d,clearMessages:u,retryLastMessage:o,refreshGardenData:h}=ye(),g=c.useRef(null);return c.useEffect(()=>{var f;(f=g.current)==null||f.scrollIntoView({behavior:"smooth"})},[a,s]),t&&a.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-screen bg-background text-foreground",children:e.jsxs(m.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},className:"text-center space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(m.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},children:e.jsx(M,{className:"w-12 h-12 text-green-500 mx-auto"})}),e.jsx(m.div,{animate:{scale:[1,1.2,1]},transition:{duration:1,repeat:1/0},className:"absolute inset-0 w-12 h-12 bg-green-500/20 rounded-full mx-auto"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"Analizando tu jardÃ­n..."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Preparando el contexto de todas tus plantas"})]})]})}):n&&a.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-screen bg-background text-foreground p-4",children:e.jsxs(m.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},className:"text-center space-y-4 max-w-md",children:[e.jsx(A,{className:"w-12 h-12 text-red-500 mx-auto"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"Error al cargar el chat"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:n})]}),e.jsxs(N,{onClick:()=>window.location.reload(),className:"gap-2",variant:"outline",children:[e.jsx(z,{size:16}),"Intentar de nuevo"]})]})}):(r==null?void 0:r.totalPlants)===0?e.jsxs("div",{className:"flex flex-col h-screen bg-background text-foreground",children:[e.jsx(U,{gardenSummary:r}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-center space-y-4",children:[e.jsxs(m.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},children:[e.jsx(M,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Tu jardÃ­n estÃ¡ vacÃ­o"}),e.jsx("p",{className:"text-muted-foreground max-w-sm",children:"Agrega algunas plantas a tu jardÃ­n para poder chatear conmigo sobre su cuidado y salud."})]}),e.jsx(N,{onClick:()=>window.location.href="/camera",className:"mt-6",children:"Agregar mi primera planta"})]})]}):e.jsxs("div",{className:"flex flex-col h-screen bg-background text-foreground",children:[e.jsx(U,{gardenSummary:r,onClearChat:u,onRefresh:h,isRefreshing:t&&a.length>0}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"p-4 space-y-4 max-w-4xl mx-auto",children:[e.jsx(H,{children:a.map(f=>e.jsx(we,{message:f},f.id))}),s&&e.jsx(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:e.jsx(me,{})}),n&&a.length>0&&e.jsx(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center justify-center",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3 max-w-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700 dark:text-red-300 text-sm",children:[e.jsx(A,{size:16}),e.jsx("span",{children:n})]}),e.jsxs(N,{onClick:o,size:"sm",variant:"outline",className:"mt-2 w-full",children:[e.jsx(z,{size:14,className:"mr-1"}),"Reintentar"]})]})}),e.jsx("div",{ref:g})]}),!1]}),e.jsx(Ne,{onSendMessage:d,isTyping:s,suggestedQuestions:l,isLoading:t})]})};export{Te as default};
