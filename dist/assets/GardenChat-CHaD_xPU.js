var O=Object.defineProperty;var J=(a,t,s)=>t in a?O(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var F=(a,t,s)=>J(a,typeof t!="symbol"?t+"":t,s);import{B as U,$ as v,aa as A,u as X,r as u,j as e,m as x,K as G,R as I,ab as Y,a as Z,A as T,c as D,G as H,T as ee}from"./index-DrqidrQV.js";import{B as S,S as _}from"./Button-vPdajJSs.js";import{C as ae,A as te}from"./Card-DtKCPuc5.js";import{A as se}from"./arrow-left-DrGfQsNF.js";import{S as M,E as re,L as ne}from"./sprout-C3ySBAx7.js";import{a as $}from"./eye-DXNsoCuQ.js";import{f as ie,l as oe,I as ce}from"./Input-DA7b4EDv.js";import{U as le}from"./user-Uae1VorR.js";import{C as de,S as ue,T as me}from"./TypingIndicator-DBPqtucm.js";import"./index-Bnwr932r.js";/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=U("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=U("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]),w=class w{static getInstance(){return w.instance||(w.instance=new w),w.instance}async sendMessage(t,s,n){try{const{data:{session:r},error:i}=await v.auth.getSession();if(i||!(r!=null&&r.access_token))throw console.error("User session not available:",i),new Error("Usuario no autenticado. Por favor inicia sesiÃ³n nuevamente.");const{data:l,error:d}=await v.functions.invoke("garden-ai-chat",{body:{message:t,sessionId:s,userId:n},headers:{Authorization:`Bearer ${r.access_token}`}});if(d)throw new Error(`Garden AI service error: ${d.message}`);if(!l)throw new Error("No data received from garden AI service");return l}catch(r){throw console.error("Error in garden chat service:",r),r}}async sendMessageToGardenAI(t,s,n){try{const r=await this.buildGardenContext(s),i=n.map(f=>({role:f.sender==="user"?"user":"assistant",content:f.content})),{data:{session:l},error:d}=await v.auth.getSession();if(d||!(l!=null&&l.access_token))throw console.error("User session not available:",d),new Error("Usuario no autenticado. Por favor inicia sesiÃ³n nuevamente.");const{data:o,error:m}=await v.functions.invoke("garden-ai-chat",{body:{userMessage:t,gardenContext:r,conversationHistory:i},headers:{Authorization:`Bearer ${l.access_token}`}});if(m)throw new Error(`Garden AI service error: ${m.message}`);if(!o)throw new Error("No data received from garden AI service");const p=typeof o=="string"?JSON.parse(o):o;return{content:p.content||"Lo siento, no pude procesar tu mensaje.",insights:p.insights||[],suggestedActions:p.suggestedActions||[]}}catch(r){throw console.error("Error sending message to garden AI:",r),r}}async verifyFunctionAvailability(){try{const t={userMessage:"ping",gardenContext:{totalPlants:0,plantsData:[],averageHealthScore:0,commonIssues:[],careScheduleSummary:{needsWatering:[],needsFertilizing:[],healthConcerns:[]},environmentalFactors:{locations:["test"]}},conversationHistory:[]},{data:{session:s},error:n}=await v.auth.getSession();if(n||!(s!=null&&s.access_token))throw console.error("User session not available:",n),new Error("Usuario no autenticado. Por favor inicia sesiÃ³n nuevamente.");const{data:r,error:i}=await v.functions.invoke("garden-ai-chat",{body:t,headers:{Authorization:`Bearer ${s.access_token}`}});return i?i.message.includes("404")||i.message.includes("not found")?{available:!1,error:"La funciÃ³n de chat de jardÃ­n no estÃ¡ disponible en este momento"}:{available:!1,error:i.message}:r&&typeof r.content=="string"?{available:!0}:{available:!1,error:"Function returned unexpected response format"}}catch(t){return{available:!1,error:t instanceof Error?t.message:"Error desconocido"}}}async getGardenHealthSummary(t){try{const s=A.getGardenSummary(t);if(s)return s;const n=await this.buildGardenContext(t),r=n.plantsData.filter(d=>d.healthScore>=80).length,i=n.careScheduleSummary.needsWatering.length+n.careScheduleSummary.healthConcerns.length,l={totalPlants:n.totalPlants,averageHealth:n.averageHealthScore,urgentActions:i,healthyPlants:r};return A.setGardenSummary(t,l),l}catch(s){throw console.error("Error getting garden health summary:",s),s}}async getSuggestedQuestions(t){try{const s=await this.buildGardenContext(t),n=["Â¿CÃ³mo estÃ¡ la salud general de mi jardÃ­n?","Â¿QuÃ© plantas necesitan mÃ¡s atenciÃ³n?","Â¿CuÃ¡les son mis prÃ³ximas tareas de cuidado?"];return s.careScheduleSummary.needsWatering.length>0&&n.push("Â¿QuÃ© plantas necesitan riego?"),s.careScheduleSummary.healthConcerns.length>0&&n.push("Â¿QuÃ© plantas tienen problemas de salud?"),s.totalPlants>5&&n.push("Â¿CÃ³mo organizar mejor mi espacio de plantas?"),n}catch(s){return console.error("Error getting suggested questions:",s),["Â¿CÃ³mo estÃ¡ la salud general de mi jardÃ­n?","Â¿QuÃ© plantas necesitan mÃ¡s atenciÃ³n?","Â¿CuÃ¡les son mis prÃ³ximas tareas de cuidado?"]}}async refreshGardenData(t){try{this.invalidateCache(t),await this.buildGardenContext(t),console.log("[GardenChatService] Garden data refreshed for user:",t)}catch(s){throw console.error("Error refreshing garden data:",s),s}}async buildGardenContext(t){try{const s=A.getGardenContext(t);if(s)return s;const{data:n,error:r}=await v.from("plants").select(`
          id,
          name,
          nickname,
          species,
          location,
          plant_environment,
          light_requirements,
          health_score,
          last_watered,
          last_fertilized,
          care_profile,
          date_added
        `).eq("user_id",t).order("created_at",{ascending:!1});if(r)throw r;const i=n.map(c=>{var j;return{id:c.id,name:c.name,nickname:c.nickname||void 0,species:c.species,location:c.location,plantEnvironment:c.plant_environment,lightRequirements:c.light_requirements,healthScore:c.health_score||85,lastWatered:c.last_watered?new Date(c.last_watered):void 0,wateringFrequency:(j=c.care_profile)==null?void 0:j.wateringFrequency}}),l=i.length,d=l>0?Math.round(i.reduce((c,j)=>c+j.healthScore,0)/l):0,o=new Date,m=[],p=[],f=[];i.forEach(c=>{if(c.lastWatered&&c.wateringFrequency){const j=new Date(c.lastWatered),N=new Date(j);N.setDate(j.getDate()+c.wateringFrequency),o>N&&m.push(c.id)}c.healthScore<70&&f.push(c.id)});const C=[...new Set(i.map(c=>c.location))],h={totalPlants:l,plantsData:i,averageHealthScore:d,commonIssues:[],careScheduleSummary:{needsWatering:m,needsFertilizing:p,healthConcerns:f},environmentalFactors:{locations:C,lightConditions:[],humidityNeeds:[]}};return A.setGardenContext(t,h),h}catch(s){throw console.error("Error building garden context:",s),s}}invalidateCache(t){A.invalidateCache(t),console.log("Cache invalidated for user:",t)}};F(w,"instance");let q=w;const b=q.getInstance(),xe=()=>{const{user:a}=X(),[t,s]=u.useState([]),[n,r]=u.useState(!1),[i,l]=u.useState(!1),[d,o]=u.useState(null),[m,p]=u.useState(null),[f,C]=u.useState([]),[h,c]=u.useState("");u.useEffect(()=>{a!=null&&a.id&&j()},[a==null?void 0:a.id]);const j=async()=>{if(a!=null&&a.id){r(!0);try{const[g,z]=await Promise.all([b.getGardenHealthSummary(a.id),b.getSuggestedQuestions(a.id)]);if(p(g),C(z),t.length===0&&g.totalPlants>0){const P={id:`welcome-${Date.now()}`,sender:"ai",content:`Â¡Hola! Soy tu asistente de jardÃ­n ðŸŒ± 

Veo que tienes ${g.totalPlants} plantas en tu jardÃ­n con una salud promedio de ${g.averageHealth}%. ${g.urgentActions>0?`Hay ${g.urgentActions} acciones que podrÃ­an necesitar tu atenciÃ³n.`:"Â¡Todo parece estar en buen estado!"}

Â¿En quÃ© puedo ayudarte hoy con tu jardÃ­n?`,timestamp:new Date,context:{queryType:"general"}};s([P])}}catch(g){console.error("Error loading initial garden data:",g),o("Error al cargar la informaciÃ³n del jardÃ­n")}finally{r(!1)}}},N=u.useCallback(async g=>{if(!(a!=null&&a.id)||!g.trim()||i)return;const z=await b.verifyFunctionAvailability();if(!z.available){o(`ðŸš§ El chat de jardÃ­n no estÃ¡ disponible: ${z.error}`);return}const P={id:`user-${Date.now()}`,sender:"user",content:g.trim(),timestamp:new Date};c(g.trim()),s(y=>[...y,P]),l(!0),o(null);try{const y=await b.sendMessageToGardenAI(g.trim(),a.id,t),k={id:`ai-${Date.now()}`,sender:"ai",content:y.content,timestamp:new Date,context:{plantsAnalyzed:ge(y),queryType:fe(g)}};if(s(E=>[...E,k]),y.suggestedActions&&y.suggestedActions.length>0){const E=await b.getGardenHealthSummary(a.id);p(E)}}catch(y){console.error("Error sending message to garden AI:",y);let k="Error al enviar el mensaje. Por favor intenta de nuevo.";y instanceof Error&&(y.message.includes("funciÃ³n de chat de jardÃ­n no estÃ¡ disponible")?k="ðŸš§ El chat de jardÃ­n estÃ¡ temporalmente no disponible. Estamos trabajando para solucionarlo.":y.message.includes("CORS")?k="ðŸ”§ Error de configuraciÃ³n. Por favor contacta al administrador.":y.message.includes("garden-ai-chat no existe")&&(k="âš ï¸ Servicio no configurado. El chat de jardÃ­n necesita configuraciÃ³n adicional.")),o(k),s(E=>E.slice(0,-1))}finally{l(!1)}},[a==null?void 0:a.id,t,i]),B=u.useCallback(async()=>{h&&await N(h)},[h,N]),R=u.useCallback(()=>{s([]),o(null),a!=null&&a.id&&j()},[a==null?void 0:a.id]),Q=u.useCallback(async()=>{if(a!=null&&a.id){r(!0);try{await b.refreshGardenData(a.id),await j(),console.log("[useGardenChat] Garden data refreshed successfully")}catch(g){console.error("Error refreshing garden data:",g),o("Error al actualizar los datos del jardÃ­n")}finally{r(!1)}}},[a==null?void 0:a.id]),V=u.useMemo(()=>n,[n]),K=u.useMemo(()=>{},[a==null?void 0:a.id,m]);return{messages:t,isLoading:V,isTyping:i,error:d,gardenSummary:m,suggestedQuestions:f,sendMessage:N,clearMessages:R,retryLastMessage:B,refreshGardenData:Q,cacheStats:K}};function ge(a){const t=[];return a.insights&&a.insights.forEach(s=>{s.affectedPlants&&t.push(...s.affectedPlants)}),a.suggestedActions&&a.suggestedActions.forEach(s=>{s.plantIds&&t.push(...s.plantIds)}),[...new Set(t)]}function fe(a){const t=a.toLowerCase();return t.includes("salud")||t.includes("problema")||t.includes("enferm")?"health_analysis":t.includes("comparar")||t.includes("diferencia")||t.includes("mejor")?"care_comparison":t.includes("hongo")||t.includes("plaga")||t.includes("prevenir")?"disease_prevention":t.includes("crecimiento")||t.includes("progreso")||t.includes("tiempo")?"growth_tracking":"general"}const pe=({onClose:a})=>{const[t,s]=u.useState([{name:"garden-ai-chat",available:!1}]),[n,r]=u.useState(!1),i=async()=>{r(!0);const o=[],m=await b.verifyFunctionAvailability();o.push({name:"garden-ai-chat",available:m.available,error:m.error,lastChecked:new Date}),s(o),r(!1)};u.useEffect(()=>{i()},[]);const l=o=>o.available?e.jsx(Y,{className:"w-5 h-5 text-green-500"}):e.jsx(G,{className:"w-5 h-5 text-red-500"}),d=o=>o.available?"Disponible":"No disponible";return e.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:a,children:e.jsx(x.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:o=>o.stopPropagation(),className:"w-full max-w-md",children:e.jsxs(ae,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(W,{className:"w-6 h-6 text-blue-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"DiagnÃ³stico del Sistema"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Estado de Funciones Edge"}),e.jsx("div",{className:"space-y-3",children:t.map(o=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[l(o),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:o.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d(o)})]})]}),o.error&&e.jsxs("div",{className:"text-xs text-red-500 max-w-32 text-right",children:[o.error.substring(0,50),"..."]})]},o.name))})]}),t.some(o=>!o.available)&&e.jsx(x.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-yellow-800 dark:text-yellow-200",children:"Servicios no disponibles"}),e.jsx("p",{className:"text-yellow-700 dark:text-yellow-300 mt-1",children:"Algunos servicios del chat de jardÃ­n no estÃ¡n funcionando. Verifica que las funciones Edge estÃ©n desplegadas en Supabase."})]})]})}),e.jsxs("div",{className:"flex gap-3 pt-3",children:[e.jsxs(S,{onClick:i,disabled:n,variant:"outline",size:"sm",className:"flex-1 gap-2",children:[e.jsx(I,{className:`w-4 h-4 ${n?"animate-spin":""}`}),"Verificar Nuevamente"]}),e.jsx(S,{onClick:a,variant:"secondary",size:"sm",className:"flex-1",children:"Cerrar"})]})]})]})})})},L=({gardenSummary:a,onClearChat:t,onRefresh:s,isRefreshing:n=!1})=>{const r=Z(),[i,l]=u.useState(!1),d=m=>m>=80?"text-green-500":m>=60?"text-yellow-500":"text-red-500",o=m=>m>=80?"Excelente":m>=60?"Buena":"Necesita atenciÃ³n";return e.jsxs("header",{className:"sticky top-0 z-10 bg-background/80 backdrop-blur-sm border-b border-muted",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 pt-safe-top",children:[e.jsx("button",{onClick:()=>r("/"),className:"p-2 -ml-2 rounded-full hover:bg-muted transition-colors","aria-label":"Volver al dashboard",children:e.jsx(se,{size:20})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-full",children:e.jsx(M,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-foreground",children:"Asistente de JardÃ­n"}),a&&e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(te,{size:12}),a.totalPlants," plantas"]}),e.jsx("span",{className:`font-medium ${d(a.averageHealth)}`,children:o(a.averageHealth)}),a.urgentActions>0&&e.jsxs(x.span,{className:"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 px-2 py-0.5 rounded-full",initial:{scale:0},animate:{scale:1},transition:{delay:.2},children:[a.urgentActions," acciones"]})]})]})]})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>l(!0),className:"p-2 rounded-full hover:bg-muted transition-colors","aria-label":"DiagnÃ³stico del sistema",children:e.jsx(W,{size:18})}),s&&e.jsx("button",{onClick:s,disabled:n,className:"p-2 rounded-full hover:bg-muted transition-colors disabled:opacity-50","aria-label":"Actualizar datos del jardÃ­n",children:e.jsx(x.div,{animate:n?{rotate:360}:{},transition:n?{duration:1,repeat:1/0,ease:"linear"}:{},children:e.jsx(I,{size:18})})}),e.jsx("button",{onClick:t,className:"p-2 rounded-full hover:bg-muted transition-colors","aria-label":"Opciones del chat",children:e.jsx(re,{size:20})})]})]}),e.jsx(T,{children:i&&e.jsx(pe,{onClose:()=>l(!1)})})]})},ye=({message:a})=>{var r;const t=a.sender==="user",s=()=>{var i;if(!((i=a.context)!=null&&i.queryType))return e.jsx(H,{size:16});switch(a.context.queryType){case"health_analysis":return e.jsx(ee,{size:16});case"care_comparison":return e.jsx($,{size:16});case"disease_prevention":return e.jsx(he,{size:16});case"growth_tracking":return e.jsx(ne,{size:16});default:return e.jsx(H,{size:16})}},n=()=>{var i;if(t)return"text-primary-foreground/70";if(!((i=a.context)!=null&&i.queryType))return"text-green-500";switch(a.context.queryType){case"health_analysis":return"text-red-500";case"care_comparison":return"text-blue-500";case"disease_prevention":return"text-orange-500";case"growth_tracking":return"text-purple-500";default:return"text-green-500"}};return e.jsxs(x.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:D("flex items-end gap-2 max-w-[85%]",t?"justify-end ml-auto":"justify-start"),children:[!t&&e.jsx(x.div,{className:D("flex h-8 w-8 items-center justify-center rounded-full","bg-gradient-to-br from-green-100 to-green-200 dark:from-green-900/30 dark:to-green-800/30"),initial:{scale:0},animate:{scale:1},transition:{delay:.1},children:e.jsx("div",{className:n(),children:s()})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:D("rounded-2xl px-4 py-3 break-words",t?"rounded-br-lg bg-primary text-primary-foreground ml-8":"rounded-bl-lg bg-muted text-muted-foreground mr-8"),children:[e.jsx("div",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:a.content}),!t&&((r=a.context)==null?void 0:r.plantsAnalyzed)&&a.context.plantsAnalyzed.length>0&&e.jsxs(x.div,{className:"mt-2 flex items-center gap-1 text-xs opacity-70",initial:{opacity:0},animate:{opacity:.7},transition:{delay:.5},children:[e.jsx($,{size:12}),e.jsxs("span",{children:["AnalizÃ³ ",a.context.plantsAnalyzed.length," planta(s)"]})]}),e.jsx("div",{className:D("mt-2 text-xs",t?"text-primary-foreground/70":"text-muted-foreground/70"),children:ie(new Date(a.timestamp),{addSuffix:!0,locale:oe})})]})}),t&&e.jsx(x.div,{className:"flex h-8 w-8 items-center justify-center rounded-full bg-primary/10",initial:{scale:0},animate:{scale:1},transition:{delay:.1},children:e.jsx(le,{size:16,className:"text-primary"})})]})},je=({onSendMessage:a,isTyping:t,suggestedQuestions:s,isLoading:n=!1})=>{const[r,i]=u.useState(""),[l,d]=u.useState(!0),o=async()=>{if(!r.trim()||t)return;const h=r.trim();i(""),d(!1),await a(h)},m=h=>{h.key==="Enter"&&!h.shiftKey&&(h.preventDefault(),o())},p=async h=>{i(""),d(!1),await a(h)},f=()=>{s.length>0&&!r&&d(!0)},C=h=>{i(h.target.value),h.target.value.length>0?d(!1):d(!0)};return e.jsx("footer",{className:"sticky bottom-0 z-10 bg-background/80 backdrop-blur-sm border-t border-border",children:e.jsxs("div",{className:"p-4 pb-safe-bottom space-y-3",children:[e.jsx(T,{children:l&&s.length>0&&!n&&e.jsxs(x.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(_,{size:12}),e.jsx("span",{children:"Preguntas sugeridas"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.slice(0,4).map((h,c)=>e.jsx(x.button,{onClick:()=>p(h),disabled:t,className:"px-3 py-1.5 text-xs bg-muted hover:bg-muted/80 rounded-full border border-border/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-left",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:c*.1},whileHover:{scale:1.02},whileTap:{scale:.98},children:h},h))})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ce,{type:"text",value:r,onChange:C,onKeyPress:m,onFocus:f,placeholder:"PregÃºntame sobre tu jardÃ­n...",className:"pr-12",disabled:t||n}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-muted-foreground",children:e.jsx(de,{size:16})})]}),e.jsx(S,{"aria-label":"Enviar mensaje",onClick:o,disabled:!r.trim()||t||n,size:"icon",className:"shrink-0",children:t?e.jsx(x.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:e.jsx(_,{size:20})}):e.jsx(ue,{size:20})})]}),n&&e.jsxs(x.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center justify-center gap-2 text-xs text-muted-foreground",children:[e.jsx(x.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:e.jsx(_,{size:12})}),e.jsx("span",{children:"Analizando tu jardÃ­n..."})]})]})})},Ge=()=>{const{messages:a,isLoading:t,isTyping:s,error:n,gardenSummary:r,suggestedQuestions:i,sendMessage:l,clearMessages:d,retryLastMessage:o,refreshGardenData:m}=xe(),p=u.useRef(null);return u.useEffect(()=>{var f;(f=p.current)==null||f.scrollIntoView({behavior:"smooth"})},[a,s]),t&&a.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-screen bg-background text-foreground",children:e.jsxs(x.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},className:"text-center space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(x.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},children:e.jsx(M,{className:"w-12 h-12 text-green-500 mx-auto"})}),e.jsx(x.div,{animate:{scale:[1,1.2,1]},transition:{duration:1,repeat:1/0},className:"absolute inset-0 w-12 h-12 bg-green-500/20 rounded-full mx-auto"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"Analizando tu jardÃ­n..."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Preparando el contexto de todas tus plantas"})]})]})}):n&&a.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-screen bg-background text-foreground p-4",children:e.jsxs(x.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},className:"text-center space-y-4 max-w-md",children:[e.jsx(G,{className:"w-12 h-12 text-red-500 mx-auto"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"Error al cargar el chat"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:n})]}),e.jsxs(S,{onClick:()=>window.location.reload(),className:"gap-2",variant:"outline",children:[e.jsx(I,{size:16}),"Intentar de nuevo"]})]})}):(r==null?void 0:r.totalPlants)===0?e.jsxs("div",{className:"flex flex-col h-screen bg-background text-foreground",children:[e.jsx(L,{gardenSummary:r}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-center space-y-4",children:[e.jsxs(x.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},children:[e.jsx(M,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Tu jardÃ­n estÃ¡ vacÃ­o"}),e.jsx("p",{className:"text-muted-foreground max-w-sm",children:"Agrega algunas plantas a tu jardÃ­n para poder chatear conmigo sobre su cuidado y salud."})]}),e.jsx(S,{onClick:()=>window.location.href="/camera",className:"mt-6",children:"Agregar mi primera planta"})]})]}):e.jsxs("div",{className:"flex flex-col h-screen bg-background text-foreground",children:[e.jsx(L,{gardenSummary:r,onClearChat:d,onRefresh:m,isRefreshing:t&&a.length>0}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"p-4 space-y-4 max-w-4xl mx-auto",children:[e.jsx(T,{children:a.map(f=>e.jsx(ye,{message:f},f.id))}),s&&e.jsx(x.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:e.jsx(me,{})}),n&&a.length>0&&e.jsx(x.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center justify-center",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3 max-w-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700 dark:text-red-300 text-sm",children:[e.jsx(G,{size:16}),e.jsx("span",{children:n})]}),e.jsxs(S,{onClick:o,size:"sm",variant:"outline",className:"mt-2 w-full",children:[e.jsx(I,{size:14,className:"mr-1"}),"Reintentar"]})]})}),e.jsx("div",{ref:p})]}),!1]}),e.jsx(je,{onSendMessage:l,isTyping:s,suggestedQuestions:i,isLoading:t})]})};export{Ge as default};
