var Z=Object.defineProperty;var J=(t,a,s)=>a in t?Z(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s;var F=(t,a,s)=>J(t,typeof a!="symbol"?a+"":a,s);import{B,a3 as b,ad as L,u as ee,r as x,j as e,m as n,O as D,S as M,Q as ae,a as W,A as T,c as z,K as H,T as te,E as se}from"./index-B2fNzZDV.js";import{B as S,S as I}from"./Button-CyFqPBaH.js";import{C as _,A as re,c as Q,M as ne}from"./Card-CjNdmX8S.js";import{A as ie}from"./arrow-left-BWTMCmfZ.js";import{S as U,E as le,L as oe}from"./sprout-BUQlRiWF.js";import{a as $}from"./eye-C8ylbb3i.js";import{f as ce,l as de,I as ue}from"./Input-DzNPKNL_.js";import{U as me}from"./user-dliJ4Qc4.js";import{C as xe,S as he,T as ge}from"./TypingIndicator-CbdrOPf0.js";import"./index-Bnwr932r.js";/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=B("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=B("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]),N=class N{static getInstance(){return N.instance||(N.instance=new N),N.instance}async sendMessage(a,s,i){try{const{data:{session:r},error:l}=await b.auth.getSession();if(l||!(r!=null&&r.access_token))throw console.error("User session not available:",l),new Error("Usuario no autenticado. Por favor inicia sesiÃ³n nuevamente.");const{data:d,error:m}=await b.functions.invoke("garden-ai-chat",{body:{message:a,sessionId:s,userId:i},headers:{Authorization:`Bearer ${r.access_token}`}});if(m)throw new Error(`Garden AI service error: ${m.message}`);if(!d)throw new Error("No data received from garden AI service");return d}catch(r){throw console.error("Error in garden chat service:",r),r}}async sendMessageToGardenAI(a,s,i){try{const r=await this.buildGardenContext(s),l=i.map(y=>({role:y.sender==="user"?"user":"assistant",content:y.content})),{data:{session:d},error:m}=await b.auth.getSession();if(m||!(d!=null&&d.access_token))throw console.error("User session not available:",m),new Error("Usuario no autenticado. Por favor inicia sesiÃ³n nuevamente.");const{data:o,error:h}=await b.functions.invoke("garden-ai-chat",{body:{userMessage:a,gardenContext:r,conversationHistory:l},headers:{Authorization:`Bearer ${d.access_token}`}});if(h)throw new Error(`Garden AI service error: ${h.message}`);if(!o)throw new Error("No data received from garden AI service");const p=typeof o=="string"?JSON.parse(o):o;return{content:p.content||"Lo siento, no pude procesar tu mensaje.",insights:p.insights||[],suggestedActions:p.suggestedActions||[]}}catch(r){throw console.error("Error sending message to garden AI:",r),r}}async verifyFunctionAvailability(){try{const a={userMessage:"ping",gardenContext:{totalPlants:0,plantsData:[],averageHealthScore:0,commonIssues:[],careScheduleSummary:{needsWatering:[],needsFertilizing:[],healthConcerns:[]},environmentalFactors:{locations:["test"]}},conversationHistory:[]},{data:{session:s},error:i}=await b.auth.getSession();if(i||!(s!=null&&s.access_token))throw console.error("User session not available:",i),new Error("Usuario no autenticado. Por favor inicia sesiÃ³n nuevamente.");const{data:r,error:l}=await b.functions.invoke("garden-ai-chat",{body:a,headers:{Authorization:`Bearer ${s.access_token}`}});return l?l.message.includes("404")||l.message.includes("not found")?{available:!1,error:"La funciÃ³n de chat de jardÃ­n no estÃ¡ disponible en este momento"}:{available:!1,error:l.message}:r&&typeof r.content=="string"?{available:!0}:{available:!1,error:"Function returned unexpected response format"}}catch(a){return{available:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async getGardenHealthSummary(a){try{const s=L.getGardenSummary(a);if(s)return s;const i=await this.buildGardenContext(a),r=i.plantsData.filter(m=>m.healthScore>=80).length,l=i.careScheduleSummary.needsWatering.length+i.careScheduleSummary.healthConcerns.length,d={totalPlants:i.totalPlants,averageHealth:i.averageHealthScore,urgentActions:l,healthyPlants:r};return L.setGardenSummary(a,d),d}catch(s){throw console.error("Error getting garden health summary:",s),s}}async getSuggestedQuestions(a){try{const s=await this.buildGardenContext(a),i=["Â¿CÃ³mo estÃ¡ la salud general de mi jardÃ­n?","Â¿QuÃ© plantas necesitan mÃ¡s atenciÃ³n?","Â¿CuÃ¡les son mis prÃ³ximas tareas de cuidado?"];return s.careScheduleSummary.needsWatering.length>0&&i.push("Â¿QuÃ© plantas necesitan riego?"),s.careScheduleSummary.healthConcerns.length>0&&i.push("Â¿QuÃ© plantas tienen problemas de salud?"),s.totalPlants>5&&i.push("Â¿CÃ³mo organizar mejor mi espacio de plantas?"),i}catch(s){return console.error("Error getting suggested questions:",s),["Â¿CÃ³mo estÃ¡ la salud general de mi jardÃ­n?","Â¿QuÃ© plantas necesitan mÃ¡s atenciÃ³n?","Â¿CuÃ¡les son mis prÃ³ximas tareas de cuidado?"]}}async refreshGardenData(a){try{this.invalidateCache(a),await this.buildGardenContext(a),console.log("[GardenChatService] Garden data refreshed for user:",a)}catch(s){throw console.error("Error refreshing garden data:",s),s}}async buildGardenContext(a){try{const s=L.getGardenContext(a);if(s)return s;const{data:i,error:r}=await b.from("plants").select(`
          id,
          name,
          nickname,
          species,
          location,
          plant_environment,
          light_requirements,
          health_score,
          last_watered,
          last_fertilized,
          care_profile,
          date_added
        `).eq("user_id",a).order("created_at",{ascending:!1});if(r)throw r;const l=i.map(u=>{var j;return{id:u.id,name:u.name,nickname:u.nickname||void 0,species:u.species,location:u.location,plantEnvironment:u.plant_environment,lightRequirements:u.light_requirements,healthScore:u.health_score||85,lastWatered:u.last_watered?new Date(u.last_watered):void 0,wateringFrequency:(j=u.care_profile)==null?void 0:j.wateringFrequency}}),d=l.length,m=d>0?Math.round(l.reduce((u,j)=>u+j.healthScore,0)/d):0,o=new Date,h=[],p=[],y=[];l.forEach(u=>{if(u.lastWatered&&u.wateringFrequency){const j=new Date(u.lastWatered),k=new Date(j);k.setDate(j.getDate()+u.wateringFrequency),o>k&&h.push(u.id)}u.healthScore<70&&y.push(u.id)});const v=[...new Set(l.map(u=>u.location))],c={totalPlants:d,plantsData:l,averageHealthScore:m,commonIssues:[],careScheduleSummary:{needsWatering:h,needsFertilizing:p,healthConcerns:y},environmentalFactors:{locations:v,lightConditions:[],humidityNeeds:[]}};return L.setGardenContext(a,c),c}catch(s){throw console.error("Error building garden context:",s),s}}invalidateCache(a){L.invalidateCache(a),console.log("Cache invalidated for user:",a)}};F(N,"instance");let q=N;const w=q.getInstance(),ye=()=>{const{user:t}=ee(),[a,s]=x.useState([]),[i,r]=x.useState(!1),[l,d]=x.useState(!1),[m,o]=x.useState(null),[h,p]=x.useState(null),[y,v]=x.useState([]),[c,u]=x.useState("");x.useEffect(()=>{t!=null&&t.id&&j()},[t==null?void 0:t.id]);const j=async()=>{if(t!=null&&t.id){r(!0);try{const[g,A]=await Promise.all([w.getGardenHealthSummary(t.id),w.getSuggestedQuestions(t.id)]);if(p(g),v(A),a.length===0&&g.totalPlants>0){const G={id:`welcome-${Date.now()}`,sender:"ai",content:`Â¡Hola! Soy tu asistente de jardÃ­n ðŸŒ± 

Veo que tienes ${g.totalPlants} plantas en tu jardÃ­n con una salud promedio de ${g.averageHealth}%. ${g.urgentActions>0?`Hay ${g.urgentActions} acciones que podrÃ­an necesitar tu atenciÃ³n.`:"Â¡Todo parece estar en buen estado!"}

Â¿En quÃ© puedo ayudarte hoy con tu jardÃ­n?`,timestamp:new Date,context:{queryType:"general"}};s([G])}}catch(g){console.error("Error loading initial garden data:",g),o("Error al cargar la informaciÃ³n del jardÃ­n")}finally{r(!1)}}},k=x.useCallback(async g=>{if(!(t!=null&&t.id)||!g.trim()||l)return;const A=await w.verifyFunctionAvailability();if(!A.available){o(`ðŸš§ El chat de jardÃ­n no estÃ¡ disponible: ${A.error}`);return}const G={id:`user-${Date.now()}`,sender:"user",content:g.trim(),timestamp:new Date};u(g.trim()),s(f=>[...f,G]),d(!0),o(null);try{const f=await w.sendMessageToGardenAI(g.trim(),t.id,a),C={id:`ai-${Date.now()}`,sender:"ai",content:f.content,timestamp:new Date,context:{plantsAnalyzed:fe(f),queryType:je(g)}};if(s(E=>[...E,C]),f.suggestedActions&&f.suggestedActions.length>0){const E=await w.getGardenHealthSummary(t.id);p(E)}}catch(f){console.error("Error sending message to garden AI:",f);let C="Error al enviar el mensaje. Por favor intenta de nuevo.";f instanceof Error&&(f.message.includes("funciÃ³n de chat de jardÃ­n no estÃ¡ disponible")?C="ðŸš§ El chat de jardÃ­n estÃ¡ temporalmente no disponible. Estamos trabajando para solucionarlo.":f.message.includes("CORS")?C="ðŸ”§ Error de configuraciÃ³n. Por favor contacta al administrador.":f.message.includes("garden-ai-chat no existe")&&(C="âš ï¸ Servicio no configurado. El chat de jardÃ­n necesita configuraciÃ³n adicional.")),o(C),s(E=>E.slice(0,-1))}finally{d(!1)}},[t==null?void 0:t.id,a,l]),O=x.useCallback(async()=>{c&&await k(c)},[c,k]),V=x.useCallback(()=>{s([]),o(null),t!=null&&t.id&&j()},[t==null?void 0:t.id]),Y=x.useCallback(async()=>{if(t!=null&&t.id){r(!0);try{await w.refreshGardenData(t.id),await j(),console.log("[useGardenChat] Garden data refreshed successfully")}catch(g){console.error("Error refreshing garden data:",g),o("Error al actualizar los datos del jardÃ­n")}finally{r(!1)}}},[t==null?void 0:t.id]),K=x.useMemo(()=>i,[i]),X=x.useMemo(()=>{},[t==null?void 0:t.id,h]);return{messages:a,isLoading:K,isTyping:l,error:m,gardenSummary:h,suggestedQuestions:y,sendMessage:k,clearMessages:V,retryLastMessage:O,refreshGardenData:Y,cacheStats:X}};function fe(t){const a=[];return t.insights&&t.insights.forEach(s=>{s.affectedPlants&&a.push(...s.affectedPlants)}),t.suggestedActions&&t.suggestedActions.forEach(s=>{s.plantIds&&a.push(...s.plantIds)}),[...new Set(a)]}function je(t){const a=t.toLowerCase();return a.includes("salud")||a.includes("problema")||a.includes("enferm")?"health_analysis":a.includes("comparar")||a.includes("diferencia")||a.includes("mejor")?"care_comparison":a.includes("hongo")||a.includes("plaga")||a.includes("prevenir")?"disease_prevention":a.includes("crecimiento")||a.includes("progreso")||a.includes("tiempo")?"growth_tracking":"general"}const ve=({onClose:t})=>{const[a,s]=x.useState([{name:"garden-ai-chat",available:!1}]),[i,r]=x.useState(!1),l=async()=>{r(!0);const o=[],h=await w.verifyFunctionAvailability();o.push({name:"garden-ai-chat",available:h.available,error:h.error,lastChecked:new Date}),s(o),r(!1)};x.useEffect(()=>{l()},[]);const d=o=>o.available?e.jsx(ae,{className:"w-5 h-5 text-green-500"}):e.jsx(D,{className:"w-5 h-5 text-red-500"}),m=o=>o.available?"Disponible":"No disponible";return e.jsx(n.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:t,children:e.jsx(n.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:o=>o.stopPropagation(),className:"w-full max-w-md",children:e.jsxs(_,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(R,{className:"w-6 h-6 text-blue-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"DiagnÃ³stico del Sistema"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Estado de Funciones Edge"}),e.jsx("div",{className:"space-y-3",children:a.map(o=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[d(o),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:o.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:m(o)})]})]}),o.error&&e.jsxs("div",{className:"text-xs text-red-500 max-w-32 text-right",children:[o.error.substring(0,50),"..."]})]},o.name))})]}),a.some(o=>!o.available)&&e.jsx(n.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(D,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-yellow-800 dark:text-yellow-200",children:"Servicios no disponibles"}),e.jsx("p",{className:"text-yellow-700 dark:text-yellow-300 mt-1",children:"Algunos servicios del chat de jardÃ­n no estÃ¡n funcionando. Verifica que las funciones Edge estÃ©n desplegadas en Supabase."})]})]})}),e.jsxs("div",{className:"flex gap-3 pt-3",children:[e.jsxs(S,{onClick:l,disabled:i,variant:"outline",size:"sm",className:"flex-1 gap-2",children:[e.jsx(M,{className:`w-4 h-4 ${i?"animate-spin":""}`}),"Verificar Nuevamente"]}),e.jsx(S,{onClick:t,variant:"secondary",size:"sm",className:"flex-1",children:"Cerrar"})]})]})]})})})},P=({gardenSummary:t,onClearChat:a,onRefresh:s,isRefreshing:i=!1})=>{const r=W(),[l,d]=x.useState(!1),m=h=>h>=80?"text-green-500":h>=60?"text-yellow-500":"text-red-500",o=h=>h>=80?"Excelente":h>=60?"Buena":"Necesita atenciÃ³n";return e.jsxs("header",{className:"sticky top-0 z-10 bg-background/80 backdrop-blur-sm border-b border-muted",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 pt-safe-top",children:[e.jsx("button",{onClick:()=>r("/"),className:"p-2 -ml-2 rounded-full hover:bg-muted transition-colors","aria-label":"Volver al dashboard",children:e.jsx(ie,{size:20})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-full",children:e.jsx(U,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-foreground",children:"Asistente de JardÃ­n"}),t&&e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(re,{size:12}),t.totalPlants," plantas"]}),e.jsx("span",{className:`font-medium ${m(t.averageHealth)}`,children:o(t.averageHealth)}),t.urgentActions>0&&e.jsxs(n.span,{className:"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 px-2 py-0.5 rounded-full",initial:{scale:0},animate:{scale:1},transition:{delay:.2},children:[t.urgentActions," acciones"]})]})]})]})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>d(!0),className:"p-2 rounded-full hover:bg-muted transition-colors","aria-label":"DiagnÃ³stico del sistema",children:e.jsx(R,{size:18})}),s&&e.jsx("button",{onClick:s,disabled:i,className:"p-2 rounded-full hover:bg-muted transition-colors disabled:opacity-50","aria-label":"Actualizar datos del jardÃ­n",children:e.jsx(n.div,{animate:i?{rotate:360}:{},transition:i?{duration:1,repeat:1/0,ease:"linear"}:{},children:e.jsx(M,{size:18})})}),e.jsx("button",{onClick:a,className:"p-2 rounded-full hover:bg-muted transition-colors","aria-label":"Opciones del chat",children:e.jsx(le,{size:20})})]})]}),e.jsx(T,{children:l&&e.jsx(ve,{onClose:()=>d(!1)})})]})},be=({message:t})=>{var r;const a=t.sender==="user",s=()=>{var l;if(!((l=t.context)!=null&&l.queryType))return e.jsx(H,{size:16});switch(t.context.queryType){case"health_analysis":return e.jsx(te,{size:16});case"care_comparison":return e.jsx($,{size:16});case"disease_prevention":return e.jsx(pe,{size:16});case"growth_tracking":return e.jsx(oe,{size:16});default:return e.jsx(H,{size:16})}},i=()=>{var l;if(a)return"text-primary-foreground/70";if(!((l=t.context)!=null&&l.queryType))return"text-green-500";switch(t.context.queryType){case"health_analysis":return"text-red-500";case"care_comparison":return"text-blue-500";case"disease_prevention":return"text-orange-500";case"growth_tracking":return"text-purple-500";default:return"text-green-500"}};return e.jsxs(n.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:z("flex items-end gap-2 max-w-[85%]",a?"justify-end ml-auto":"justify-start"),children:[!a&&e.jsx(n.div,{className:z("flex h-8 w-8 items-center justify-center rounded-full","bg-gradient-to-br from-green-100 to-green-200 dark:from-green-900/30 dark:to-green-800/30"),initial:{scale:0},animate:{scale:1},transition:{delay:.1},children:e.jsx("div",{className:i(),children:s()})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:z("rounded-2xl px-4 py-3 break-words shadow-adaptive",a?"rounded-br-lg bg-primary text-white ml-8":"rounded-bl-lg bg-contrast-surface text-contrast-medium mr-8 border border-contrast"),children:[e.jsx("div",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:t.content}),!a&&((r=t.context)==null?void 0:r.plantsAnalyzed)&&t.context.plantsAnalyzed.length>0&&e.jsxs(n.div,{className:"mt-2 flex items-center gap-1 text-xs opacity-70",initial:{opacity:0},animate:{opacity:.7},transition:{delay:.5},children:[e.jsx($,{size:12}),e.jsxs("span",{children:["AnalizÃ³ ",t.context.plantsAnalyzed.length," planta(s)"]})]}),e.jsx("div",{className:z("mt-2 text-xs",a?"text-primary-foreground/70":"text-muted-foreground/70"),children:ce(new Date(t.timestamp),{addSuffix:!0,locale:de})})]})}),a&&e.jsx(n.div,{className:"flex h-8 w-8 items-center justify-center rounded-full bg-primary/10",initial:{scale:0},animate:{scale:1},transition:{delay:.1},children:e.jsx(me,{size:16,className:"text-primary"})})]})},we=({onSendMessage:t,isTyping:a,suggestedQuestions:s,isLoading:i=!1})=>{const[r,l]=x.useState(""),[d,m]=x.useState(!0),o=async()=>{if(!r.trim()||a)return;const c=r.trim();l(""),m(!1),await t(c)},h=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),o())},p=async c=>{l(""),m(!1),await t(c)},y=()=>{s.length>0&&!r&&m(!0)},v=c=>{l(c.target.value),c.target.value.length>0?m(!1):m(!0)};return e.jsx("footer",{className:"sticky bottom-0 z-10 bg-background/80 backdrop-blur-sm border-t border-border",children:e.jsxs("div",{className:"p-4 pb-safe-bottom space-y-3",children:[e.jsx(T,{children:d&&s.length>0&&!i&&e.jsxs(n.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(I,{size:12}),e.jsx("span",{children:"Preguntas sugeridas"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.slice(0,4).map((c,u)=>e.jsx(n.button,{onClick:()=>p(c),disabled:a,className:"px-3 py-1.5 text-xs bg-muted hover:bg-muted/80 rounded-full border border-border/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-left",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:u*.1},whileHover:{scale:1.02},whileTap:{scale:.98},children:c},c))})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ue,{type:"text",value:r,onChange:v,onKeyPress:h,onFocus:y,placeholder:"PregÃºntame sobre tu jardÃ­n...",className:"pr-12",disabled:a||i}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-muted-foreground",children:e.jsx(xe,{size:16})})]}),e.jsx(S,{"aria-label":"Enviar mensaje",onClick:o,disabled:!r.trim()||a||i,size:"icon",className:"shrink-0",children:a?e.jsx(n.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:e.jsx(I,{size:20})}):e.jsx(he,{size:20})})]}),i&&e.jsxs(n.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center justify-center gap-2 text-xs text-muted-foreground",children:[e.jsx(n.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:e.jsx(I,{size:12})}),e.jsx("span",{children:"Analizando tu jardÃ­n..."})]})]})})},Ne={plants:e.jsx("svg",{viewBox:"0 0 200 150",className:"w-32 h-24 text-primary-300 dark:text-primary-600",children:e.jsxs(n.g,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.8,ease:"easeOut"},children:[e.jsx(n.path,{d:"M60 120 L140 120 L130 100 L70 100 Z",fill:"currentColor",initial:{scaleY:0},animate:{scaleY:1},transition:{delay:.2,duration:.5}}),e.jsx(n.g,{initial:{scale:0,rotate:-10},animate:{scale:1,rotate:0},transition:{delay:.5,duration:.8,type:"spring"},children:e.jsx("path",{d:"M80 100 Q85 80 90 85 Q95 75 85 70 Q75 75 80 100",fill:"currentColor",opacity:"0.8"})}),e.jsx(n.g,{initial:{scale:0,rotate:10},animate:{scale:1,rotate:0},transition:{delay:.7,duration:.8,type:"spring"},children:e.jsx("path",{d:"M100 100 Q105 85 110 90 Q115 80 105 75 Q95 80 100 100",fill:"currentColor",opacity:"0.7"})}),e.jsx(n.g,{initial:{scale:0,rotate:-5},animate:{scale:1,rotate:0},transition:{delay:.9,duration:.8,type:"spring"},children:e.jsx("path",{d:"M120 100 Q125 90 130 95 Q135 85 125 80 Q115 85 120 100",fill:"currentColor",opacity:"0.6"})})]})}),search:e.jsx("svg",{viewBox:"0 0 200 150",className:"w-32 h-24 text-primary-300 dark:text-primary-600",children:e.jsxs(n.g,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},children:[e.jsx(n.circle,{cx:"80",cy:"70",r:"25",stroke:"currentColor",strokeWidth:"3",fill:"none",initial:{scale:0},animate:{scale:1},transition:{delay:.3,duration:.5,type:"spring"}}),e.jsx(n.line,{x1:"100",y1:"88",x2:"120",y2:"108",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",initial:{scaleX:0},animate:{scaleX:1},transition:{delay:.6,duration:.4}}),e.jsx(n.circle,{cx:"140",cy:"50",r:"2",fill:"currentColor",initial:{scale:0},animate:{scale:1},transition:{delay:1,duration:.3}}),e.jsx(n.circle,{cx:"150",cy:"40",r:"3",fill:"currentColor",initial:{scale:0},animate:{scale:1},transition:{delay:1.2,duration:.3}})]})}),chat:e.jsx("svg",{viewBox:"0 0 200 150",className:"w-32 h-24 text-primary-300 dark:text-primary-600",children:e.jsxs(n.g,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},children:[e.jsx(n.rect,{x:"50",y:"40",width:"100",height:"60",rx:"20",fill:"currentColor",opacity:"0.8",initial:{scale:0,y:20},animate:{scale:1,y:0},transition:{delay:.2,duration:.6,type:"spring"}}),e.jsx(n.path,{d:"M80 100 L70 115 L95 105 Z",fill:"currentColor",opacity:"0.8",initial:{scale:0},animate:{scale:1},transition:{delay:.5,duration:.4}}),e.jsxs(n.g,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8,duration:.5},children:[e.jsx("circle",{cx:"75",cy:"70",r:"3",fill:"white"}),e.jsx("circle",{cx:"100",cy:"70",r:"3",fill:"white"}),e.jsx("circle",{cx:"125",cy:"70",r:"3",fill:"white"})]})]})}),camera:e.jsx("svg",{viewBox:"0 0 200 150",className:"w-32 h-24 text-primary-300 dark:text-primary-600",children:e.jsxs(n.g,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},children:[e.jsx(n.rect,{x:"60",y:"60",width:"80",height:"50",rx:"8",fill:"currentColor",opacity:"0.8",initial:{scale:0},animate:{scale:1},transition:{delay:.2,duration:.5,type:"spring"}}),e.jsx(n.rect,{x:"85",y:"45",width:"30",height:"15",rx:"4",fill:"currentColor",opacity:"0.6",initial:{scaleY:0},animate:{scaleY:1},transition:{delay:.4,duration:.3}}),e.jsx(n.circle,{cx:"100",cy:"85",r:"15",stroke:"white",strokeWidth:"2",fill:"none",initial:{scale:0},animate:{scale:1},transition:{delay:.6,duration:.4,type:"spring"}}),e.jsx(n.circle,{cx:"120",cy:"70",r:"3",fill:"currentColor",opacity:"0.9",initial:{scale:0},animate:{scale:[0,1.2,1]},transition:{delay:.8,duration:.5}})]})}),settings:e.jsx("svg",{viewBox:"0 0 200 150",className:"w-32 h-24 text-primary-300 dark:text-primary-600",children:e.jsxs(n.g,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},children:[e.jsxs(n.g,{animate:{rotate:360},transition:{duration:20,repeat:1/0,ease:"linear"},style:{originX:"100px",originY:"75px"},children:[e.jsx("path",{d:"M100 50 L110 60 L120 50 L120 60 L130 70 L120 80 L120 90 L110 90 L100 100 L90 90 L80 90 L80 80 L70 70 L80 60 L80 50 Z",fill:"currentColor",opacity:"0.7"}),e.jsx("circle",{cx:"100",cy:"75",r:"8",fill:"white"})]}),e.jsxs(n.g,{animate:{rotate:-360},transition:{duration:15,repeat:1/0,ease:"linear"},style:{originX:"140px",originY:"95px"},children:[e.jsx("path",{d:"M140 85 L145 90 L150 85 L150 90 L155 95 L150 100 L150 105 L145 105 L140 110 L135 105 L130 105 L130 100 L125 95 L130 90 L130 85 Z",fill:"currentColor",opacity:"0.5"}),e.jsx("circle",{cx:"140",cy:"95",r:"5",fill:"white"})]})]})})},ke=({icon:t,title:a,description:s,action:i,illustration:r="plants",className:l})=>e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},className:z("flex flex-col items-center justify-center text-center py-12 px-6 max-w-md mx-auto",l),children:[e.jsx(n.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2,duration:.5,ease:"easeOut"},className:"mb-6",children:t||Ne[r]}),e.jsx(n.h3,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4,duration:.5},className:"text-xl font-semibold text-neutral-900 dark:text-neutral-100 mb-3",children:a}),e.jsx(n.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5,duration:.5},className:"text-neutral-600 dark:text-neutral-400 mb-6 leading-relaxed",children:s}),i&&e.jsx(n.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.6,duration:.5},children:e.jsx(S,{onClick:i.onClick,variant:"primary",size:"lg",className:"animate-glow",children:i.label})})]}),_e=()=>{const t=W(),a=se(c=>c.plants),{messages:s,isLoading:i,isTyping:r,error:l,gardenSummary:d,suggestedQuestions:m,sendMessage:o,clearMessages:h,retryLastMessage:p,refreshGardenData:y}=ye(),v=x.useRef(null);return x.useEffect(()=>{var c;(c=v.current)==null||c.scrollIntoView({behavior:"smooth"})},[s,r]),l&&!d?e.jsxs("div",{className:"flex flex-col h-screen bg-background text-foreground",children:[e.jsx(P,{gardenSummary:d}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center max-w-md",children:[e.jsx(D,{className:"w-16 h-16 text-destructive mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Error de conexiÃ³n"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:l}),e.jsxs(S,{onClick:y,variant:"primary",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Reintentar"]})]})})]}):(d==null?void 0:d.totalPlants)===0?e.jsxs("div",{className:"flex flex-col h-screen bg-background text-foreground",children:[e.jsx(P,{gardenSummary:d}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(ke,{illustration:"plants",title:"Tu jardÃ­n estÃ¡ vacÃ­o",description:"Agrega algunas plantas a tu jardÃ­n para poder chatear conmigo sobre su cuidado y salud.",action:{label:"Agregar mi primera planta",onClick:()=>t("/camera")}})})]}):e.jsxs("div",{className:"flex flex-col h-screen bg-background text-foreground",children:[e.jsx(P,{gardenSummary:d,onClearChat:h,onRefresh:y,isRefreshing:i&&s.length>0}),s.length===0&&a.length>0&&e.jsxs("div",{className:"p-4 border-b border-neutral-200 dark:border-neutral-700",children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-3",children:"Chats individuales con tus plantas:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.slice(0,4).map(c=>e.jsx(_,{variant:"glass",size:"sm",interactive:!0,className:"cursor-pointer hover:border-primary-300 dark:hover:border-primary-600",onClick:()=>t(`/plant/${c.id}/chat`),children:e.jsx(Q,{className:"p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary-100 dark:bg-primary-900 flex items-center justify-center",children:e.jsx(U,{className:"w-4 h-4 text-primary-600 dark:text-primary-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:c.nickname||c.name}),e.jsx("p",{className:"text-xs text-neutral-500 truncate",children:c.species})]}),e.jsx(ne,{className:"w-4 h-4 text-neutral-400"})]})})},c.id)),a.length>4&&e.jsx(_,{variant:"outline",size:"sm",interactive:!0,className:"cursor-pointer",onClick:()=>t("/"),children:e.jsx(Q,{className:"p-3 flex items-center justify-center",children:e.jsxs("span",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:["+",a.length-4," mÃ¡s"]})})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"p-4 space-y-4 max-w-4xl mx-auto",children:[e.jsx(T,{children:s.map(c=>e.jsx(be,{message:c},c.id))}),r&&e.jsx(n.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:e.jsx(ge,{})}),l&&s.length>0&&e.jsx(n.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center justify-center",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3 max-w-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700 dark:text-red-300 text-sm",children:[e.jsx(D,{size:16}),e.jsx("span",{children:l})]}),e.jsxs(S,{onClick:p,size:"sm",variant:"outline",className:"mt-2 w-full",children:[e.jsx(M,{size:14,className:"mr-1"}),"Reintentar"]})]})}),e.jsx("div",{ref:v})]}),!1]}),e.jsx(we,{onSendMessage:o,isTyping:r,suggestedQuestions:m,isLoading:i})]})};export{_e as default};
