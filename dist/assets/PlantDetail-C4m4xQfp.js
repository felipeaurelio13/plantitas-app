import{b as ts,i as as,f as B,c as xe,d as He,e as rs,v as ns,g as ls,h as is,k as os,l as Le,o as cs,s as ds,q as he,t as O,r as j,w as Re,x as fe,M as ms,y as oe,z as N,B as qe,u as ge,C as ne,D as Q,p as _,E as je,F as us,G as xs,j as e,H as L,m as h,A as q,X as Fe,I as hs,J as gs,K as Oe,R as ps,a as Be,N as Y,O as be,Q as We,T as se,P as ye,S as Ve,U as me,V as Z,W as X,Y as fs,Z as js,n as ve}from"./index-DJn3qQTM.js";import{u as $e}from"./usePlantDetail-C6Cwi35q.js";import{C as V,c as te,a as Ne,b as we}from"./Card-I9waaeNI.js";import{L as ae,D as Ue,W as bs,S as p}from"./skeleton-BMAfmNZw.js";import{C as ys,T as vs,M as Ns}from"./trash-2-Bjh5UXe3.js";import{B as k,S as T}from"./Button-CIBeVTkW.js";import{A as ws,E as ks,S as Cs,L as Ss,M as Es}from"./sprout-Ck833qAo.js";import{A as Is}from"./index-B-cOHYAm.js";import{S as W}from"./sun-DeIF2K3R.js";import"./useQuery-B5n1QGWj.js";const J=new WeakMap;let M;const Ge=(s,t,r)=>(a,n)=>n&&n[0]?n[0][s+"Size"]:as(a)&&"getBBox"in a?a.getBBox()[t]:a[r],Ps=Ge("inline","width","offsetWidth"),zs=Ge("block","height","offsetHeight");function As({target:s,borderBoxSize:t}){var r;(r=J.get(s))==null||r.forEach(a=>{a(s,{get width(){return Ps(s,t)},get height(){return zs(s,t)}})})}function Ms(s){s.forEach(As)}function Ts(){typeof ResizeObserver>"u"||(M=new ResizeObserver(Ms))}function Ds(s,t){M||Ts();const r=ts(s);return r.forEach(a=>{let n=J.get(a);n||(n=new Set,J.set(a,n)),n.add(t),M==null||M.observe(a)}),()=>{r.forEach(a=>{const n=J.get(a);n==null||n.delete(t),n!=null&&n.size||M==null||M.unobserve(a)})}}const ee=new Set;let R;function Hs(){R=()=>{const s={get width(){return window.innerWidth},get height(){return window.innerHeight}};ee.forEach(t=>t(s))},window.addEventListener("resize",R)}function Ls(s){return ee.add(s),R||Hs(),()=>{ee.delete(s),!ee.size&&typeof R=="function"&&(window.removeEventListener("resize",R),R=void 0)}}function Rs(s,t){return typeof s=="function"?Ls(s):Ds(s,t)}function _e(s,t){let r;const a=()=>{const{currentTime:n}=t,d=(n===null?0:n.value)/100;r!==d&&s(d),r=d};return B.preUpdate(a,!0),()=>xe(a)}function qs(...s){const t=!Array.isArray(s[0]),r=t?0:-1,a=s[0+r],n=s[1+r],l=s[2+r],d=s[3+r],i=He(n,l,d);return t?i(a):i}const Fs=50,ke=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),Os=()=>({time:0,x:ke(),y:ke()}),Bs={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function Ce(s,t,r,a){const n=r[t],{length:l,position:d}=Bs[t],i=n.current,o=r.time;n.current=s[`scroll${d}`],n.scrollLength=s[`scroll${l}`]-s[`client${l}`],n.offset.length=0,n.offset[0]=0,n.offset[1]=n.scrollLength,n.progress=rs(0,n.scrollLength,n.current);const m=a-o;n.velocity=m>Fs?0:ns(n.current-i,m)}function Ws(s,t,r){Ce(s,"x",t,r),Ce(s,"y",t,r),t.time=r}function Vs(s,t){const r={x:0,y:0};let a=s;for(;a&&a!==t;)if(ls(a))r.x+=a.offsetLeft,r.y+=a.offsetTop,a=a.offsetParent;else if(a.tagName==="svg"){const n=a.getBoundingClientRect();a=a.parentElement;const l=a.getBoundingClientRect();r.x+=n.left-l.left,r.y+=n.top-l.top}else if(a instanceof SVGGraphicsElement){const{x:n,y:l}=a.getBBox();r.x+=n,r.y+=l;let d=null,i=a.parentNode;for(;!d;)i.tagName==="svg"&&(d=i),i=a.parentNode;a=d}else break;return r}const ue={start:0,center:.5,end:1};function Se(s,t,r=0){let a=0;if(s in ue&&(s=ue[s]),typeof s=="string"){const n=parseFloat(s);s.endsWith("px")?a=n:s.endsWith("%")?s=n/100:s.endsWith("vw")?a=n/100*document.documentElement.clientWidth:s.endsWith("vh")?a=n/100*document.documentElement.clientHeight:s=n}return typeof s=="number"&&(a=t*s),r+a}const $s=[0,0];function Us(s,t,r,a){let n=Array.isArray(s)?s:$s,l=0,d=0;return typeof s=="number"?n=[s,s]:typeof s=="string"&&(s=s.trim(),s.includes(" ")?n=s.split(" "):n=[s,ue[s]?s:"0"]),l=Se(n[0],r,a),d=Se(n[1],t),l-d}const Gs={All:[[0,0],[1,1]]},_s={x:0,y:0};function Ks(s){return"getBBox"in s&&s.tagName!=="svg"?s.getBBox():{width:s.clientWidth,height:s.clientHeight}}function Qs(s,t,r){const{offset:a=Gs.All}=r,{target:n=s,axis:l="y"}=r,d=l==="y"?"height":"width",i=n!==s?Vs(n,s):_s,o=n===s?{width:s.scrollWidth,height:s.scrollHeight}:Ks(n),m={width:s.clientWidth,height:s.clientHeight};t[l].offset.length=0;let u=!t[l].interpolate;const c=a.length;for(let x=0;x<c;x++){const g=Us(a[x],m[d],o[d],i[l]);!u&&g!==t[l].interpolatorOffsets[x]&&(u=!0),t[l].offset[x]=g}u&&(t[l].interpolate=He(t[l].offset,is(a),{clamp:!1}),t[l].interpolatorOffsets=[...t[l].offset]),t[l].progress=os(0,1,t[l].interpolate(t[l].current))}function Ys(s,t=s,r){if(r.x.targetOffset=0,r.y.targetOffset=0,t!==s){let a=t;for(;a&&a!==s;)r.x.targetOffset+=a.offsetLeft,r.y.targetOffset+=a.offsetTop,a=a.offsetParent}r.x.targetLength=t===s?t.scrollWidth:t.clientWidth,r.y.targetLength=t===s?t.scrollHeight:t.clientHeight,r.x.containerLength=s.clientWidth,r.y.containerLength=s.clientHeight}function Zs(s,t,r,a={}){return{measure:n=>{Ys(s,a.target,r),Ws(s,r,n),(a.offset||a.target)&&Qs(s,r,a)},notify:()=>t(r)}}const F=new WeakMap,Ee=new WeakMap,ce=new WeakMap,Ie=s=>s===document.scrollingElement?window:s;function Ke(s,{container:t=document.scrollingElement,...r}={}){if(!t)return Le;let a=ce.get(t);a||(a=new Set,ce.set(t,a));const n=Os(),l=Zs(t,s,n,r);if(a.add(l),!F.has(t)){const i=()=>{for(const c of a)c.measure(cs.timestamp);B.preUpdate(o)},o=()=>{for(const c of a)c.notify()},m=()=>B.read(i);F.set(t,m);const u=Ie(t);window.addEventListener("resize",m,{passive:!0}),t!==document.documentElement&&Ee.set(t,Rs(t,m)),u.addEventListener("scroll",m,{passive:!0}),m()}const d=F.get(t);return B.read(d,!1,!0),()=>{var m;xe(d);const i=ce.get(t);if(!i||(i.delete(l),i.size))return;const o=F.get(t);F.delete(t),o&&(Ie(t).removeEventListener("scroll",o),(m=Ee.get(t))==null||m(),window.removeEventListener("resize",o))}}const Pe=new Map;function Xs(s){const t={value:0},r=Ke(a=>{t.value=a[s.axis].progress*100},s);return{currentTime:t,cancel:r}}function Qe({source:s,container:t,...r}){const{axis:a}=r;s&&(t=s);const n=Pe.get(t)??new Map;Pe.set(t,n);const l=r.target??"self",d=n.get(l)??{},i=a+(r.offset??[]).join(",");return d[i]||(d[i]=!r.target&&ds()?new ScrollTimeline({source:t,axis:a}):Xs({container:t,...r})),d[i]}function Js(s,t){const r=Qe(t);return s.attachTimeline({timeline:t.target?void 0:r,observe:a=>(a.pause(),_e(n=>{a.time=a.duration*n},r))})}function et(s){return s.length===2}function st(s,t){return et(s)?Ke(r=>{s(r[t.axis].progress,r)},t):_e(s,Qe(t))}function tt(s,{axis:t="y",container:r=document.scrollingElement,...a}={}){if(!r)return Le;const n={axis:t,container:r,...a};return typeof s=="function"?st(s,n):Js(s,n)}const at=()=>({scrollX:O(0),scrollY:O(0),scrollXProgress:O(0),scrollYProgress:O(0)}),K=s=>s?!s.current:!1;function rt({container:s,target:t,...r}={}){const a=he(at),n=j.useRef(null),l=j.useRef(!1),d=j.useCallback(()=>(n.current=tt((i,{x:o,y:m})=>{a.scrollX.set(o.current),a.scrollXProgress.set(o.progress),a.scrollY.set(m.current),a.scrollYProgress.set(m.progress)},{...r,container:(s==null?void 0:s.current)||void 0,target:(t==null?void 0:t.current)||void 0}),()=>{var i;(i=n.current)==null||i.call(n)}),[s,t,JSON.stringify(r.offset)]);return Re(()=>{if(l.current=!1,K(s)||K(t)){l.current=!0;return}else return d()},[d]),j.useEffect(()=>{if(l.current)return fe(!K(s)),fe(!K(t)),d()},[d]),a}function nt(s){const t=he(()=>O(s)),{isStatic:r}=j.useContext(ms);if(r){const[,a]=j.useState(s);j.useEffect(()=>t.on("change",a),[])}return t}function Ye(s,t){const r=nt(t()),a=()=>r.set(t());return a(),Re(()=>{const n=()=>B.preRender(a,!1,!0),l=s.map(d=>d.on("change",n));return()=>{l.forEach(d=>d()),xe(a)}}),r}function lt(s){oe.current=[],s();const t=Ye(oe.current,s);return oe.current=void 0,t}function ze(s,t,r,a){if(typeof s=="function")return lt(s);const n=typeof t=="function"?t:qs(t,r,a);return Array.isArray(s)?Ae(s,n):Ae([s],([l])=>n(l))}function Ae(s,t){const r=he(()=>[]);return Ye(s,()=>{r.length=0;const a=s.length;for(let n=0;n<a;n++)r[n]=s[n].get();return t(r)})}/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=N("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=N("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=N("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=N("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=N("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=N("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=N("Flower",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M12 16.5A4.5 4.5 0 1 1 7.5 12 4.5 4.5 0 1 1 12 7.5a4.5 4.5 0 1 1 4.5 4.5 4.5 4.5 0 1 1-4.5 4.5",key:"14wa3c"}],["path",{d:"M12 7.5V9",key:"1oy5b0"}],["path",{d:"M7.5 12H9",key:"eltsq1"}],["path",{d:"M16.5 12H15",key:"vk5kw4"}],["path",{d:"M12 16.5V15",key:"k7eayi"}],["path",{d:"m8 8 1.88 1.88",key:"nxy4qf"}],["path",{d:"M14.12 9.88 16 8",key:"1lst6k"}],["path",{d:"m8 16 1.88-1.88",key:"h2eex1"}],["path",{d:"M14.12 14.12 16 16",key:"uqkrx3"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=N("HeartPulse",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}],["path",{d:"M3.22 12H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"1uw2ng"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=N("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=N("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=N("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=N("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=N("Syringe",[["path",{d:"m18 2 4 4",key:"22kx64"}],["path",{d:"m17 7 3-3",key:"1w1zoj"}],["path",{d:"M19 9 8.7 19.3c-1 1-2.5 1-3.4 0l-.6-.6c-1-1-1-2.5 0-3.4L15 5",key:"1exhtz"}],["path",{d:"m9 11 4 4",key:"rovt3i"}],["path",{d:"m5 19-3 3",key:"59f2uf"}],["path",{d:"m14 4 6 6",key:"yqp9t2"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=N("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=N("TreePine",[["path",{d:"m17 14 3 3.3a1 1 0 0 1-.7 1.7H4.7a1 1 0 0 1-.7-1.7L7 14h-.3a1 1 0 0 1-.7-1.7L9 9h-.2A1 1 0 0 1 8 7.3L12 3l4 4.3a1 1 0 0 1-.8 1.7H15l3 3.3a1 1 0 0 1-.7 1.7H17Z",key:"cpyugq"}],["path",{d:"M12 22v-3",key:"kmzjlo"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=N("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=N("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=N("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),ft=()=>{const s=qe(),t=ge(i=>i.user),r=t==null?void 0:t.id,{addToast:a}=ne(),n=Q({mutationFn:async({plantId:i,imageDataUrl:o,note:m})=>{var g;if(!r)throw new Error("User not authenticated");console.log("🖼️ [Image] Iniciando proceso de subida de imagen..."),console.log("🔬 [Image] Analizando imagen con IA...");const u=await us(o);console.log("☁️ [Image] Subiendo imagen a Storage...");const c=await xs(o,"plant-images",`${r}/${i}`);console.log("💾 [Image] Guardando registro en base de datos...");const x=await _.addPlantImage(i,{url:c,timestamp:new Date,isProfileImage:!1,healthAnalysis:u.health},r);return(g=u.health)!=null&&g.confidence&&(console.log("🏥 [Image] Actualizando health score de la planta..."),await _.updatePlantHealthScore(i,r,u.health.confidence,u.health,x.id)),console.log("✅ [Image] Proceso completado exitosamente"),{image:x,analysis:u,note:m}},onSuccess:(i,o)=>{var c,x,g;s.invalidateQueries({queryKey:["plants"]}),s.invalidateQueries({queryKey:["plant",o.plantId]});const{setPlant:m}=je.getState(),u=je.getState().getPlantById(o.plantId);if(u){const b={...u,images:[...u.images,i.image],healthScore:((c=i.analysis.health)==null?void 0:c.confidence)||u.healthScore};m(b)}a({type:"success",title:"Nueva imagen añadida",message:`Análisis completado. Salud actual: ${((g=(x=i.analysis.health)==null?void 0:x.confidence)==null?void 0:g.toFixed(0))||"N/A"}%`})},onError:i=>{console.error("💥 [Image] Error en proceso de subida:",i),a({type:"error",title:"Error al agregar imagen",message:i.message})}}),l=Q({mutationFn:async({plantId:i,imageId:o})=>{if(!r)throw new Error("User not authenticated");return console.log("🖼️ [Profile] Cambiando imagen de perfil..."),await _.setProfileImage(i,o,r),{plantId:i,imageId:o}},onSuccess:i=>{s.invalidateQueries({queryKey:["plants"]}),s.invalidateQueries({queryKey:["plant",i.plantId]}),a({type:"success",title:"Imagen de perfil actualizada",message:"La imagen principal de la planta ha sido cambiada"})},onError:i=>{a({type:"error",title:"Error al cambiar imagen de perfil",message:i.message})}}),d=Q({mutationFn:async({plantId:i,imageId:o})=>{if(!r)throw new Error("User not authenticated");return console.log("🗑️ [Image] Eliminando imagen..."),await _.deleteImage(o,r),{plantId:i,imageId:o}},onSuccess:i=>{s.invalidateQueries({queryKey:["plants"]}),s.invalidateQueries({queryKey:["plant",i.plantId]}),a({type:"success",title:"Imagen eliminada",message:"La imagen ha sido eliminada de tu planta"})},onError:i=>{a({type:"error",title:"Error al eliminar imagen",message:i.message})}});return{addPlantImage:n.mutate,isAddingImage:n.isPending,setProfileImage:l.mutate,isSettingProfileImage:l.isPending,deleteImage:d.mutate,isDeletingImage:d.isPending}};function jt({images:s}){const[t,r]=j.useState(null);if(!s||s.length===0)return e.jsx(V,{className:"mt-4",children:e.jsx(te,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(L,{className:"w-12 h-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No hay imágenes para esta planta todavía."}),e.jsx("p",{className:"text-sm text-muted-foreground/70 mt-2",children:"¡Agrega algunas fotos para seguir su progreso!"})]})})});const a=[...s].sort((o,m)=>new Date(m.timestamp).getTime()-new Date(o.timestamp).getTime()),n=o=>{r(o)},l=()=>{r(null)},d=o=>{if(t===null)return;const m=o==="prev"?(t-1+a.length)%a.length:(t+1)%a.length;r(m)},i=o=>(o instanceof Date?o:new Date(o)).toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"});return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold tracking-tight flex items-center",children:[e.jsx(L,{className:"w-5 h-5 mr-2 text-primary"}),"Galería de Imágenes"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[a.length," foto",a.length!==1?"s":""]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:a.map((o,m)=>e.jsxs(h.div,{className:"aspect-square relative rounded-[8px] overflow-hidden cursor-pointer group w-[80px] h-[80px]",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>n(m),children:[e.jsx(ae,{src:o.url,alt:`Imagen de planta del ${i(o.timestamp)}`,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-110 rounded-[8px]"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-3",children:e.jsx("div",{className:"flex items-center text-white text-xs gap-2",children:e.jsxs("span",{className:"flex items-center",children:[e.jsx(re,{className:"w-3 h-3 mr-1"}),i(o.timestamp)]})})})}),o.isProfileImage&&e.jsx("div",{className:"absolute top-2 right-2 bg-primary text-primary-foreground text-xs px-2 py-1 rounded-full font-medium",children:"Principal"})]},o.id))}),e.jsx(q,{children:t!==null&&e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",onClick:l,children:e.jsxs(h.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},className:"relative max-w-4xl max-h-full",onClick:o=>o.stopPropagation(),children:[e.jsx("button",{onClick:l,className:"absolute top-4 right-4 z-10 bg-black/50 text-white p-2 rounded-full hover:bg-black/70 transition-colors",children:e.jsx(Fe,{className:"w-6 h-6"})}),a.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>d("prev"),className:"absolute left-4 top-1/2 -translate-y-1/2 z-10 bg-black/50 text-white p-2 rounded-full hover:bg-black/70 transition-colors",children:e.jsx(dt,{className:"w-6 h-6"})}),e.jsx("button",{onClick:()=>d("next"),className:"absolute right-4 top-1/2 -translate-y-1/2 z-10 bg-black/50 text-white p-2 rounded-full hover:bg-black/70 transition-colors",children:e.jsx(ys,{className:"w-6 h-6"})})]}),e.jsx("img",{src:a[t].url,alt:`Imagen de planta del ${i(a[t].timestamp)}`,className:"max-w-full max-h-full object-contain rounded-lg"}),e.jsxs("div",{className:"absolute bottom-4 left-4 right-4 bg-black/50 text-white p-4 rounded-lg backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm",children:i(a[t].timestamp)})]}),e.jsxs("span",{className:"text-sm text-white/70",children:[t+1," de ",a.length]})]}),e.jsx("div",{className:"mt-2 text-sm flex items-center gap-2",children:(()=>{const o=a[t].healthAnalysis;if(!o)return e.jsx("span",{className:"italic text-white/60",children:"Sin análisis"});let m="🌱",u="Excelente";switch(o.overallHealth){case"excellent":m="🌱",u="Excelente";break;case"good":m="🌿",u="Buena";break;case"fair":m="🍃",u="Regular";break;case"poor":m="🥀",u="Baja";break;default:m="🌱",u=o.overallHealth}let c;const x={excellent:95,good:80,fair:60,poor:30};return o.overallHealth&&x[o.overallHealth]?c=x[o.overallHealth]:typeof o.confidence=="number"&&(c=o.confidence<=1?o.confidence*100:o.confidence),e.jsxs("span",{children:["Salud: ",e.jsx("span",{className:"font-semibold",children:u})," ",e.jsx("span",{children:m}),c!==void 0&&e.jsxs("span",{className:"ml-2",children:["(",Math.round(c),"%)"]})]})})()}),a[t].isProfileImage&&e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"bg-primary text-primary-foreground text-xs px-2 py-1 rounded-full",children:"Imagen Principal"})})]})]})})})]})}const bt=new gs,yt=()=>{const[s,t]=j.useState(!1),r=qe(),a=ge(i=>i.user),{addToast:n}=ne(),l=Q({mutationFn:async({plantId:i,species:o,commonName:m})=>{if(!a)throw new Error("User not authenticated");t(!0),n({type:"info",title:"🤖 Completando información",message:`Consultando IA para ${m||o}...`,duration:3e3});try{const u=await hs(o,m);return await bt.updatePlantInfo(i,a.id,{plantEnvironment:u.plantEnvironment,lightRequirements:u.lightRequirements,description:u.description,funFacts:u.funFacts})}catch(u){throw console.error("❌ [COMPLETAR IA] Error durante el proceso:",u),u}finally{t(!1)}},onSuccess:i=>{console.log("🔄 [COMPLETAR IA] Refrescando datos en cache..."),n({type:"success",title:"✅ ¡Información completada!",message:`Se agregaron datos de ambiente y luz para ${i.name}`,duration:5e3}),r.invalidateQueries({queryKey:["plant",i.id]}),r.invalidateQueries({queryKey:["plants"]}),console.log("✅ [COMPLETAR IA] Cache actualizado correctamente")},onError:i=>{console.error("💥 [COMPLETAR IA] Error final en la operación:",i),n({type:"error",title:"❌ Error al completar información",message:"No se pudo obtener los datos de IA. Intenta de nuevo.",duration:7e3}),t(!1)}});return{completeInfo:(i,o,m)=>l.mutate({plantId:i,species:o,commonName:m}),isCompleting:s||l.isPending,error:l.error,isSuccess:l.isSuccess}},vt=({plant:s,variant:t="primary",size:r="sm",showLabel:a=!0,className:n=""})=>{const{updatePlantHealthMutation:l,isUpdatingPlantHealth:d}=Oe(),i=ge(g=>g.user),{addToast:o}=ne(),{plant:m}=$e(s.id),u=async()=>{if(!(i!=null&&i.id)){o({type:"error",title:"Error",message:"Debes estar logueado para actualizar el diagnóstico"});return}if(!m){o({type:"error",title:"Error",message:"No se pudieron cargar los datos de la planta"});return}console.log("🩺 [Button] Actualizando diagnóstico para:",s.name),l({plant:m,userId:i.id})},c=e.jsxs(e.Fragment,{children:[d?e.jsx(h.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:e.jsx(ps,{size:r.includes("icon")?16:14})}):e.jsx(ws,{size:r.includes("icon")?16:14}),a&&!r.includes("icon")&&e.jsx("span",{className:"ml-2 text-xs",children:d?"Analizando...":"Analizar"})]}),x=r.includes("icon");return e.jsx(k,{onClick:u,disabled:d||!m,size:r,variant:t,className:n,"aria-label":x?`Actualizar diagnóstico de salud para ${s.name}`:void 0,title:x?`Actualizar diagnóstico de salud para ${s.name}`:void 0,children:c})},Nt=({plant:s})=>{var $,U;const t=Be(),[r,a]=j.useState(!1),[n,l]=j.useState(!1),{deletePlant:d,isDeletingPlant:i}=Oe(),{completeInfo:o,isCompleting:m}=yt(),{scrollY:u}=rt(),c=ze(u,[0,300],[0,150]),x=ze(u,[0,200],[1,.3]),g=(($=s.images)==null?void 0:$.find(f=>f.isProfileImage))||((U=s.images)==null?void 0:U[0]),b=!s.plantEnvironment||!s.lightRequirements,v=()=>{window.confirm("¿Estás seguro de que quieres eliminar esta planta? Esta acción es irreversible.")&&d(s.id,{onSuccess:()=>{t("/")}})},C=()=>{console.log("🎯 [UI] Usuario solicitó completar información con IA"),console.log("🌱 [UI] Datos de la planta:",{id:s.id,nombre:s.name,especie:s.species,ambienteActual:s.plantEnvironment||"No especificado",luzActual:s.lightRequirements||"No especificado"}),a(!1),l(!0)},S=()=>{console.log("✅ [UI] Usuario confirmó el completado automático"),l(!1),o(s.id,s.species,s.name)},z=()=>{console.log("❌ [UI] Usuario canceló el completado automático"),l(!1)},E=f=>(f instanceof Date?f:new Date(f)).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"}),A=f=>{switch(f){case"interior":return e.jsx(be,{className:"w-4 h-4 mr-2"});case"exterior":return e.jsx(Me,{className:"w-4 h-4 mr-2"});case"ambos":return e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-3 h-3 mr-1"}),e.jsx(Me,{className:"w-3 h-3 mr-1"})]});default:return null}},w=f=>{switch(f){case"interior":return"Interior";case"exterior":return"Exterior";case"ambos":return"Interior/Exterior";default:return null}},y=f=>{switch(f){case"poca_luz":return e.jsx(Ns,{className:"w-4 h-4 mr-2"});case"luz_indirecta":return e.jsx(W,{className:"w-4 h-4 mr-2 opacity-60"});case"luz_directa_parcial":return e.jsx(W,{className:"w-4 h-4 mr-2 opacity-80"});case"pleno_sol":return e.jsx(W,{className:"w-4 h-4 mr-2"});default:return null}},I=f=>{switch(f){case"poca_luz":return"Poca luz";case"luz_indirecta":return"Luz indirecta";case"luz_directa_parcial":return"Sol parcial";case"pleno_sol":return"Pleno sol";default:return null}},le={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.2,delayChildren:.1}}},D={hidden:{y:20,opacity:0},visible:{y:0,opacity:1,transition:{type:"spring",damping:25,stiffness:120}}},ie={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.6}}};return j.useEffect(()=>{const f=()=>a(!1);if(r)return document.addEventListener("click",f),()=>document.removeEventListener("click",f)},[r]),e.jsxs(h.div,{className:"relative h-96 w-full overflow-hidden",variants:le,initial:"hidden",animate:"visible",children:[e.jsx(h.div,{className:"absolute inset-0 scale-110",style:{y:c,opacity:x},children:g?e.jsx(ae,{src:g.url,alt:s.name,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full bg-gradient-to-br from-green-400 via-green-500 to-green-600",children:e.jsx("div",{className:"absolute inset-0 opacity-30",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='7' cy='7' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}})})}),e.jsxs(h.div,{className:"absolute inset-0",variants:ie,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[rgba(0,0,0,0.6)] to-transparent"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent via-transparent to-black/30"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-background/60 to-transparent"})]}),e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 pt-safe-top z-20",children:e.jsxs(h.div,{className:"flex items-center justify-between",variants:D,children:[e.jsx(k,{"aria-label":"Volver atrás",variant:"ghost",size:"icon",onClick:()=>t("/"),className:"bg-black/30 text-white backdrop-blur-lg rounded-full border border-white/20 hover:bg-black/50 transition-all duration-300",children:e.jsx(Is,{size:20})}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(k,{"aria-label":"Más opciones",variant:"ghost",size:"icon",onClick:f=>{f.stopPropagation(),a(P=>!P)},className:"bg-neutral-800/90 text-white backdrop-blur-lg rounded-full border border-neutral-600 hover:bg-neutral-700 transition-all duration-300 dark:bg-neutral-200/90 dark:text-neutral-900 dark:border-neutral-400 dark:hover:bg-neutral-300",children:e.jsx(ks,{size:20})}),e.jsx(q,{children:r&&e.jsx(h.div,{initial:{opacity:0,scale:.95,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-10},transition:{duration:.15},className:"absolute right-0 mt-2 w-48 origin-top-right rounded-xl bg-background/95 backdrop-blur-lg shadow-xl ring-1 ring-black/10 focus:outline-none z-30 border border-border/50",onClick:f=>f.stopPropagation(),children:e.jsxs("div",{className:"py-2",children:[b&&e.jsxs("button",{onClick:C,disabled:m,className:"flex w-full items-center px-4 py-3 text-sm text-contrast-high hover:bg-contrast-surface transition-colors rounded-lg mx-2",children:[m?e.jsx(Y,{className:"mr-3 h-4 w-4 animate-spin"}):e.jsx(T,{className:"mr-3 h-4 w-4"}),e.jsx("span",{children:m?"Completando...":"Completar con IA"})]}),e.jsx("div",{className:"flex w-full items-center px-2 py-1",children:e.jsx(vt,{plant:s,variant:"outline",size:"sm",showLabel:!0,className:"w-full"})}),e.jsxs("button",{onClick:v,disabled:i,className:"flex w-full items-center px-4 py-3 text-sm text-error-600 dark:text-error-500 hover:bg-error-50 dark:hover:bg-error-900/20 transition-colors rounded-lg mx-2 font-medium",children:[i?e.jsx(Y,{className:"mr-3 h-4 w-4 animate-spin"}):e.jsx(vs,{className:"mr-3 h-4 w-4"}),e.jsx("span",{children:i?"Eliminando...":"Eliminar planta"})]})]})})})]})})]})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 pb-safe-bottom z-10",children:e.jsxs(h.div,{className:"space-y-4",variants:D,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h.h1,{className:"text-[24px] font-bold text-white drop-shadow-lg",variants:D,children:s.nickname||s.name}),e.jsx(h.p,{className:"text-[16px] text-white/90 font-medium",variants:D,children:s.species})]}),e.jsxs(h.div,{className:"flex flex-wrap gap-2 pt-2 max-h-32 overflow-y-auto",variants:D,children:[s.location&&e.jsxs("div",{className:"flex items-center text-white/80 bg-black/30 backdrop-blur-sm px-3 py-2 rounded-full border border-white/20",children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm font-medium",children:s.location})]}),s.dateAdded&&e.jsxs("div",{className:"flex items-center text-white/80 bg-black/30 backdrop-blur-sm px-3 py-2 rounded-full border border-white/20",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{className:"text-sm font-medium",children:["Desde ",E(s.dateAdded)]})]}),s.plantEnvironment&&w(s.plantEnvironment)&&e.jsxs("div",{className:"flex items-center text-white/80 bg-black/30 backdrop-blur-sm px-3 py-2 rounded-full border border-white/20",children:[A(s.plantEnvironment),e.jsx("span",{className:"text-sm font-medium",children:w(s.plantEnvironment)})]}),s.lightRequirements&&I(s.lightRequirements)&&e.jsxs("div",{className:"flex items-center text-white/80 bg-black/30 backdrop-blur-sm px-3 py-2 rounded-full border border-white/20",children:[y(s.lightRequirements),e.jsx("span",{className:"text-sm font-medium",children:I(s.lightRequirements)})]}),s.images&&s.images.length>0&&e.jsx("div",{className:"flex items-center text-white/80 bg-black/30 backdrop-blur-sm px-3 py-2 rounded-full border border-white/20",children:e.jsxs("span",{className:"text-sm font-medium",children:[s.images.length," foto",s.images.length!==1?"s":""]})})]})]})}),e.jsx(q,{children:n&&e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:z,children:e.jsxs(h.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:f=>f.stopPropagation(),className:"bg-white dark:bg-gray-900 rounded-2xl p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center",children:e.jsx(T,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Completar con IA"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Información automática"})]})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:"¿Quieres que la IA complete la información faltante de esta planta?"}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-2xl",children:"🌱"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:s.name})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-2xl",children:"🔬"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:s.species})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("p",{className:"font-medium mb-1",children:"La IA agregará:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• Ambiente recomendado (interior/exterior)"}),e.jsx("li",{children:"• Necesidades de luz específicas"})]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(k,{variant:"outline",onClick:z,className:"flex-1",disabled:m,children:"Cancelar"}),e.jsx(k,{onClick:S,className:"flex-1 bg-green-600 hover:bg-green-700 text-white",disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-4 h-4 mr-2 animate-spin"}),"Completando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Completar"]})})]})]})})})]})},H=({icon:s,label:t,value:r})=>e.jsxs("div",{className:"flex items-start space-x-4 p-4 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 flex items-center justify-center text-primary",children:s}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t}),e.jsx("p",{className:"text-lg font-semibold text-foreground capitalize",children:r})]})]}),wt=({plant:s})=>{const{careProfile:t,personality:r}=s;return t?e.jsxs("div",{className:"bg-background p-6 rounded-lg shadow-lg w-full space-y-8",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold text-foreground mb-4 flex items-center",children:[e.jsx(Ze,{className:"mr-3 text-primary"})," Perfil de Cuidados"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(H,{icon:e.jsx(Ue,{size:24}),label:"Riego",value:`Cada ${t.wateringFrequency} días`}),e.jsx(H,{icon:e.jsx(W,{size:24}),label:"Luz Solar",value:t.sunlightRequirement}),e.jsx(H,{icon:e.jsx(bs,{size:24}),label:"Humedad",value:t.humidityPreference}),e.jsx(H,{icon:e.jsx(Je,{size:24}),label:"Temperatura Ideal",value:`${t.temperatureRange.min}°C - ${t.temperatureRange.max}°C`}),e.jsx(H,{icon:e.jsx(T,{size:24}),label:"Fertilización",value:`Cada ${t.fertilizingFrequency} días`}),e.jsx(H,{icon:e.jsx(Cs,{size:24}),label:"Tipo de Suelo",value:t.soilType})]}),t.specialCare&&t.specialCare.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-semibold text-lg mb-2",children:"Cuidados Especiales:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-muted-foreground",children:t.specialCare.map((a,n)=>e.jsx("li",{children:a},n))})]})]}),r&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold text-foreground mb-4 flex items-center",children:[e.jsx(We,{className:"mr-3 text-primary"})," Personalidad de la Planta"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(H,{icon:e.jsx(ut,{size:24}),label:"Estilo de Comunicación",value:r.communicationStyle}),e.jsxs("div",{className:"md:col-span-2 lg:col-span-3 bg-muted/50 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-semibold text-lg mb-2 flex items-center",children:[e.jsx(xt,{className:"mr-2"})," Frases Típicas"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.catchphrases.map((a,n)=>e.jsxs("span",{className:"bg-primary/10 text-primary px-3 py-1 rounded-full text-sm",children:['"',a,'"']},n))})]})]})]})]}):e.jsx("div",{className:"bg-background p-6 rounded-lg shadow-lg w-full text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No hay perfil de cuidados disponible para esta planta."})})},kt=({description:s,funFacts:t})=>{const r={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{staggerChildren:.1}}},a={hidden:{opacity:0,y:10},visible:{opacity:1,y:0}};return e.jsxs(h.div,{className:"bg-white/0 dark:bg-transparent p-3 sm:p-4 w-full",variants:r,initial:"hidden",animate:"visible",children:[e.jsxs(h.div,{className:"mb-4",variants:a,children:[e.jsx("p",{className:"text-base text-foreground mb-2",children:s}),t&&t.length>0&&e.jsx("ul",{className:"list-disc pl-5 text-sm text-muted-foreground",children:t.map((n,l)=>e.jsx("li",{children:n},l))})]}),t&&t.length>0&&e.jsxs(h.div,{variants:a,children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"p-3 bg-yellow-500/10 rounded-full mr-4",children:e.jsx(T,{className:"w-6 h-6 text-yellow-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-foreground",children:"Datos Curiosos"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Descubre cosas increíbles sobre esta planta"})]})]}),e.jsx("div",{className:"grid gap-4",children:t.map((n,l)=>e.jsxs(h.div,{className:"group flex items-start bg-yellow-500/5 hover:bg-yellow-500/10 border border-yellow-500/20 rounded-xl p-4 transition-all duration-300 hover:shadow-md",variants:a,whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx("div",{className:"flex-shrink-0 mr-4 mt-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ss,{className:"w-5 h-5 text-yellow-500 group-hover:text-yellow-600 transition-colors"}),e.jsx("div",{className:"absolute -inset-2 bg-yellow-500/20 rounded-full opacity-0 group-hover:opacity-100 transition-opacity pulse"})]})}),e.jsx("p",{className:"text-foreground/90 leading-relaxed font-medium group-hover:text-foreground transition-colors",children:n})]},l))})]}),(!t||t.length===0)&&s&&e.jsx(h.div,{className:"mt-8 flex items-center justify-center p-6 bg-muted/30 rounded-xl border border-dashed border-muted-foreground/20",variants:a,children:e.jsxs("div",{className:"text-center",children:[e.jsx(T,{className:"w-6 h-6 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground font-medium",children:"No hay datos curiosos disponibles"}),e.jsx("p",{className:"text-xs text-muted-foreground/70 mt-1",children:"¡Pronto agregaremos información interesante!"})]})})]})},Ct=s=>{switch(s){case"pest":return e.jsx(se,{className:"text-red-500","aria-label":"Plaga"});case"disease":return e.jsx(gt,{className:"text-orange-500","aria-label":"Enfermedad"});case"overwatering":case"underwatering":case"light":case"nutrient":return e.jsx(se,{className:"text-yellow-500","aria-label":"Problema de riego/luz/nutrientes"});default:return e.jsx(T,{className:"text-blue-500","aria-label":"Otro"})}},St=({analysis:s})=>{if(!s)return null;const t=s.issues&&s.issues.length>0;return e.jsxs("div",{className:"p-3 sm:p-4 w-full",role:"region","aria-label":"Análisis de salud de la planta",children:[t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg mb-3",children:"Problemas Detectados"}),e.jsxs("p",{className:"mb-2 text-sm text-red-700 dark:text-red-300 font-medium",children:[s.issues.length," problema",s.issues.length!==1?"s":""," detectado",s.issues.length!==1?"s":""]}),e.jsx("ul",{className:"space-y-4",children:s.issues.map((r,a)=>e.jsxs("li",{className:"flex items-start p-4 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 flex items-center justify-center",children:Ct(r.type)}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"font-semibold capitalize",children:r.type}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.description})]})]},a))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg mb-3",children:"Tratamientos Sugeridos"}),e.jsx("ul",{className:"space-y-3 list-disc list-inside text-muted-foreground",children:s.issues.map((r,a)=>e.jsx("li",{children:r.treatment},a))})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-center p-6 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("span",{className:"text-4xl mb-2",role:"img","aria-label":"Planta saludable",children:"🌱"}),e.jsx(ht,{className:"w-12 h-12 text-green-500 mb-3","aria-label":"Todo en orden"}),e.jsxs("h4",{className:"font-semibold text-lg text-green-700 dark:text-green-300 flex items-center gap-2",children:["¡Todo en orden!",e.jsx("span",{className:"text-base","aria-hidden":"true",children:"🌱"})]}),e.jsx("p",{className:"text-muted-foreground",children:"El análisis inicial no detectó problemas de salud significativos."})]}),s.recommendations&&s.recommendations.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-semibold text-lg mb-3",children:"Recomendaciones Adicionales"}),e.jsx("ul",{className:"space-y-3 list-disc list-inside text-muted-foreground",children:s.recommendations.map((r,a)=>e.jsx("li",{children:r},a))})]})]})},Et=({plant:s,onAddPhoto:t})=>{const[r,a]=j.useState(null),n=j.useMemo(()=>{if(!s.images||s.images.length===0)return[];const c=[...s.images].sort((C,S)=>new Date(C.timestamp).getTime()-new Date(S.timestamp).getTime()),x=[],g=30*24*60*60*1e3;let b=new Date(c[0].timestamp),v=[];return c.forEach((C,S)=>{const z=new Date(C.timestamp);if(z.getTime()-b.getTime()<=g)v.push(C);else{if(v.length>0){const E=v.map(w=>{const y=w.healthAnalysis;if(!y)return;const I={excellent:95,good:80,fair:60,poor:30};if(y.overallHealth&&I[y.overallHealth])return I[y.overallHealth];if(typeof y.confidence=="number")return y.confidence<=1?y.confidence*100:y.confidence}).filter(w=>w!==void 0),A=E.length>0?E.reduce((w,y)=>w+y,0)/E.length:0;x.push({id:`period-${x.length}`,images:[...v],startDate:new Date(v[0].timestamp),endDate:new Date(v[v.length-1].timestamp),avgHealthScore:A,trend:x.length>0?A>x[x.length-1].avgHealthScore?"improving":"declining":"stable",photoCount:v.length})}b=z,v=[C]}if(S===c.length-1&&v.length>0){const E=v.map(w=>{const y=w.healthAnalysis;if(!y)return;const I={excellent:95,good:80,fair:60,poor:30};if(y.overallHealth&&I[y.overallHealth])return I[y.overallHealth];if(typeof y.confidence=="number")return y.confidence<=1?y.confidence*100:y.confidence}).filter(w=>w!==void 0),A=E.length>0?E.reduce((w,y)=>w+y,0)/E.length:0;x.push({id:`period-${x.length}`,images:[...v],startDate:new Date(v[0].timestamp),endDate:new Date(v[v.length-1].timestamp),avgHealthScore:A,trend:x.length>0?A>x[x.length-1].avgHealthScore?"improving":"declining":"stable",photoCount:v.length})}}),x},[s.images]),l=c=>c.toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"}),d=c=>{switch(c){case"improving":return e.jsx(es,{className:"w-4 h-4 text-success-500"});case"declining":return e.jsx(pt,{className:"w-4 h-4 text-error-500"});default:return e.jsx(de,{className:"w-4 h-4 text-warning-500"})}},i=c=>{switch(c){case"improving":return"text-success-500 bg-success-50 border-success-200";case"declining":return"text-error-500 bg-error-50 border-error-200";default:return"text-warning-500 bg-warning-50 border-warning-200"}};function o(c){if(c.length<2)return null;const x=c[c.length-1]-c[0];return x>5?{icon:"⬆️",label:"Mejorando",color:"text-green-600 bg-green-50"}:x<-5?{icon:"⬇️",label:"Declive",color:"text-red-600 bg-red-50"}:{icon:"➡️",label:"Estable",color:"text-gray-600 bg-gray-50"}}if(n.length===0)return e.jsxs(V,{className:"mt-6",children:[e.jsx(Ne,{children:e.jsxs(we,{className:"flex items-center",children:[e.jsx(de,{className:"w-5 h-5 mr-2 text-primary"}),"Evolución de tu Planta"]})}),e.jsx(te,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(L,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"¡Comienza a documentar la evolución!"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Agrega más fotos a lo largo del tiempo para ver cómo progresa tu planta."}),e.jsxs(k,{onClick:t,className:"gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Agregar Primera Foto"]})]})})]});const m=n.map(c=>c.avgHealthScore??0),u=o(m);return e.jsxs(V,{className:"mt-6",children:[e.jsx(Ne,{children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsxs(we,{className:"flex items-center min-w-0",children:[e.jsx(de,{className:"w-5 h-5 mr-2 text-primary shrink-0"}),e.jsx("span",{className:"truncate",children:"Evolución de tu Planta"})]}),n.length>1&&u&&u.icon&&u.label&&e.jsxs("span",{className:`inline-flex items-center min-w-[90px] justify-center px-2 py-1 rounded-full text-xs font-medium border border-neutral-200 ${u.color}`,"aria-label":`Tendencia: ${u.label}`,children:[e.jsx("span",{className:"mr-1",role:"img","aria-label":u.label,children:u.icon}),u.label]})]}),e.jsxs(k,{variant:"primary",size:"default",onClick:t,"aria-label":"Agregar nueva foto de evolución",className:"gap-1 rounded-full px-5 shadow-lg hover:shadow-xl transition-all duration-300 active:scale-95 w-full sm:w-auto",children:[e.jsx(ye,{className:"w-5 h-5"}),"Agregar Foto"]})]})}),e.jsxs(te,{className:"mt-4 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground uppercase tracking-wide",children:"Períodos de Evolución"}),e.jsx("div",{className:"space-y-3",children:n.map((c,x)=>e.jsx(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:x*.1},className:`p-4 rounded-xl border cursor-pointer transition-all duration-200 ${r===c.id?"border-primary-300 bg-primary-50 shadow-sm":"border-neutral-200 hover:border-neutral-300 hover:shadow-sm"}`,onClick:()=>a(r===c.id?null:c.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg border ${i(c.trend)}`,children:d(c.trend)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:l(c.startDate)}),e.jsx(it,{className:"w-3 h-3 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:l(c.endDate)})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ve,{className:"w-3 h-3"}),c.photoCount," fotos"]}),e.jsxs("span",{children:["Salud promedio: ",Math.max(0,Math.min(100,c.avgHealthScore)).toFixed(0),"%"]})]})]})]}),c.images.length>0&&e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden border border-neutral-200",children:e.jsx(ae,{src:c.images[c.images.length-1].url,alt:`Evolución ${l(c.endDate)}`,className:"w-full h-full object-cover"})})]})},c.id))})]}),e.jsx(q,{children:r&&e.jsx(h.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"border-t pt-6",children:(()=>{const c=n.find(x=>x.id===r);return c?e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3",children:c.images.map((x,g)=>e.jsx(h.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:g*.05},className:"aspect-square rounded-lg overflow-hidden border border-neutral-200 hover:border-primary-300 transition-colors cursor-pointer group",children:e.jsx(ae,{src:x.url,alt:`Evolución ${l(new Date(x.timestamp))}`,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"})},x.id))})}):null})()})})]})]})},It=({isOpen:s,onClose:t,onPhotoAdded:r,plantName:a})=>{const[n,l]=j.useState("choose"),[d,i]=j.useState(null),[o,m]=j.useState(""),[u,c]=j.useState(null),[x,g]=j.useState(!1),b=j.useRef(null),{addToast:v}=ne(),C=j.useCallback(()=>{l("choose"),i(null),m(""),c(null),g(!1)},[]),S=j.useCallback(()=>{C(),t()},[C,t]),z=j.useCallback(f=>{const P=new FileReader;P.onload=G=>{var pe;const ss=(pe=G.target)==null?void 0:pe.result;i(ss),l("preview")},P.readAsDataURL(f)},[]),E=j.useCallback(()=>{b.current&&b.current.click()},[]),A=j.useCallback(()=>{E()},[E]),w=j.useCallback(f=>{var G;const P=(G=f.target.files)==null?void 0:G[0];if(P){if(!P.type.startsWith("image/")){c("Por favor selecciona un archivo de imagen válido.");return}if(P.size>5*1024*1024){c("La imagen es demasiado grande. Máximo 5MB.");return}z(P)}},[z]),y=j.useCallback(async()=>{if(d)try{l("uploading"),g(!0),await r(d,o.trim()||void 0),l("success"),g(!1),v({type:"success",title:"Foto agregada exitosamente",message:`Nueva imagen añadida a ${a}`}),setTimeout(()=>{S()},1500)}catch(f){c(f instanceof Error?f.message:"Error al subir la imagen"),l("error"),g(!1)}},[d,o,r,a,v,S]),I=()=>(console.log("[AddPhotoModal] Renderizando botón Tomar Foto:",e.jsx(L,{className:"w-6 h-6"}),"Tomar Foto"),console.log("[AddPhotoModal] Renderizando botón Elegir de Galería:",e.jsx(Te,{className:"w-6 h-6"}),"Elegir de Galería"),e.jsxs(h.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"text-center space-y-6",children:[e.jsxs("div",{children:[e.jsx(L,{className:"w-16 h-16 text-primary mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Agregar Nueva Foto"}),e.jsxs("p",{className:"text-muted-foreground",children:["Documenta el progreso de ",e.jsx("span",{className:"font-medium",children:a})]})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs(k,{variant:"primary",size:"lg",onClick:A,className:"h-16 gap-3 text-primary-foreground",children:[e.jsx(L,{className:"w-6 h-6"}),"Tomar Foto"]}),e.jsxs(k,{variant:"secondary",size:"lg",onClick:E,className:"h-16 gap-3 text-primary-foreground",children:[e.jsx(Te,{className:"w-6 h-6"}),"Elegir de Galería"]})]}),e.jsx("input",{ref:b,type:"file",accept:"image/*",onChange:w,className:"hidden","data-testid":"file-input"})]})),le=()=>e.jsxs(h.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Vista Previa"}),e.jsxs("p",{className:"text-muted-foreground",children:["Revisa la imagen antes de agregar a ",a]})]}),d&&e.jsxs("div",{className:"space-y-4 pb-8 sm:pb-0",children:[e.jsx("div",{className:"aspect-video max-h-80 mx-auto rounded-lg overflow-hidden border",children:e.jsx("img",{src:d,alt:"Vista previa",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Nota (opcional)"}),e.jsx("textarea",{value:o,onChange:f=>m(f.target.value),placeholder:"Agrega una nota sobre esta foto...",className:"w-full p-3 border border-neutral-200 rounded-lg resize-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",rows:3,maxLength:200}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[o.length,"/200"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(k,{variant:"secondary",onClick:()=>l("choose"),className:"flex-1",children:"Cambiar Imagen"}),e.jsxs(k,{variant:"primary",onClick:y,className:"flex-1 gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),"Analizar y Guardar"]})]})]})]}),D=()=>e.jsxs(h.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center space-y-6 py-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(Y,{className:"w-16 h-16 text-primary mx-auto animate-spin"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:x?"Analizando imagen...":"Subiendo foto..."}),e.jsx("p",{className:"text-muted-foreground",children:x?"La IA está evaluando la salud de tu planta":"Guardando la nueva imagen en tu jardín"})]})]}),e.jsx("div",{className:"w-full bg-neutral-200 rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full animate-pulse",style:{width:"70%"}})})]}),ie=()=>e.jsxs(h.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"text-center space-y-6 py-8",children:[e.jsx(Z,{className:"w-16 h-16 text-success-500 mx-auto"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"¡Foto agregada!"}),e.jsxs("p",{className:"text-muted-foreground",children:["La nueva imagen ha sido añadida al progreso de ",a]})]})]}),$=()=>e.jsxs(h.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"text-center space-y-6 py-8",children:[e.jsx(me,{className:"w-16 h-16 text-error-500 mx-auto"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Error al subir"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:u||"Hubo un problema al procesar la imagen"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(k,{variant:"secondary",onClick:()=>l("choose"),children:"Intentar de Nuevo"}),e.jsx(k,{variant:"primary",onClick:S,children:"Cerrar"})]})]})]}),U=()=>{switch(n){case"choose":return I();case"preview":return le();case"uploading":return D();case"success":return ie();case"error":return $();default:return I()}};return e.jsx(q,{children:s&&e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",onClick:f=>{f.target===f.currentTarget&&n!=="uploading"&&S()},children:e.jsx(h.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"w-full max-w-md",children:e.jsx(V,{children:e.jsxs(te,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"font-medium text-sm text-muted-foreground",children:"NUEVA FOTO"})]}),n!=="uploading"&&e.jsx(k,{variant:"ghost",size:"icon-sm",onClick:S,children:e.jsx(Fe,{className:"w-4 h-4"})})]}),U()]})})})})})},Pt=({plant:s})=>{var b,v,C;const{careProfile:t,healthScore:r,lastWatered:a,dateAdded:n}=s,l=(v=(b=s.images)==null?void 0:b[0])==null?void 0:v.healthAnalysis,d=a?Math.floor((Date.now()-new Date(a).getTime())/(1e3*60*60*24)):null,i=Math.floor((Date.now()-new Date(n).getTime())/(1e3*60*60*24)),m=r>=85?{text:"Excelente",color:"text-green-500",icon:Z,emoji:"🌟"}:r>=70?{text:"Buena",color:"text-green-400",icon:Z,emoji:"✅"}:r>=50?{text:"Regular",color:"text-yellow-500",icon:fs,emoji:"⚠️"}:{text:"Necesita atención",color:"text-red-500",icon:se,emoji:"🆘"},c=(()=>{if(!d||!(t!=null&&t.wateringFrequency))return{text:"Sin datos",color:"text-gray-500",urgent:!1};const S=d>=t.wateringFrequency;return d>t.wateringFrequency+2?{text:"Riego urgente",color:"text-red-500",urgent:!0}:S?{text:"Necesita riego",color:"text-yellow-500",urgent:!0}:{text:"Bien hidratada",color:"text-green-500",urgent:!1}})(),x={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{staggerChildren:.1}}},g={hidden:{opacity:0,y:10},visible:{opacity:1,y:0}};return e.jsx(h.div,{variants:x,initial:"hidden",animate:"visible",children:e.jsxs(V,{variant:"glass",className:"content-spacing-sm element-spacing",children:[e.jsx(h.div,{variants:g,className:"w-full mb-3",children:e.jsxs("div",{className:"w-full flex items-center justify-between bg-green-100 dark:bg-green-900/30 rounded-lg px-4 py-2 mb-2",children:[e.jsxs("span",{className:"flex items-center gap-2 text-green-700 text-base font-bold",children:[e.jsx(Z,{className:"w-5 h-5"}),r,"% ",m.text]}),e.jsxs("span",{className:"flex items-center gap-1 text-contrast-soft text-sm align-baseline",children:[e.jsx(re,{className:"w-4 h-4"}),"Día ",i]})]})}),e.jsxs(h.div,{variants:g,className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:X("flex items-center space-x-3 p-3 rounded-lg",c.urgent?"bg-yellow-50 dark:bg-yellow-900/20":"bg-green-50 dark:bg-green-900/20"),children:[e.jsx(Ue,{className:X("w-5 h-5",c.color)}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-contrast-soft",children:"Riego"}),e.jsx("p",{className:X("font-semibold text-sm",c.color),children:c.text}),d!==null&&e.jsxs("p",{className:"text-xs text-contrast-soft",children:["Hace ",d," día",d!==1?"s":""]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg bg-blue-50 dark:bg-blue-900/20",children:[e.jsx(W,{className:"w-5 h-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-contrast-soft",children:"Luz"}),e.jsx("p",{className:"font-semibold text-sm text-blue-600 dark:text-blue-400",children:(t==null?void 0:t.sunlightRequirement)||"No especificado"}),s.lightRequirements&&e.jsx("p",{className:"text-xs text-contrast-soft capitalize",children:s.lightRequirements.replace("_"," ")})]})]}),s.plantEnvironment&&e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg bg-purple-50 dark:bg-purple-900/20",children:[e.jsx(Xe,{className:"w-5 h-5 text-purple-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-contrast-soft",children:"Ambiente"}),e.jsx("p",{className:"font-semibold text-sm text-purple-600 dark:text-purple-400 capitalize",children:s.plantEnvironment==="ambos"?"Interior/Exterior":s.plantEnvironment})]})]}),(t==null?void 0:t.temperatureRange)&&e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg bg-orange-50 dark:bg-orange-900/20",children:[e.jsx(Je,{className:"w-5 h-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-contrast-soft",children:"Temperatura"}),e.jsxs("p",{className:"font-semibold text-sm text-orange-600 dark:text-orange-400",children:[t.temperatureRange.min,"°-",t.temperatureRange.max,"°C"]})]})]})]}),(l==null?void 0:l.issues)&&l.issues.length>0&&e.jsx(h.div,{variants:g,className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(se,{className:"w-5 h-5 text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-red-700 dark:text-red-300 text-sm mb-1",children:[l.issues.length," problema",l.issues.length!==1?"s":""," detectado",l.issues.length!==1?"s":""]}),e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400",children:[l.issues[0].description,l.issues.length>1&&` y ${l.issues.length-1} más...`]})]})]})}),e.jsx("br",{}),((C=s.personality)==null?void 0:C.communicationStyle)&&e.jsx(h.div,{variants:g,className:"p-4 bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 rounded-lg border border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(We,{className:"w-5 h-5 text-green-500 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-green-700 dark:text-green-300 text-sm mb-1",children:["🤖 Personalidad: ",s.personality.communicationStyle]}),s.personality.catchphrases&&s.personality.catchphrases.length>0&&e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 italic",children:['"',s.personality.catchphrases[0],'"']})]})]})})]})})},zt=({plant:s,onAddPhoto:t})=>{var m,u,c,x;const[r,a]=j.useState("evolution"),n=(u=(m=s.images)==null?void 0:m[0])==null?void 0:u.healthAnalysis,l=(n==null?void 0:n.issues)&&n.issues.length>0,d=s.images&&s.images.length>1,i=[{id:"evolution",title:"Evolución y Progreso",icon:e.jsx(es,{className:"w-5 h-5"}),badge:d?`${((c=s.images)==null?void 0:c.length)||0} fotos`:"Nueva",component:e.jsx(Et,{plant:s,onAddPhoto:t}),priority:1},{id:"health",title:"Análisis de Salud",icon:e.jsx(mt,{className:"w-5 h-5"}),badge:l?"Atención":"Saludable",component:e.jsx(St,{analysis:n}),priority:l?1:3},{id:"care",title:"Perfil de Cuidados",icon:e.jsx(Ze,{className:"w-5 h-5"}),badge:s.careProfile?"Completo":"Pendiente",component:e.jsx(wt,{plant:s}),priority:s.careProfile?2:1},{id:"description",title:"Información General",icon:e.jsx(ot,{className:"w-5 h-5"}),badge:(x=s.funFacts)!=null&&x.length?`${s.funFacts.length} datos`:void 0,component:e.jsx(kt,{species:s.species,description:s.description,funFacts:s.funFacts}),priority:4}].filter(g=>g.id==="health"?!!n:!0).sort((g,b)=>g.priority-b.priority),o=(g,b)=>g==="health"&&b==="Atención"?"badge-error-contrast":b==="Pendiente"?"badge-warning-contrast":b==="Nueva"?"bg-blue-600 text-white font-semibold border border-blue-700 dark:bg-blue-500 dark:text-black dark:border-blue-600":b==="Saludable"||b==="Completo"?"badge-success-contrast":"badge-neutral-contrast";return e.jsx("div",{className:"flex flex-col gap-y-1",children:i.map(g=>{const b=r===g.id;return e.jsxs("div",{className:"rounded-xl bg-white/70 dark:bg-neutral-900/70 backdrop-blur-md transition-shadow duration-200",children:[e.jsxs(h.button,{onClick:()=>a(b?"":g.id),className:"w-full flex items-center justify-between px-3 py-[12px] sm:px-4 sm:py-3 min-h-12 text-left focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 active:bg-primary-50 dark:active:bg-primary-900/20",style:{position:b?"sticky":"static",top:0,zIndex:2,background:"inherit"},whileTap:{scale:.98},children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("span",{className:"p-1.5 rounded-lg bg-primary/10 text-primary flex-shrink-0 flex items-center justify-center",children:g.icon}),e.jsx("span",{className:"font-semibold text-lg truncate text-neutral-900 dark:text-neutral-100",children:g.title}),g.badge&&e.jsx("span",{className:X("ml-auto px-2 py-0.5 text-xs font-medium rounded-full",o(g.id,g.badge)),children:g.badge})]}),e.jsx(h.div,{animate:{rotate:b?180:0},transition:{duration:.2},className:"flex-shrink-0 ml-2",children:e.jsx(ct,{className:"w-6 h-6 text-neutral-600 dark:text-neutral-400"})})]}),e.jsx(q,{children:b&&e.jsx(h.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:e.jsx("div",{className:"px-3 pb-3 sm:px-4 sm:pb-4 max-h-[60vh] overflow-y-auto",children:g.component})})})]},g.id)})})},De=()=>e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"relative h-96 w-full overflow-hidden bg-gradient-to-br from-muted/50 to-muted",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/80 via-background/20 to-transparent"}),e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 pt-safe-top",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{className:"h-10 w-10 rounded-full"}),e.jsx(p,{className:"h-10 w-10 rounded-full"})]})]})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 pb-safe-bottom",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"h-8 w-64"}),e.jsx(p,{className:"h-6 w-48"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(p,{className:"h-8 w-24 rounded-full"}),e.jsx(p,{className:"h-8 w-32 rounded-full"}),e.jsx(p,{className:"h-8 w-20 rounded-full"})]})]})})]}),e.jsxs("div",{className:"p-4 space-y-6 pb-20",children:[e.jsxs("div",{className:"bg-background p-6 rounded-2xl shadow-lg border border-border/50",children:[e.jsxs("div",{className:"mb-6 flex items-center",children:[e.jsx(p,{className:"h-12 w-12 rounded-full mr-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"h-6 w-48"}),e.jsx(p,{className:"h-4 w-64"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(p,{className:"h-4 w-full"}),e.jsx(p,{className:"h-4 w-5/6"}),e.jsx(p,{className:"h-4 w-4/5"}),e.jsx(p,{className:"h-4 w-3/4"})]}),e.jsxs("div",{className:"mt-8 space-y-4",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(p,{className:"h-12 w-12 rounded-full mr-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"h-6 w-32"}),e.jsx(p,{className:"h-4 w-56"})]})]}),[1,2,3].map(s=>e.jsxs("div",{className:"flex items-start bg-muted/20 rounded-xl p-4",children:[e.jsx(p,{className:"h-5 w-5 rounded-full mr-4 mt-1"}),e.jsx(p,{className:"h-4 w-full"})]},s))]})]}),e.jsxs("div",{className:"bg-background p-6 rounded-2xl shadow-lg border border-border/50",children:[e.jsxs("div",{className:"mb-4 flex items-center",children:[e.jsx(p,{className:"h-6 w-6 mr-3"}),e.jsx(p,{className:"h-6 w-48"})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-6",children:[e.jsx(p,{className:"h-12 w-12 mx-auto mb-3"}),e.jsx(p,{className:"h-6 w-32 mx-auto mb-2"}),e.jsx(p,{className:"h-4 w-48 mx-auto"})]})]}),e.jsxs("div",{className:"bg-background p-6 rounded-2xl shadow-lg border border-border/50",children:[e.jsxs("div",{className:"mb-4 flex items-center",children:[e.jsx(p,{className:"h-6 w-6 mr-3"}),e.jsx(p,{className:"h-6 w-40"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(s=>e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[e.jsx(p,{className:"h-8 w-8 mb-2"}),e.jsx(p,{className:"h-4 w-16 mb-1"}),e.jsx(p,{className:"h-5 w-24"})]},s))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{className:"h-5 w-5 mr-2"}),e.jsx(p,{className:"h-6 w-32"})]}),e.jsx(p,{className:"h-4 w-16"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[1,2,3,4,5,6].map(s=>e.jsx(p,{className:"aspect-square rounded-xl"},s))})]})]}),e.jsxs("div",{className:"fixed bottom-4 right-4 z-40 flex flex-col-reverse gap-3",children:[[1,2,3].map(s=>e.jsx(p,{className:"h-14 w-14 rounded-full"},s)),e.jsx(p,{className:"h-16 w-16 rounded-full"})]})]}),Bt=()=>{const{plantId:s}=js(),t=Be(),{plant:r,loading:a,error:n}=$e(s),{addPlantImage:l}=ft(),[d,i]=j.useState(!1),o=async(m,u)=>{if(!s)throw new Error("Plant ID is required");return new Promise((c,x)=>{l({plantId:s,imageDataUrl:m,note:u},{onSuccess:()=>c(),onError:g=>x(g)})})};return a?e.jsx(De,{}):n?e.jsx("main",{className:"flex flex-1 flex-col items-center justify-center p-4 text-center h-screen",children:e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-4",children:[e.jsx(me,{className:"w-16 h-16 text-destructive mx-auto"}),e.jsx("h1",{className:"text-2xl font-bold text-destructive",children:"Ocurrió un Error"}),e.jsx("p",{className:"text-muted-foreground max-w-md",children:n}),e.jsx(k,{onClick:()=>window.location.reload(),className:"mt-4",children:"Intentar de nuevo"})]})}):r?e.jsx(j.Suspense,{fallback:e.jsx(De,{}),children:e.jsxs(h.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[e.jsx(Nt,{plant:r}),e.jsxs("main",{className:"p-3 sm:p-4 space-y-3 sm:space-y-4",style:{paddingBottom:"calc(88px + env(safe-area-inset-bottom))"},children:[e.jsx(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsx(Pt,{plant:r})}),e.jsx(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:e.jsx(zt,{plant:r,onAddPhoto:()=>i(!0)})}),e.jsx(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},children:e.jsx(jt,{images:r.images})})]}),e.jsxs(h.div,{className:"fixed bottom-24 right-4 z-40 flex flex-col-reverse gap-3",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.5},children:[e.jsxs(h.button,{onClick:()=>i(!0),className:"bg-primary hover:bg-primary/90 text-primary-foreground p-2.5 sm:p-3 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 group flex items-center",whileHover:{scale:1.1},whileTap:{scale:.95},title:"Agregar nueva foto",children:[e.jsx(L,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"ml-2 text-xs font-medium block sm:hidden",children:"Agregar foto"}),e.jsx("span",{className:"absolute right-full mr-3 top-1/2 -translate-y-1/2 tooltip-contrast text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap shadow-lg hidden sm:block",children:"Agregar foto"})]}),e.jsxs(h.button,{onClick:()=>t(ve.toPlantChat(r.id)),className:"bg-blue-500 hover:bg-blue-600 text-white p-2.5 sm:p-3 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 group flex items-center",whileHover:{scale:1.1},whileTap:{scale:.95},title:"Chat con la planta",children:[e.jsx(Es,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"ml-2 text-xs font-medium block sm:hidden",children:"Chat"}),e.jsx("span",{className:"absolute right-full mr-3 top-1/2 -translate-y-1/2 tooltip-contrast text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap shadow-lg hidden sm:block",children:"Chat"})]})]}),e.jsx(It,{isOpen:d,onClose:()=>i(!1),onPhotoAdded:o,plantName:r.nickname||r.name})]})}):e.jsx("main",{className:"flex flex-1 flex-col items-center justify-center p-4 text-center h-screen",children:e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-4",children:[e.jsx(me,{className:"w-16 h-16 text-muted-foreground mx-auto"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Planta no encontrada"}),e.jsx("p",{className:"text-muted-foreground max-w-md",children:"No se pudo encontrar la información de la planta solicitada."}),e.jsx(k,{onClick:()=>t(ve.toDashboard()),className:"mt-4",children:"Volver al inicio"})]})})};export{Bt as default};
