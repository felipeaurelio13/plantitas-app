import{c as y,a7 as D,G as m,r as g,a5 as _}from"./index-IWlstUSv.js";import{r as u,t as d,g as p}from"./index-Bnwr932r.js";/**
 * @license lucide-react v0.411.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=y("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);function h(t){u(1,arguments);var e=d(t);return e.setHours(0,0,0,0),e}var P=864e5;function F(t,e){u(2,arguments);var n=h(t),a=h(e),r=n.getTime()-p(n),l=a.getTime()-p(a);return Math.round((r-l)/P)}function v(t,e){var n=t.getFullYear()-e.getFullYear()||t.getMonth()-e.getMonth()||t.getDate()-e.getDate()||t.getHours()-e.getHours()||t.getMinutes()-e.getMinutes()||t.getSeconds()-e.getSeconds()||t.getMilliseconds()-e.getMilliseconds();return n<0?-1:n>0?1:n}function M(t,e){u(2,arguments);var n=d(t),a=d(e),r=v(n,a),l=Math.abs(F(n,a));n.setDate(n.getDate()-r*l);var c=+(v(n,a)===-r),i=r*(l-c);return i===0?0:i}const w=async t=>{const{data:e,error:n}=await _.from("plants").select(`
      *,
      plant_images(*)
    `).eq("id",t).single();if(n)throw console.error(`Error fetching plant ${t}:`,n),n.code==="PGRST116"?new Error("Planta no encontrada."):new Error("Error al cargar la información de la planta.");const a=e;return{id:a.id,name:a.name,species:a.species,description:a.description??void 0,funFacts:a.fun_facts??void 0,variety:a.variety??void 0,nickname:a.nickname??void 0,location:a.location,plantEnvironment:a.plant_environment,lightRequirements:a.light_requirements,dateAdded:new Date(a.date_added),lastFertilized:a.last_fertilized?new Date(a.last_fertilized):void 0,healthScore:a.health_score??0,careProfile:a.care_profile,personality:a.personality,images:a.plant_images.map(r=>({id:r.id,url:r.url??"",timestamp:new Date(r.created_at),isProfileImage:r.is_profile_image??!1,healthAnalysis:r.health_analysis})),chatHistory:[],notifications:[]}},L=t=>{const{data:e,isLoading:n,error:a}=D({queryKey:["plant",t],queryFn:()=>w(t),enabled:!!t}),r=m(i=>i.setPlant),l=m(i=>i.selectPlant);g.useEffect(()=>(e&&(r(e),l(e.id)),()=>{l(null)}),[e,r,l]);const c=g.useMemo(()=>{if(!e)return[];const i=[];if(!e.images||e.images.length===0)return i;const f=e.images.map(s=>{var o;return((o=s.healthAnalysis)==null?void 0:o.confidence)||null}).filter(s=>s!==null);if(f.length>=3){const s=f.slice(-3);if(s[0]>s[1]&&s[1]>s[2]){const o=s[0]-s[2];i.push({type:"warning",title:"Tendencia de Salud a la Baja",message:`La salud de tu planta ha disminuido un ${o.toFixed(0)}% en las últimas revisiones.`})}}if(e.lastFertilized&&e.careProfile){const s=M(new Date,new Date(e.lastFertilized)),o=e.careProfile.fertilizingFrequency;s>o&&i.push({type:"tip",title:"Consejo de Fertilización",message:`Han pasado ${s} días desde la última fertilización. El intervalo recomendado es de ${o} días.`})}return i},[e]);return{plant:e,insights:c,loading:n,error:(a==null?void 0:a.message)||null}};export{S as L,L as u};
